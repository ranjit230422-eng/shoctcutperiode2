<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Izin Staf LINETOGEL - Sistem Izin Keluar Staf</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #6a11cb;
            --secondary: #2575fc;
            --success: #00b894;
            --warning: #fdcb6e;
            --danger: #e17055;
            --light: #f8f9fa;
            --dark: #2d3436;
            --gray: #636e72;
            --kapten: #8e44ad;
            --cs: #3498db;
            --kasir: #1abc9c;
            --cs-line: #e74c3c;
            --bg-gradient: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            --card-gradient: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            --sidebar-gradient: linear-gradient(135deg, #5e35b1 0%, #3949ab 100%);
            --login-gradient: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            --time-gradient: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%);
            --timer-gradient: linear-gradient(135deg, #00b894 0%, #55efc4 100%);
            --timer-warning: linear-gradient(135deg, #fdcb6e 0%, #ffeaa7 100%);
            --timer-danger: linear-gradient(135deg, #e17055 0%, #fab1a0 100%);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: url('https://images.unsplash.com/photo-1556761175-5973dc0f32e7?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2000&q=80') center/cover no-repeat fixed;
            color: var(--dark);
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
            position: relative;
        }
        
        .container {
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .login-container {
            display: flex;
            width: 100%;
            max-width: 1200px;
            min-height: 600px;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.3);
            margin: 0 auto 30px;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(5px);
        }
        
        .login-time-section {
            flex: 1;
            background: var(--time-gradient);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 40px;
            color: white;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .login-time-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.1);
            z-index: 1;
        }
        
        .time-content {
            position: relative;
            z-index: 2;
            width: 100%;
        }
        
        .clock-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 30px;
        }
        
        .analog-clock {
            width: 180px;
            height: 180px;
            border: 10px solid white;
            border-radius: 50%;
            position: relative;
            margin-bottom: 20px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
        }
        
        .clock-face {
            position: relative;
            width: 100%;
            height: 100%;
            transform: translateY(-3px);
        }
        
        .hand {
            width: 50%;
            height: 6px;
            background: white;
            position: absolute;
            top: 50%;
            transform-origin: 100%;
            transform: rotate(90deg);
            transition: all 0.05s;
            transition-timing-function: cubic-bezier(0.1, 2.7, 0.58, 1);
        }
        
        .second-hand {
            height: 2px;
            background: #e74c3c;
        }
        
        .min-hand {
            height: 4px;
        }
        
        .hour-hand {
            height: 6px;
            width: 40%;
            left: 10%;
        }
        
        .digital-clock {
            text-align: center;
        }
        
        .large-time {
            font-size: 3rem;
            font-weight: 800;
            margin-bottom: 10px;
            text-shadow: 2px 2px 10px rgba(0, 0, 0, 0.2);
            letter-spacing: 2px;
        }
        
        .large-date {
            font-size: 1.6rem;
            font-weight: 600;
            margin-bottom: 30px;
            text-shadow: 1px 1px 5px rgba(0, 0, 0, 0.2);
        }
        
        .welcome-text {
            font-size: 1.3rem;
            margin-top: 40px;
            font-weight: 500;
            max-width: 300px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .login-section {
            flex: 1;
            background: rgba(255, 255, 255, 0.98);
            padding: 40px 30px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .login-logo {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .login-logo h1 {
            font-size: 2rem;
            background: var(--login-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }
        
        .login-logo p {
            color: var(--gray);
            font-size: 0.9rem;
        }
        
        .login-form {
            width: 100%;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
            font-size: 0.9rem;
        }
        
        input {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 0.9rem;
            transition: all 0.3s;
            background: white;
        }
        
        input:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(106, 17, 203, 0.2);
            transform: translateY(-2px);
        }
        
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 14px 28px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
            width: 100%;
            justify-content: center;
        }
        
        .btn-primary {
            background: var(--login-gradient);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(106, 17, 203, 0.3);
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 10px;
            color: white;
            font-weight: 600;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 10px;
            transform: translateX(150%);
            transition: transform 0.3s;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.success {
            background: linear-gradient(135deg, var(--success), #00a085);
        }
        
        .notification.error {
            background: linear-gradient(135deg, var(--danger), #d63031);
        }
        
        .notification.warning {
            background: linear-gradient(135deg, var(--warning), #e17055);
        }
        
        .today-history-section {
            background: rgba(255, 255, 255, 0.98);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            margin-top: 30px;
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
            backdrop-filter: blur(5px);
        }
        
        .today-history-section h2 {
            text-align: center;
            margin-bottom: 20px;
            color: var(--dark);
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .history-container {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #eee;
            border-radius: 10px;
            padding: 15px;
        }
        
        .history-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85rem;
        }
        
        .history-table th {
            text-align: left;
            padding: 12px 15px;
            background-color: #f8f9fa;
            color: var(--dark);
            font-weight: 600;
            border-bottom: 2px solid #eee;
            position: sticky;
            top: 0;
            background: #f8f9fa;
        }
        
        .history-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
        }
        
        .history-table tr:last-child td {
            border-bottom: none;
        }
        
        .history-table tr:hover {
            background-color: #f8f9fa;
        }
        
        .status-active {
            color: var(--success);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .status-completed {
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .duration-over {
            color: var(--danger);
            font-weight: 600;
        }
        
        @media (max-width: 992px) {
            .login-container {
                flex-direction: column;
                max-width: 600px;
            }
            
            .login-time-section {
                padding: 30px 20px;
                min-height: 250px;
            }
            
            .large-time {
                font-size: 2.5rem;
            }
            
            .large-date {
                font-size: 1.4rem;
            }
            
            .analog-clock {
                width: 150px;
                height: 150px;
            }
            
            .welcome-text {
                font-size: 1.2rem;
                margin-top: 20px;
            }
            
            .login-section {
                padding: 30px 25px;
            }
            
            .today-history-section {
                padding: 20px;
            }
        }
        
        @media (max-width: 768px) {
            .history-container {
                overflow-x: auto;
            }
            
            .history-table {
                min-width: 600px;
            }
        }

        /* Styles untuk aplikasi utama (dashboard) */
        .app-wrapper {
            display: flex;
            min-height: 90vh;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.2);
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(5px);
        }
        
        .sidebar {
            width: 280px;
            background: var(--sidebar-gradient);
            padding: 20px 15px;
            color: white;
            display: flex;
            flex-direction: column;
        }
        
        .sidebar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .logo {
            text-align: center;
            flex-grow: 1;
        }
        
        .logo h1 {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .logo p {
            font-size: 0.8rem;
            opacity: 0.8;
        }
        
        .logout-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            border-radius: 8px;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .logout-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }
        
        .user-info {
            text-align: center;
            margin-bottom: 25px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
        }
        
        .user-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            margin: 0 auto 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }
        
        .user-details h2 {
            font-size: 1.1rem;
            margin-bottom: 5px;
        }
        
        .user-details p {
            font-size: 0.8rem;
            opacity: 0.8;
        }
        
        .role-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.7rem;
            font-weight: 600;
            margin-top: 8px;
            background: rgba(255, 255, 255, 0.2);
        }
        
        .nav-menu {
            list-style: none;
            flex-grow: 1;
        }
        
        .nav-item {
            margin-bottom: 8px;
        }
        
        .nav-link {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 15px;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        
        .nav-link:hover, .nav-link.active {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .nav-link i {
            font-size: 1rem;
            width: 20px;
            text-align: center;
        }
        
        .main-content {
            flex-grow: 1;
            background: white;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }
        
        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .dashboard-title h2 {
            font-size: 1.5rem;
            color: var(--dark);
        }
        
        .dashboard-title p {
            color: var(--gray);
            font-size: 0.9rem;
        }
        
        .date-time {
            text-align: right;
        }
        
        .date-time .date {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--dark);
        }
        
        .date-time .time {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--primary);
        }
        
        .permission-section {
            background: var(--card-gradient);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            margin-bottom: 20px;
            border: 1px solid rgba(0, 0, 0, 0.05);
        }
        
        .permission-header {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .permission-header h3 {
            font-size: 1.5rem;
            color: var(--dark);
            margin-bottom: 8px;
        }
        
        .permission-header p {
            color: var(--gray);
            max-width: 600px;
            margin: 0 auto;
            font-size: 0.9rem;
        }
        
        .permission-card {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 20px;
            border: 1px solid rgba(0, 0, 0, 0.05);
        }
        
        .timer {
            font-size: 3rem;
            font-weight: 700;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            text-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            background: var(--timer-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .timer.warning {
            background: var(--timer-warning);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .timer.danger {
            background: var(--timer-danger);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .btn-group {
            display: flex;
            gap: 12px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 15px;
        }
        
        .btn-success {
            background: linear-gradient(135deg, var(--success), #00a085);
            color: white;
        }
        
        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 184, 148, 0.4);
        }
        
        .btn-warning {
            background: linear-gradient(135deg, var(--warning), #e17055);
            color: white;
        }
        
        .btn-warning:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(253, 203, 110, 0.4);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, var(--danger), #d63031);
            color: white;
        }
        
        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(231, 76, 60, 0.4);
        }
        
        .btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .dashboard-content {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            flex-grow: 1;
        }
        
        .left-column {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .right-column {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
        }
        
        .stat-card {
            background: var(--card-gradient);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            text-align: center;
            transition: transform 0.3s;
            border: 1px solid rgba(0, 0, 0, 0.05);
        }
        
        .stat-card:hover {
            transform: translateY(-3px);
        }
        
        .stat-card i {
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        .stat-card.kapten i {
            color: var(--kapten);
        }
        
        .stat-card.cs i {
            color: var(--cs);
        }
        
        .stat-card.kasir i {
            color: var(--kasir);
        }
        
        .stat-card.cs-line i {
            color: var(--cs-line);
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            margin: 8px 0;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: var(--gray);
        }
        
        .active-exits-section, .history-section {
            background: var(--card-gradient);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(0, 0, 0, 0.05);
        }
        
        .active-exits-section h3, .history-section h3 {
            margin-bottom: 15px;
            font-size: 1.3rem;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .active-exits-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 12px;
        }
        
        .active-exit-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
            border-left: 4px solid var(--success);
            display: flex;
            align-items: center;
            gap: 12px;
            transition: transform 0.3s;
        }
        
        .active-exit-card:hover {
            transform: translateY(-2px);
        }
        
        .active-exit-card.cs-line {
            border-left-color: var(--cs-line);
        }
        
        .active-exit-card.kapten {
            border-left-color: var(--kapten);
        }
        
        .active-exit-card.cs {
            border-left-color: var(--cs);
        }
        
        .active-exit-card.kasir {
            border-left-color: var(--kasir);
        }
        
        .exit-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #f1f2f6;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
        }
        
        .exit-info h4 {
            font-size: 0.9rem;
            margin-bottom: 5px;
        }
        
        .exit-info p {
            font-size: 0.7rem;
            color: var(--gray);
        }
        
        .exit-timer {
            margin-left: auto;
            font-family: 'Courier New', monospace;
            font-weight: 700;
            font-size: 0.9rem;
            color: var(--success);
        }
        
        .progress-container {
            margin-top: 10px;
        }
        
        .progress-bar {
            height: 6px;
            background: #e9ecef;
            border-radius: 3px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            border-radius: 3px;
            transition: width 0.5s;
        }
        
        .progress-kapten {
            background: linear-gradient(135deg, var(--kapten), #8e44ad);
        }
        
        .progress-cs {
            background: linear-gradient(135deg, var(--cs), #2980b9);
        }
        
        .progress-kasir {
            background: linear-gradient(135deg, var(--kasir), #16a085);
        }
        
        .progress-cs-line {
            background: linear-gradient(135deg, var(--cs-line), #c0392b);
        }
        
        .progress-text {
            display: flex;
            justify-content: space-between;
            font-size: 0.7rem;
            margin-top: 3px;
            color: var(--gray);
        }
        
        .empty-state {
            text-align: center;
            padding: 20px;
            color: var(--gray);
        }
        
        .empty-state i {
            font-size: 2rem;
            margin-bottom: 10px;
            opacity: 0.5;
        }
        
        .user-quota {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            margin-top: 10px;
            font-weight: 600;
            color: var(--dark);
            font-size: 0.9rem;
        }
        
        .reset-btn {
            margin-top: 10px;
            background: linear-gradient(135deg, #fd79a8, #e84393);
            color: white;
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s;
        }
        
        .reset-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(253, 121, 168, 0.3);
        }
        
        /* Styling untuk halaman reset admin */
        .reset-admin-section {
            background: var(--card-gradient);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            margin-bottom: 20px;
            border: 1px solid rgba(0, 0, 0, 0.05);
        }
        
        .reset-admin-header {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .reset-admin-header h3 {
            font-size: 1.5rem;
            color: var(--dark);
            margin-bottom: 8px;
        }
        
        .reset-admin-header p {
            color: var(--gray);
            max-width: 600px;
            margin: 0 auto;
            font-size: 0.9rem;
        }
        
        .admin-controls {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
            margin-bottom: 20px;
        }
        
        .admin-controls .btn {
            width: auto;
            padding: 12px 20px;
        }
        
        .admin-active-exits {
            margin-top: 20px;
        }
        
        .admin-exit-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
            border-left: 4px solid var(--success);
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            margin-bottom: 10px;
        }
        
        .admin-exit-card.cs-line {
            border-left-color: var(--cs-line);
        }
        
        .admin-exit-card.kapten {
            border-left-color: var(--kapten);
        }
        
        .admin-exit-card.cs {
            border-left-color: var(--cs);
        }
        
        .admin-exit-card.kasir {
            border-left-color: var(--kasir);
        }
        
        .admin-exit-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .admin-exit-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #f1f2f6;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
        }
        
        .admin-exit-details h4 {
            font-size: 0.9rem;
            margin-bottom: 5px;
        }
        
        .admin-exit-details p {
            font-size: 0.7rem;
            color: var(--gray);
        }
        
        .admin-exit-timer {
            font-family: 'Courier New', monospace;
            font-weight: 700;
            font-size: 0.9rem;
            color: var(--success);
            margin-right: 15px;
        }
        
        .admin-exit-actions {
            display: flex;
            gap: 8px;
        }
        
        .admin-exit-actions .btn {
            padding: 8px 12px;
            font-size: 0.8rem;
            width: auto;
        }
        
        .access-denied {
            text-align: center;
            padding: 40px;
            color: var(--gray);
        }
        
        .access-denied i {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.5;
        }
        
        .access-denied h3 {
            font-size: 1.5rem;
            margin-bottom: 10px;
            color: var(--danger);
        }
        
        .access-denied p {
            font-size: 1rem;
            max-width: 500px;
            margin: 0 auto;
        }

        /* Styles untuk halaman lain */
        .page {
            background: var(--card-gradient);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            margin-bottom: 20px;
            border: 1px solid rgba(0, 0, 0, 0.05);
        }
        
        .page-header {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .page-header h3 {
            font-size: 1.5rem;
            color: var(--dark);
            margin-bottom: 8px;
        }
        
        .page-header p {
            color: var(--gray);
            max-width: 600px;
            margin: 0 auto;
            font-size: 0.9rem;
        }
        
        .settings-form {
            max-width: 500px;
            margin: 0 auto;
        }
        
        .settings-option {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .settings-option label {
            margin-bottom: 0;
            font-weight: 500;
        }
        
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: var(--primary);
        }
        
        input:checked + .slider:before {
            transform: translateX(26px);
        }
        
        .staff-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .staff-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
            text-align: center;
            transition: transform 0.3s;
        }
        
        .staff-card:hover {
            transform: translateY(-2px);
        }
        
        .staff-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--primary);
            margin: 0 auto 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
        }
        
        .staff-name {
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .staff-role {
            font-size: 0.8rem;
            color: var(--gray);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .stat-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
            text-align: center;
        }
        
        .stat-item .value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .stat-item .label {
            font-size: 0.9rem;
            color: var(--gray);
        }
        
        @media (max-width: 1200px) {
            .dashboard-content {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="notification" id="notification"></div>
        
        <!-- Tampilan Login -->
        <div class="login-container" id="loginContainer">
            <div class="login-time-section">
                <div class="time-content">
                    <div class="clock-container">
                        <div class="analog-clock">
                            <div class="clock-face">
                                <div class="hand hour-hand"></div>
                                <div class="hand min-hand"></div>
                                <div class="hand second-hand"></div>
                            </div>
                        </div>
                        <div class="digital-clock">
                            <div class="large-time" id="largeTimeLogin">00:00:00</div>
                            <div class="large-date" id="largeDateLogin">Senin, 1 Januari 2023</div>
                        </div>
                    </div>
                    <div class="welcome-text">Selamat Datang di Sistem Izin Staf LINETOGEL</div>
                </div>
            </div>
            
            <div class="login-section">
                <div class="login-logo">
                    <h1><i class="fas fa-user-clock"></i> Izin Staf LINETOGEL</h1>
                    <p>Sistem Izin Keluar Staf Terpadu</p>
                </div>
                <form class="login-form" id="loginForm">
                    <div class="form-group">
                        <label for="username"><i class="fas fa-user"></i> Nama Pengguna</label>
                        <input type="text" id="username" placeholder="Masukkan nama pengguna" required>
                    </div>
                    <div class="form-group">
                        <label for="password"><i class="fas fa-lock"></i> Kata Sandi</label>
                        <input type="password" id="password" placeholder="Masukkan kata sandi" required>
                    </div>
                    <button type="submit" class="btn btn-primary"><i class="fas fa-sign-in-alt"></i> Masuk</button>
                </form>
            </div>
        </div>
        
        <!-- Dashboard Riwayat Hari Ini (Tampil di Halaman Login) -->
        <div class="today-history-section" id="todayHistorySection">
            <h2><i class="fas fa-history"></i> Riwayat Izin Hari Ini</h2>
            <div class="history-container">
                <table class="history-table">
                    <thead>
                        <tr>
                            <th>Nama</th>
                            <th>Jabatan</th>
                            <th>Waktu Keluar</th>
                            <th>Durasi</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="todayHistoryList">
                        <!-- Riwayat hari ini akan diisi oleh JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Aplikasi Utama (Dashboard) -->
        <div class="app-wrapper" id="appWrapper" style="display: none;">
            <div class="sidebar">
                <div class="sidebar-header">
                    <div class="logo">
                        <h1><i class="fas fa-user-clock"></i> Izin Staf</h1>
                        <p>Dashboard Izin Keluar</p>
                    </div>
                    <button class="logout-btn" id="logoutBtn" title="Keluar">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </div>
                
                <div class="user-info">
                    <div class="user-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="user-details">
                        <h2 id="userName">Nama Pengguna</h2>
                        <p id="userRole">Peran: -</p>
                        <div class="role-badge" id="userRoleBadge">Peran</div>
                    </div>
                </div>
                
                <ul class="nav-menu">
                    <li class="nav-item">
                        <a href="#" class="nav-link active" data-page="dashboard">
                            <i class="fas fa-home"></i>
                            <span>Dashboard</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" data-page="permission">
                            <i class="fas fa-door-open"></i>
                            <span>Izin Keluar</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" data-page="history">
                            <i class="fas fa-history"></i>
                            <span>Riwayat</span>
                        </a>
                    </li>
                    <li class="nav-item cs-line-only" style="display: none;">
                        <a href="#" class="nav-link" data-page="reset-admin">
                            <i class="fas fa-user-cog"></i>
                            <span>Reset Admin</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" data-page="settings">
                            <i class="fas fa-cog"></i>
                            <span>Pengaturan</span>
                        </a>
                    </li>
                </ul>
            </div>
            
            <div class="main-content">
                <!-- Dashboard Utama -->
                <div class="dashboard-content" id="dashboardPage">
                    <div class="dashboard-header">
                        <div class="dashboard-title">
                            <h2>Dashboard Izin Keluar LINETOGEL</h2>
                            <p>Kelola izin keluar dengan batas waktu 15 menit</p>
                        </div>
                        <div class="date-time">
                            <div class="date" id="currentDate">Senin, 1 Januari 2023</div>
                            <div class="time" id="currentTime">00:00:00</div>
                        </div>
                    </div>
                    
                    <div class="permission-section">
                        <div class="permission-header">
                            <h3><i class="fas fa-door-open"></i> Izin Keluar</h3>
                            <p>Anda memiliki waktu 15 menit untuk keluar. Hitungan mundur akan dimulai setelah Anda mengajukan izin.</p>
                        </div>
                        
                        <div class="permission-card">
                            <div class="timer" id="timer">15:00</div>
                            <div class="user-quota">
                                Sisa Izin: <strong id="remainingExits">0</strong>/<strong id="maxExits">0</strong>
                            </div>
                            
                            <div class="btn-group">
                                <button class="btn btn-success" id="requestBtn"><i class="fas fa-paper-plane"></i> Ajukan Izin Keluar</button>
                                <button class="btn btn-warning" id="returnBtn" disabled><i class="fas fa-undo"></i> Kembali</button>
                            </div>
                            <div style="margin-top: 10px;" id="resetTimerContainer">
                                <!-- Tombol reset akan ditambahkan di sini hanya untuk CS LINE -->
                            </div>
                        </div>
                    </div>
                    
                    <div class="dashboard-content">
                        <div class="left-column">
                            <div class="stats-container">
                                <div class="stat-card kapten">
                                    <i class="fas fa-user-shield"></i>
                                    <div class="stat-value" id="kaptenOnline">0</div>
                                    <div class="stat-label">Kapten Kasir Online</div>
                                    <div class="progress-container">
                                        <div class="progress-bar">
                                            <div class="progress-fill progress-kapten" id="kaptenProgress" style="width: 0%"></div>
                                        </div>
                                        <div class="progress-text">
                                            <span id="kaptenCount">0/2</span>
                                            <span>Batas</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="stat-card cs">
                                    <i class="fas fa-headset"></i>
                                    <div class="stat-value" id="csOnline">0</div>
                                    <div class="stat-label">CS Online</div>
                                    <div class="progress-container">
                                        <div class="progress-bar">
                                            <div class="progress-fill progress-cs" id="csProgress" style="width: 0%"></div>
                                        </div>
                                        <div class="progress-text">
                                            <span id="csCount">0/3</span>
                                            <span>Batas</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="stat-card kasir">
                                    <i class="fas fa-cash-register"></i>
                                    <div class="stat-value" id="kasirOnline">0</div>
                                    <div class="stat-label">Kasir Online</div>
                                    <div class="progress-container">
                                        <div class="progress-bar">
                                            <div class="progress-fill progress-kasir" id="kasirProgress" style="width: 0%"></div>
                                        </div>
                                        <div class="progress-text">
                                            <span id="kasirCount">0/3</span>
                                            <span>Batas</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="stat-card cs-line">
                                    <i class="fas fa-users"></i>
                                    <div class="stat-value" id="csLineOnline">0</div>
                                    <div class="stat-label">CS Line Aktif</div>
                                    <div class="progress-container">
                                        <div class="progress-bar">
                                            <div class="progress-fill progress-cs-line" id="csLineProgress" style="width: 0%"></div>
                                        </div>
                                        <div class="progress-text">
                                            <span id="csLineCount">0/1</span>
                                            <span>Batas</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="active-exits-section">
                                <h3><i class="fas fa-walking"></i> Staf Sedang Keluar</h3>
                                <div class="active-exits-list" id="activeExitsList">
                                    <!-- Daftar staf yang sedang keluar akan diisi oleh JavaScript -->
                                </div>
                            </div>
                        </div>
                        
                        <div class="right-column">
                            <div class="history-section">
                                <h3><i class="fas fa-history"></i> Riwayat Izin Hari Ini</h3>
                                <div class="history-container">
                                    <table class="history-table">
                                        <thead>
                                            <tr>
                                                <th>Nama</th>
                                                <th>Jabatan</th>
                                                <th>Waktu Keluar</th>
                                                <th>Durasi</th>
                                                <th>Status</th>
                                            </tr>
                                        </thead>
                                        <tbody id="historyList">
                                            <!-- Riwayat akan diisi oleh JavaScript -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Halaman Izin Keluar -->
                <div class="page" id="permissionPage" style="display: none;">
                    <div class="page-header">
                        <h3><i class="fas fa-door-open"></i> Izin Keluar</h3>
                        <p>Kelola izin keluar staf dengan batas waktu 15 menit</p>
                    </div>
                    
                    <div class="permission-card">
                        <div class="timer" id="permissionTimer">15:00</div>
                        <div class="user-quota">
                            Sisa Izin: <strong id="permissionRemainingExits">0</strong>/<strong id="permissionMaxExits">0</strong>
                        </div>
                        
                        <div class="btn-group">
                            <button class="btn btn-success" id="permissionRequestBtn"><i class="fas fa-paper-plane"></i> Ajukan Izin Keluar</button>
                            <button class="btn btn-warning" id="permissionReturnBtn" disabled><i class="fas fa-undo"></i> Kembali</button>
                        </div>
                    </div>
                    
                    <div class="active-exits-section">
                        <h3><i class="fas fa-walking"></i> Staf Sedang Keluar</h3>
                        <div class="active-exits-list" id="permissionActiveExitsList">
                            <!-- Daftar staf yang sedang keluar akan diisi oleh JavaScript -->
                        </div>
                    </div>
                </div>
                
                <!-- Halaman Riwayat -->
                <div class="page" id="historyPage" style="display: none;">
                    <div class="page-header">
                        <h3><i class="fas fa-history"></i> Riwayat Izin</h3>
                        <p>Lihat riwayat izin keluar staf</p>
                    </div>
                    
                    <div class="history-container">
                        <table class="history-table">
                            <thead>
                                <tr>
                                    <th>Nama</th>
                                    <th>Jabatan</th>
                                    <th>Waktu Keluar</th>
                                    <th>Durasi</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="historyPageList">
                                <!-- Riwayat akan diisi oleh JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Halaman Reset Admin (Hanya untuk CS LINE) -->
                <div class="reset-admin-section" id="resetAdminPage" style="display: none;">
                    <div class="reset-admin-header">
                        <h3><i class="fas fa-user-cog"></i> Panel Reset Admin</h3>
                        <p>Hanya CS LINE yang dapat mengakses fitur reset izin keluar</p>
                    </div>
                    
                    <div id="adminAccessDenied" style="display: none;">
                        <div class="access-denied">
                            <i class="fas fa-lock"></i>
                            <h3>Akses Ditolak</h3>
                            <p>Anda tidak memiliki izin untuk mengakses halaman ini. Hanya CS LINE yang dapat mengakses panel reset admin.</p>
                            <button class="btn btn-primary" id="backToDashboardBtn" style="margin-top: 20px; width: auto;">
                                <i class="fas fa-arrow-left"></i> Kembali ke Dashboard
                            </button>
                        </div>
                    </div>
                    
                    <div id="adminControls" style="display: none;">
                        <div class="admin-controls">
                            <button class="btn btn-danger" id="resetAllTimersBtn">
                                <i class="fas fa-sync-alt"></i> Reset Semua Timer
                            </button>
                            <button class="btn btn-warning" id="resetExpiredTimersBtn">
                                <i class="fas fa-clock"></i> Reset Timer Kadaluarsa
                            </button>
                            <button class="btn btn-primary" id="refreshAdminDataBtn">
                                <i class="fas fa-redo"></i> Refresh Data
                            </button>
                        </div>
                        
                        <div class="admin-active-exits">
                            <h3><i class="fas fa-walking"></i> Staf Sedang Keluar</h3>
                            <div id="adminActiveExitsList">
                                <!-- Daftar staf yang sedang keluar untuk admin -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Halaman Pengaturan -->
                <div class="page" id="settingsPage" style="display: none;">
                    <div class="page-header">
                        <h3><i class="fas fa-cog"></i> Pengaturan</h3>
                        <p>Kelola pengaturan akun dan sistem</p>
                    </div>
                    
                    <div class="settings-form">
                        <div class="form-group">
                            <label for="currentPassword">Kata Sandi Saat Ini</label>
                            <input type="password" id="currentPassword" placeholder="Masukkan kata sandi saat ini">
                        </div>
                        
                        <div class="form-group">
                            <label for="newPassword">Kata Sandi Baru</label>
                            <input type="password" id="newPassword" placeholder="Masukkan kata sandi baru">
                        </div>
                        
                        <div class="form-group">
                            <label for="confirmPassword">Konfirmasi Kata Sandi Baru</label>
                            <input type="password" id="confirmPassword" placeholder="Konfirmasi kata sandi baru">
                        </div>
                        
                        <button class="btn btn-primary" id="changePasswordBtn">
                            <i class="fas fa-key"></i> Ubah Kata Sandi
                        </button>
                    </div>
                    
                    <div style="margin-top: 30px;">
                        <h4><i class="fas fa-bell"></i> Notifikasi</h4>
                        
                        <div class="settings-option">
                            <label for="emailNotifications">Notifikasi Email</label>
                            <label class="toggle-switch">
                                <input type="checkbox" id="emailNotifications" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-option">
                            <label for="pushNotifications">Notifikasi Push</label>
                            <label class="toggle-switch">
                                <input type="checkbox" id="pushNotifications" checked>
                                <span class="slider"></span>
                            </label>
                        </div>
                        
                        <div class="settings-option">
                            <label for="soundNotifications">Notifikasi Suara</label>
                            <label class="toggle-switch">
                                <input type="checkbox" id="soundNotifications">
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Data staf dengan batas maksimal 4 kali untuk semua jabatan
        const staffData = [
            { fullName: "WIDJAYA", username: "WIDJAYA", password: "1", role: "CS", maxExits: 4 },
            { fullName: "DAVID", username: "DAVID", password: "1", role: "CS", maxExits: 4 },
            { fullName: "FALLEN HARDINANSAH TAJU", username: "FALLEN", password: "1", role: "CS", maxExits: 4 },
            { fullName: "CHARLIE", username: "CHARLIE", password: "1", role: "CS LINE", maxExits: 4 },
            { fullName: "HARIANTO", username: "HARIANTO", password: "1", role: "CS", maxExits: 4 },
            { fullName: "RINAL ABDILLAH NASUTION", username: "RINAL", password: "1", role: "CS LINE", maxExits: 4 },
            { fullName: "ERI HARIANTO", username: "ERI", password: "1", role: "CS", maxExits: 4 },
            { fullName: "MAHENDRAN", username: "MAHENDRAN", password: "1", role: "CS", maxExits: 4 },
            { fullName: "ANDHIKA DWI PUTRA", username: "ANDHIKA", password: "1", role: "CS", maxExits: 4 },
            { fullName: "TOMMY HASIM", username: "TOMMY", password: "1", role: "CS", maxExits: 4 },
            { fullName: "EGI SETIAWAN", username: "EGI", password: "1", role: "CS", maxExits: 4 },
            { fullName: "RANJIT", username: "RANJIT", password: "1", role: "CS", maxExits: 4 },
            { fullName: "WILLY PERAYUDA", username: "WILLY", password: "1", role: "CS", maxExits: 4 },
            { fullName: "ANDI", username: "ANDI", password: "1", role: "CS LINE", maxExits: 4 },
            { fullName: "ALFINO MUKTI", username: "ALFINO", password: "1", role: "CS", maxExits: 4 },
            { fullName: "AKAS FARMA", username: "AKAS", password: "1", role: "CS", maxExits: 4 },
            { fullName: "ARI ROMANDUS FERNAND", username: "ARI", password: "1", role: "CS", maxExits: 4 },
            { fullName: "PARIS AMRULLOH", username: "PARIS", password: "1", role: "CS", maxExits: 4 },
            { fullName: "SAMSUL MAARIF", username: "SAMSUL", password: "1", role: "CS", maxExits: 4 },
            { fullName: "SUHAN RAZ", username: "SUHAN", password: "1", role: "CS", maxExits: 4 },
            { fullName: "RAHMADI SORMIN", username: "RAHMADI", password: "1", role: "CS", maxExits: 4 },
            { fullName: "NOVAL MUTTAWALI HAKIM", username: "NOVAL", password: "1", role: "CS", maxExits: 4 },
            { fullName: "JONROMAN PURBA", username: "JONROMAN", password: "1", role: "TR CS", maxExits: 4 },
            { fullName: "PUTRA ANUGRAH RIZKI", username: "PUTRA", password: "1", role: "TR CS", maxExits: 4 },
            { fullName: "WILIAM", username: "WILIAM", password: "1", role: "Kapten Kasir", maxExits: 4 },
            { fullName: "FIQAL KANA", username: "FIQAL", password: "1", role: "Kapten Kasir", maxExits: 4 },
            { fullName: "MARJOKI SANG", username: "MARJOKI", password: "1", role: "Kapten Kasir", maxExits: 4 },
            { fullName: "DANIEL", username: "DANIEL", password: "1", role: "Kapten Kasir", maxExits: 4 },
            { fullName: "RAAZ JESEN STEPANUS", username: "RAAZ", password: "1", role: "Kapten Kasir", maxExits: 4 },
            { fullName: "MAHAT SANJAYA HARAHAP", username: "MAHAT", password: "1", role: "Kapten Kasir", maxExits: 4 },
            { fullName: "ANNEN", username: "ANNEN", password: "1", role: "Kasir", maxExits: 4 },
            { fullName: "M FAJAR SIDDIK", username: "FAJAR", password: "1", role: "Kasir", maxExits: 4 },
            { fullName: "PUTRA RAMADHANI", username: "PUTRA", password: "1", role: "Kasir", maxExits: 4 },
            { fullName: "AMRUL", username: "AMRUL", password: "1", role: "Kasir", maxExits: 4 },
            { fullName: "RAM KIRAN", username: "RAM", password: "1", role: "Kasir", maxExits: 4 },
            { fullName: "BOBY KASANDRA BANCIN", username: "BOBY", password: "1", role: "Kasir", maxExits: 4 },
            { fullName: "KIKI YUNITA", username: "KIKI", password: "1", role: "Kasir", maxExits: 4 },
            { fullName: "CHARLOIPO MANULLANG", username: "CHARLOIPO", password: "1", role: "Kasir", maxExits: 4 },
            { fullName: "FAHRI FIRMANSYAH", username: "FAHRI", password: "1", role: "Kasir", maxExits: 4 },
            { fullName: "GALI PRATAMA", username: "GALI", password: "1", role: "Kasir", maxExits: 4 },
            { fullName: "PRIMA NUGRAHA", username: "PRIMA", password: "1", role: "Kasir", maxExits: 4 },
            { fullName: "ROY DILEN", username: "ROY", password: "1", role: "Kasir", maxExits: 4 },
            { fullName: "RIDZKY RAMADHAN", username: "RIDZKY", password: "1", role: "Kasir", maxExits: 4 },
            { fullName: "AGUNG DEDI IRAWAN", username: "AGUNG", password: "1", role: "Kasir", maxExits: 4 },
            { fullName: "MAICEL TAMPUBOLON", username: "MAICEL", password: "1", role: "Kasir", maxExits: 4 },
            { fullName: "ADE CHAIRUNNISA", username: "ADE", password: "1", role: "Kasir", maxExits: 4 },
            { fullName: "M REZI SYAPUTRA", username: "REZI", password: "1", role: "Kasir", maxExits: 4 },
            { fullName: "KHOIRUDDIN", username: "KHOIRUDDIN", password: "1", role: "Kasir", maxExits: 4 },
            { fullName: "BAMBANG AGUNG SUTRISNO", username: "BAMBANG", password: "1", role: "Kasir", maxExits: 4 },
            { fullName: "PUTRA INSANY", username: "PUTRA", password: "1", role: "Kasir", maxExits: 4 },
            { fullName: "FERA SALMA", username: "FERA", password: "1", role: "Kasir", maxExits: 4 },
            { fullName: "RIVLAN RIZKY", username: "RIVLAN", password: "1", role: "Kasir", maxExits: 4 },
            { fullName: "MAULANA ALI SAID", username: "MAULANA", password: "1", role: "Kasir", maxExits: 4 },
            { fullName: "AHMAD ANDIKA", username: "AHMAD", password: "1", role: "Kasir", maxExits: 4 },
            { fullName: "ANGGARA K S", username: "ANGGARA", password: "1", role: "Kasir", maxExits: 4 },
            { fullName: "DIMAS ADHITYA", username: "DIMAS", password: "1", role: "Kasir", maxExits: 4 },
            { fullName: "GABRIEL RONI ARGANTA HUTABALIAN", username: "GABRIEL", password: "1", role: "Kasir", maxExits: 4 },
            { fullName: "EGA PRAYUDA", username: "EGA", password: "1", role: "Kasir", maxExits: 4 },
            { fullName: "ARJUN PRAISYA", username: "ARJUN", password: "1", role: "Kasir", maxExits: 4 },
            { fullName: "ADITYA PANCA", username: "ADITYA", password: "1", role: "Kasir", maxExits: 4 },
            { fullName: "AUDIS OYONG DUANSYAH", username: "AUDIS", password: "1", role: "Kasir", maxExits: 4 },
            { fullName: "ADE OJI SHAPUTRA", username: "ADE", password: "1", role: "Kasir", maxExits: 4 },
            { fullName: "ALFIANSYAH", username: "ALFIANSYAH", password: "1", role: "Kasir", maxExits: 4 },
            { fullName: "ANDY PUTRA", username: "ANDY", password: "1", role: "Kasir", maxExits: 4 },
            { fullName: "JUNITA MARSHA", username: "JUNITA", password: "1", role: "Kasir", maxExits: 4 },
            { fullName: "MELAN PUTRI TRINITA", username: "MELAN", password: "1", role: "Kasir", maxExits: 4 },
            { fullName: "LAELA ANASILDA", username: "LAELA", password: "1", role: "Kasir", maxExits: 4 },
            { fullName: "ISMI AZRILIA LUBIS", username: "ISMI", password: "1", role: "Kasir", maxExits: 4 },
            { fullName: "SYARIFAH RUMIATI ASTARI", username: "SYARIFAH", password: "1", role: "Kasir", maxExits: 4 }
        ];

        // Batas keluar bersamaan per jabatan
        const maxConcurrentExits = {
            "Kapten Kasir": 2,
            "CS": 3,
            "TR CS": 3,
            "Kasir": 3,
            "CS LINE": 1
        };

        // Elemen DOM
        const loginContainer = document.getElementById('loginContainer');
        const appWrapper = document.getElementById('appWrapper');
        const loginForm = document.getElementById('loginForm');
        const usernameInput = document.getElementById('username');
        const passwordInput = document.getElementById('password');
        const userNameDisplay = document.getElementById('userName');
        const userRoleDisplay = document.getElementById('userRole');
        const userRoleBadge = document.getElementById('userRoleBadge');
        const logoutBtn = document.getElementById('logoutBtn');
        const remainingExitsDisplay = document.getElementById('remainingExits');
        const maxExitsDisplay = document.getElementById('maxExits');
        const timerDisplay = document.getElementById('timer');
        const requestBtn = document.getElementById('requestBtn');
        const returnBtn = document.getElementById('returnBtn');
        const historyList = document.getElementById('historyList');
        const activeExitsList = document.getElementById('activeExitsList');
        const kaptenOnlineDisplay = document.getElementById('kaptenOnline');
        const csOnlineDisplay = document.getElementById('csOnline');
        const kasirOnlineDisplay = document.getElementById('kasirOnline');
        const csLineOnlineDisplay = document.getElementById('csLineOnline');
        const kaptenProgress = document.getElementById('kaptenProgress');
        const csProgress = document.getElementById('csProgress');
        const kasirProgress = document.getElementById('kasirProgress');
        const csLineProgress = document.getElementById('csLineProgress');
        const kaptenCount = document.getElementById('kaptenCount');
        const csCount = document.getElementById('csCount');
        const kasirCount = document.getElementById('kasirCount');
        const csLineCount = document.getElementById('csLineCount');
        const notification = document.getElementById('notification');
        const currentDate = document.getElementById('currentDate');
        const currentTime = document.getElementById('currentTime');
        const largeTimeLogin = document.getElementById('largeTimeLogin');
        const largeDateLogin = document.getElementById('largeDateLogin');
        const todayHistoryList = document.getElementById('todayHistoryList');
        const todayHistorySection = document.getElementById('todayHistorySection');
        const resetTimerContainer = document.getElementById('resetTimerContainer');
        const resetAllTimersBtn = document.getElementById('resetAllTimersBtn');
        const resetExpiredTimersBtn = document.getElementById('resetExpiredTimersBtn');
        const refreshAdminDataBtn = document.getElementById('refreshAdminDataBtn');
        const backToDashboardBtn = document.getElementById('backToDashboardBtn');
        const adminActiveExitsList = document.getElementById('adminActiveExitsList');
        const adminAccessDenied = document.getElementById('adminAccessDenied');
        const adminControls = document.getElementById('adminControls');
        const dashboardPage = document.getElementById('dashboardPage');
        const resetAdminPage = document.getElementById('resetAdminPage');
        const permissionPage = document.getElementById('permissionPage');
        const historyPage = document.getElementById('historyPage');
        const settingsPage = document.getElementById('settingsPage');
        const permissionTimer = document.getElementById('permissionTimer');
        const permissionRemainingExits = document.getElementById('permissionRemainingExits');
        const permissionMaxExits = document.getElementById('permissionMaxExits');
        const permissionRequestBtn = document.getElementById('permissionRequestBtn');
        const permissionReturnBtn = document.getElementById('permissionReturnBtn');
        const permissionActiveExitsList = document.getElementById('permissionActiveExitsList');
        const historyPageList = document.getElementById('historyPageList');
        const changePasswordBtn = document.getElementById('changePasswordBtn');
        const navLinks = document.querySelectorAll('.nav-link');

        // Variabel global
        let currentUser = null;
        let timerInterval = null;
        let timeLeft = 15 * 60; // 15 menit dalam detik
        let activeExits = {
            "Kapten Kasir": 0,
            "CS": 0,
            "TR CS": 0,
            "Kasir": 0,
            "CS LINE": 0
        };
        let activeExitsDetail = [];
        let lastResetDate = null;

        // Inisialisasi aplikasi
        function init() {
            // Muat data aktif dari localStorage
            loadActiveExits();
            
            // Cek dan reset data jika sudah ganti hari
            checkAndResetDailyData();

            // Cek apakah ada user yang sudah login
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                showDashboard();
            } else {
                // Tampilkan riwayat hari ini di halaman login
                updateTodayHistory();
            }

            // Event listeners
            loginForm.addEventListener('submit', handleLogin);
            logoutBtn.addEventListener('click', handleLogout);
            requestBtn.addEventListener('click', handleRequestExit);
            returnBtn.addEventListener('click', handleReturn);
            permissionRequestBtn.addEventListener('click', handleRequestExit);
            permissionReturnBtn.addEventListener('click', handleReturn);
            resetAllTimersBtn.addEventListener('click', resetAllTimers);
            resetExpiredTimersBtn.addEventListener('click', resetExpiredTimers);
            refreshAdminDataBtn.addEventListener('click', refreshAdminData);
            backToDashboardBtn.addEventListener('click', showDashboardPage);
            changePasswordBtn.addEventListener('click', handleChangePassword);

            // Navigation
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const page = this.getAttribute('data-page');
                    showPage(page);
                });
            });

            // Update waktu dan tanggal
            updateDateTime();
            setInterval(updateDateTime, 1000);

            // Update jam analog
            setAnalogClock();
            setInterval(setAnalogClock, 1000);

            // Update tampilan aktif setiap detik
            setInterval(updateActiveExitsDisplay, 1000);
            
            // Update riwayat hari ini setiap 5 detik
            setInterval(updateTodayHistory, 5000);
        }

        // Fungsi untuk mengatur jam analog
        function setAnalogClock() {
            const now = new Date();
            const seconds = now.getSeconds();
            const minutes = now.getMinutes();
            const hours = now.getHours() % 12;

            const secondHand = document.querySelector('.second-hand');
            const minuteHand = document.querySelector('.min-hand');
            const hourHand = document.querySelector('.hour-hand');

            const secondsDegrees = ((seconds / 60) * 360) + 90;
            const minutesDegrees = ((minutes / 60) * 360) + ((seconds/60)*6) + 90;
            const hoursDegrees = ((hours / 12) * 360) + ((minutes/60)*30) + 90;

            secondHand.style.transform = `rotate(${secondsDegrees}deg)`;
            minuteHand.style.transform = `rotate(${minutesDegrees}deg)`;
            hourHand.style.transform = `rotate(${hoursDegrees}deg)`;
        }

        // Tampilkan halaman tertentu
        function showPage(page) {
            // Sembunyikan semua halaman
            dashboardPage.style.display = 'none';
            resetAdminPage.style.display = 'none';
            permissionPage.style.display = 'none';
            historyPage.style.display = 'none';
            settingsPage.style.display = 'none';
            
            // Hapus class active dari semua nav link
            navLinks.forEach(link => {
                link.classList.remove('active');
            });
            
            // Tambah class active ke nav link yang sesuai
            document.querySelector(`.nav-link[data-page="${page}"]`).classList.add('active');
            
            // Tampilkan halaman yang dipilih
            if (page === 'dashboard') {
                dashboardPage.style.display = 'block';
            } else if (page === 'permission') {
                permissionPage.style.display = 'block';
                updatePermissionPage();
            } else if (page === 'history') {
                historyPage.style.display = 'block';
                updateHistoryPage();
            } else if (page === 'reset-admin') {
                showResetAdminPage();
            } else if (page === 'settings') {
                settingsPage.style.display = 'block';
            }
        }

        // Update halaman permission
        function updatePermissionPage() {
            if (!currentUser) return;
            
            permissionRemainingExits.textContent = currentUser.remainingExits;
            permissionMaxExits.textContent = currentUser.maxExits;
            permissionTimer.textContent = timerDisplay.textContent;
            
            // Update status tombol
            if (currentUser.remainingExits <= 0 || timerInterval || activeExits[currentUser.role] >= maxConcurrentExits[currentUser.role]) {
                permissionRequestBtn.disabled = true;
            } else {
                permissionRequestBtn.disabled = false;
            }
            
            permissionReturnBtn.disabled = !timerInterval;
            
            // Update daftar aktif
            updatePermissionActiveExits();
        }

        // Update daftar aktif di halaman permission
        function updatePermissionActiveExits() {
            permissionActiveExitsList.innerHTML = '';
            
            if (activeExitsDetail.length === 0) {
                const emptyState = document.createElement('div');
                emptyState.className = 'empty-state';
                emptyState.innerHTML = `
                    <i class="fas fa-users-slash"></i>
                    <p>Tidak ada staf yang sedang keluar</p>
                `;
                permissionActiveExitsList.appendChild(emptyState);
                return;
            }
            
            activeExitsDetail.forEach(exit => {
                const minutes = Math.floor(exit.remainingTime / 60);
                const seconds = exit.remainingTime % 60;
                const timeDisplay = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                const exitCard = document.createElement('div');
                exitCard.className = `active-exit-card ${exit.role.toLowerCase().replace(' ', '-')}`;
                
                exitCard.innerHTML = `
                    <div class="exit-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="exit-info">
                        <h4>${exit.fullName}</h4>
                        <p>${exit.role}</p>
                    </div>
                    <div class="exit-timer">${timeDisplay}</div>
                `;
                
                permissionActiveExitsList.appendChild(exitCard);
            });
        }

        // Update halaman history
        function updateHistoryPage() {
            if (!currentUser) return;
            
            historyPageList.innerHTML = '';
            
            if (currentUser.history.length === 0) {
                const emptyRow = document.createElement('tr');
                emptyRow.innerHTML = `
                    <td colspan="5" style="text-align: center; padding: 20px; color: #7f8c8d; font-style: italic;">
                        <i class="fas fa-inbox" style="font-size: 1.5rem; margin-bottom: 10px; display: block; opacity: 0.5;"></i>
                        Belum ada riwayat izin keluar
                    </td>
                `;
                historyPageList.appendChild(emptyRow);
                return;
            }
            
            currentUser.history.forEach(record => {
                const historyRow = document.createElement('tr');
                
                let durationText = record.duration;
                let statusHTML = '';
                let durationClass = '';
                
                // Hitung durasi sebenarnya
                let actualDuration = 0;
                if (record.status === 'active') {
                    const now = new Date().getTime();
                    actualDuration = Math.round((now - record.startTime) / 60000);
                    durationText = `${actualDuration} menit`;
                    statusHTML = `<span class="status-active"><i class="fas fa-running"></i> Aktif</span>`;
                } else {
                    // Parse durasi dari string
                    const match = record.duration.match(/(\d+)\s*menit/);
                    if (match) {
                        actualDuration = parseInt(match[1]);
                    }
                    statusHTML = `<span class="status-completed"><i class="fas fa-check-circle"></i> Selesai</span>`;
                }
                
                // Tandai dengan warna merah jika melebihi 15 menit
                if (actualDuration > 15) {
                    durationClass = 'duration-over';
                }
                
                historyRow.innerHTML = `
                    <td>${record.fullName}</td>
                    <td>${record.role}</td>
                    <td>${record.startTimeFormatted || new Date(record.startTime).toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' })}</td>
                    <td class="${durationClass}">${durationText}</td>
                    <td>${statusHTML}</td>
                `;
                
                historyPageList.appendChild(historyRow);
            });
        }

        // Tampilkan halaman dashboard
        function showDashboardPage() {
            showPage('dashboard');
        }

        // Tampilkan halaman reset admin
        function showResetAdminPage() {
            resetAdminPage.style.display = 'block';
            
            // Cek apakah user adalah CS LINE
            if (currentUser && currentUser.role === 'CS LINE') {
                adminAccessDenied.style.display = 'none';
                adminControls.style.display = 'block';
                updateAdminActiveExits();
            } else {
                adminAccessDenied.style.display = 'block';
                adminControls.style.display = 'none';
            }
        }

        // Update daftar aktif untuk admin
        function updateAdminActiveExits() {
            adminActiveExitsList.innerHTML = '';
            
            if (activeExitsDetail.length === 0) {
                const emptyState = document.createElement('div');
                emptyState.className = 'empty-state';
                emptyState.innerHTML = `
                    <i class="fas fa-users-slash"></i>
                    <p>Tidak ada staf yang sedang keluar</p>
                `;
                adminActiveExitsList.appendChild(emptyState);
                return;
            }
            
            activeExitsDetail.forEach(exit => {
                const minutes = Math.floor(exit.remainingTime / 60);
                const seconds = exit.remainingTime % 60;
                const timeDisplay = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                const exitCard = document.createElement('div');
                exitCard.className = `admin-exit-card ${exit.role.toLowerCase().replace(' ', '-')}`;
                
                exitCard.innerHTML = `
                    <div class="admin-exit-info">
                        <div class="admin-exit-avatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="admin-exit-details">
                            <h4>${exit.fullName}</h4>
                            <p>${exit.role}</p>
                        </div>
                    </div>
                    <div class="admin-exit-timer">${timeDisplay}</div>
                    <div class="admin-exit-actions">
                        <button class="btn btn-danger reset-single-timer" data-username="${exit.username}">
                            <i class="fas fa-sync-alt"></i> Reset
                        </button>
                    </div>
                `;
                
                adminActiveExitsList.appendChild(exitCard);
            });
            
            // Tambah event listener untuk tombol reset per user
            document.querySelectorAll('.reset-single-timer').forEach(btn => {
                btn.addEventListener('click', function() {
                    const username = this.getAttribute('data-username');
                    resetSingleTimer(username);
                });
            });
        }

        // Reset timer untuk user tertentu
        function resetSingleTimer(username) {
            // Cari user yang sedang izin
            const exitIndex = activeExitsDetail.findIndex(exit => exit.username === username && exit.status === 'active');
            
            if (exitIndex !== -1) {
                const exit = activeExitsDetail[exitIndex];
                
                // Kurangi jumlah aktif untuk jabatan
                activeExits[exit.role]--;
                
                // Hapus dari daftar aktif
                activeExitsDetail.splice(exitIndex, 1);
                saveActiveExits();
                
                // Update status riwayat
                const user = staffData.find(staff => staff.username === username);
                if (user) {
                    const userKey = `user_${user.username}`;
                    const userData = JSON.parse(localStorage.getItem(userKey));
                    
                    if (userData && userData.history) {
                        const latestExit = userData.history.find(record => record.status === 'active' && record.username === username);
                        if (latestExit) {
                            latestExit.status = 'completed';
                            latestExit.duration = 'Direset oleh admin';
                            
                            // KEMBALIKAN SISA IZIN: Tambah sisa izin user
                            if (userData.remainingExits < user.maxExits) {
                                userData.remainingExits += 1;
                            }
                            
                            // Simpan perubahan
                            localStorage.setItem(userKey, JSON.stringify(userData));
                            
                            // Jika user yang direset adalah user yang sedang login, update tampilan
                            if (currentUser && currentUser.username === username) {
                                currentUser.remainingExits = userData.remainingExits;
                                remainingExitsDisplay.textContent = currentUser.remainingExits;
                                permissionRemainingExits.textContent = currentUser.remainingExits;
                            }
                        }
                    }
                }
                
                // Update tampilan
                updateAdminActiveExits();
                updateOnlineStats();
                updateActiveExitsDisplay();
                
                showNotification(`Timer untuk ${exit.fullName} telah direset! Sisa izin dikembalikan.`, 'success');
            }
        }

        // Reset semua timer yang kadaluarsa
        function resetExpiredTimers() {
            const now = new Date().getTime();
            let resetCount = 0;
            
            // Cari semua izin yang sudah kadaluarsa
            const expiredExits = activeExitsDetail.filter(exit => {
                const elapsed = Math.floor((now - exit.startTime) / 1000);
                return elapsed > 15 * 60; // Lebih dari 15 menit
            });
            
            expiredExits.forEach(exit => {
                // Kurangi jumlah aktif untuk jabatan
                activeExits[exit.role]--;
                
                // Hapus dari daftar aktif
                const exitIndex = activeExitsDetail.findIndex(e => e.id === exit.id);
                if (exitIndex !== -1) {
                    activeExitsDetail.splice(exitIndex, 1);
                }
                
                // Update status riwayat
                const userKey = `user_${exit.username}`;
                const userData = JSON.parse(localStorage.getItem(userKey));
                
                if (userData && userData.history) {
                    const latestExit = userData.history.find(record => record.id === exit.id);
                    if (latestExit) {
                        latestExit.status = 'completed';
                        latestExit.duration = 'Kadaluarsa (direset admin)';
                        
                        // KEMBALIKAN SISA IZIN: Tambah sisa izin user
                        if (userData.remainingExits < userData.maxExits) {
                            userData.remainingExits += 1;
                        }
                        
                        // Simpan perubahan
                        localStorage.setItem(userKey, JSON.stringify(userData));
                        
                        // Jika user yang direset adalah user yang sedang login, update tampilan
                        if (currentUser && currentUser.username === exit.username) {
                            currentUser.remainingExits = userData.remainingExits;
                            remainingExitsDisplay.textContent = currentUser.remainingExits;
                            permissionRemainingExits.textContent = currentUser.remainingExits;
                        }
                    }
                }
                
                resetCount++;
            });
            
            saveActiveExits();
            
            // Update tampilan
            updateAdminActiveExits();
            updateOnlineStats();
            updateActiveExitsDisplay();
            
            showNotification(`${resetCount} timer kadaluarsa telah direset! Sisa izin dikembalikan.`, 'success');
        }

        // Refresh data admin
        function refreshAdminData() {
            updateAdminActiveExits();
            showNotification('Data telah diperbarui!', 'success');
        }

        // Reset semua timer dan izin aktif
        function resetAllTimers() {
            // Hentikan semua timer
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
            
            // Reset data aktif
            activeExits = {
                "Kapten Kasir": 0,
                "CS": 0,
                "TR CS": 0,
                "Kasir": 0,
                "CS LINE": 0
            };
            
            // Reset semua izin aktif di detail
            activeExitsDetail = [];
            saveActiveExits();
            
            // Reset timer untuk user yang sedang login
            if (currentUser) {
                resetTimer();
                updateButtonStatus();
            }
            
            // Update semua tampilan
            updateOnlineStats();
            updateActiveExitsDisplay();
            updateAdminActiveExits();
            updateTodayHistory();
            
            showNotification('Semua timer telah direset!', 'success');
        }

        // Reset timer untuk user yang sedang login
        function resetUserTimer() {
            if (!currentUser) return;
            
            // Hentikan timer
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
            
            // Reset timer
            resetTimer();
            
            // Update status tombol
            updateButtonStatus();
            
            showNotification('Timer Anda telah direset!', 'success');
        }

        // Handle perubahan password
        function handleChangePassword() {
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (!currentPassword || !newPassword || !confirmPassword) {
                showNotification('Harap isi semua field!', 'error');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                showNotification('Konfirmasi kata sandi tidak cocok!', 'error');
                return;
            }
            
            // Simulasikan perubahan password
            showNotification('Kata sandi berhasil diubah!', 'success');
            
            // Reset form
            document.getElementById('currentPassword').value = '';
            document.getElementById('newPassword').value = '';
            document.getElementById('confirmPassword').value = '';
        }

        // Cek dan reset data harian
        function checkAndResetDailyData() {
            const today = new Date().toDateString();
            const savedLastResetDate = localStorage.getItem('lastResetDate');
            
            // Jika belum ada data reset atau sudah ganti hari
            if (!savedLastResetDate || savedLastResetDate !== today) {
                // Reset sisa izin untuk semua staf
                staffData.forEach(staff => {
                    const userKey = `user_${staff.username}`;
                    let userData = JSON.parse(localStorage.getItem(userKey));
                    
                    if (userData) {
                        userData.remainingExits = staff.maxExits;
                        // Hapus riwayat hari sebelumnya
                        userData.history = userData.history.filter(record => {
                            const recordDate = new Date(record.startTime).toDateString();
                            return recordDate === today;
                        });
                        
                        localStorage.setItem(userKey, JSON.stringify(userData));
                    }
                });
                
                // Reset data aktif
                activeExits = {
                    "Kapten Kasir": 0,
                    "CS": 0,
                    "TR CS": 0,
                    "Kasir": 0,
                    "CS LINE": 0
                };
                activeExitsDetail = [];
                saveActiveExits();
                
                // Simpan tanggal reset terakhir
                localStorage.setItem('lastResetDate', today);
                
                console.log('Data harian telah direset');
            }
        }

        // Update riwayat hari ini di halaman login
        function updateTodayHistory() {
            // Hanya update jika di halaman login
            if (loginContainer.style.display !== 'none') {
                const today = new Date().toDateString();
                let todayExits = [];
                
                // Kumpulkan semua riwayat hari ini dari semua user
                staffData.forEach(staff => {
                    const userKey = `user_${staff.username}`;
                    const userData = JSON.parse(localStorage.getItem(userKey));
                    
                    if (userData && userData.history) {
                        const userTodayHistory = userData.history.filter(record => {
                            const recordDate = new Date(record.startTime).toDateString();
                            return recordDate === today;
                        });
                        
                        todayExits = todayExits.concat(userTodayHistory);
                    }
                });
                
                // Urutkan berdasarkan waktu terbaru
                todayExits.sort((a, b) => b.startTime - a.startTime);
                
                // Update tampilan
                todayHistoryList.innerHTML = '';
                
                if (todayExits.length === 0) {
                    const emptyRow = document.createElement('tr');
                    emptyRow.innerHTML = `
                        <td colspan="5" style="text-align: center; padding: 20px; color: #7f8c8d; font-style: italic;">
                            <i class="fas fa-inbox" style="font-size: 1.5rem; margin-bottom: 10px; display: block; opacity: 0.5;"></i>
                            Belum ada riwayat izin keluar hari ini
                        </td>
                    `;
                    todayHistoryList.appendChild(emptyRow);
                    return;
                }
                
                todayExits.forEach(record => {
                    const historyRow = document.createElement('tr');
                    
                    let durationText = record.duration;
                    let statusHTML = '';
                    let durationClass = '';
                    
                    // Hitung durasi sebenarnya
                    let actualDuration = 0;
                    if (record.status === 'active') {
                        const now = new Date().getTime();
                        actualDuration = Math.round((now - record.startTime) / 60000);
                        durationText = `${actualDuration} menit`;
                        statusHTML = `<span class="status-active"><i class="fas fa-running"></i> Aktif</span>`;
                    } else {
                        // Parse durasi dari string
                        const match = record.duration.match(/(\d+)\s*menit/);
                        if (match) {
                            actualDuration = parseInt(match[1]);
                        }
                        statusHTML = `<span class="status-completed"><i class="fas fa-check-circle"></i> Selesai</span>`;
                    }
                    
                    // Tandai dengan warna merah jika melebihi 15 menit
                    if (actualDuration > 15) {
                        durationClass = 'duration-over';
                    }
                    
                    historyRow.innerHTML = `
                        <td>${record.fullName}</td>
                        <td>${record.role}</td>
                        <td>${record.startTimeFormatted || new Date(record.startTime).toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' })}</td>
                        <td class="${durationClass}">${durationText}</td>
                        <td>${statusHTML}</td>
                    `;
                    
                    todayHistoryList.appendChild(historyRow);
                });
            }
        }

        // Handle login
        function handleLogin(e) {
            e.preventDefault();
            
            const username = usernameInput.value.trim().toUpperCase();
            const password = passwordInput.value;
            
            const user = staffData.find(staff => staff.username === username);
            
            if (user && user.password === password) {
                // Load user data from localStorage or create new
                const userKey = `user_${user.username}`;
                let userData = JSON.parse(localStorage.getItem(userKey));
                
                if (!userData) {
                    userData = {
                        remainingExits: user.maxExits,
                        maxExits: user.maxExits,
                        history: []
                    };
                } else {
                    // Pastikan ada properti maxExits (untuk data lama)
                    if (userData.maxExits === undefined) {
                        userData.maxExits = user.maxExits;
                    }
                }
                
                currentUser = {
                    ...user,
                    ...userData
                };
                
                // Simpan user ke localStorage
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                localStorage.setItem(userKey, JSON.stringify(userData));
                
                showDashboard();
                showNotification('Login berhasil!', 'success');
            } else {
                showNotification('Kredensial tidak valid. Silakan coba lagi.', 'error');
            }
        }

        // Handle logout
        function handleLogout() {
            // Hentikan timer jika sedang berjalan
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
            
            // Simpan data user sebelum logout
            if (currentUser) {
                const userKey = `user_${currentUser.username}`;
                const userData = {
                    remainingExits: currentUser.remainingExits,
                    maxExits: currentUser.maxExits,
                    history: currentUser.history
                };
                localStorage.setItem(userKey, JSON.stringify(userData));
            }
            
            // Reset form
            loginForm.reset();
            
            // Hapus user dari localStorage
            localStorage.removeItem('currentUser');
            
            // Tampilkan login section dan riwayat hari ini
            loginContainer.style.display = 'flex';
            todayHistorySection.style.display = 'block';
            appWrapper.style.display = 'none';
            
            // Update riwayat hari ini
            updateTodayHistory();
            
            currentUser = null;
            showNotification('Anda telah logout.', 'warning');
        }

        // Tampilkan dashboard
        function showDashboard() {
            // Update tampilan dengan data user
            userNameDisplay.textContent = currentUser.fullName;
            userRoleDisplay.textContent = `Peran: ${currentUser.role}`;
            remainingExitsDisplay.textContent = currentUser.remainingExits;
            maxExitsDisplay.textContent = currentUser.maxExits;
            
            // Update badge role
            userRoleBadge.textContent = currentUser.role;
            userRoleBadge.className = 'role-badge ';
            if (currentUser.role === 'Kapten Kasir') {
                userRoleBadge.classList.add('role-kapten');
            } else if (currentUser.role === 'CS' || currentUser.role === 'TR CS') {
                userRoleBadge.classList.add('role-cs');
            } else if (currentUser.role === 'CS LINE') {
                userRoleBadge.classList.add('role-cs-line');
            } else {
                userRoleBadge.classList.add('role-kasir');
            }
            
            // Tampilkan menu Reset Admin hanya untuk CS LINE
            const csLineMenu = document.querySelector('.cs-line-only');
            if (currentUser.role === 'CS LINE') {
                csLineMenu.style.display = 'block';
                
                // Tambahkan tombol reset timer hanya untuk CS LINE
                resetTimerContainer.innerHTML = `
                    <button class="reset-btn" id="resetUserTimerBtn">
                        <i class="fas fa-sync-alt"></i> Reset Timer Saya
                    </button>
                `;
                document.getElementById('resetUserTimerBtn').addEventListener('click', resetUserTimer);
            } else {
                csLineMenu.style.display = 'none';
                resetTimerContainer.innerHTML = '';
            }
            
            // Update riwayat
            updateHistory();
            
            // Reset timer
            resetTimer();
            
            // Cek apakah user memiliki izin aktif yang sedang berjalan
            const activeExit = activeExitsDetail.find(exit => 
                exit.username === currentUser.username && exit.status === 'active'
            );
            
            if (activeExit) {
                // Hitung sisa waktu berdasarkan waktu mulai dan waktu sekarang
                const now = new Date().getTime();
                const elapsed = Math.floor((now - activeExit.startTime) / 1000);
                timeLeft = Math.max(0, 15 * 60 - elapsed);
                
                // Update tampilan timer
                updateTimerDisplay();
                
                // Jika waktu masih tersisa, mulai timer
                if (timeLeft > 0) {
                    startTimer();
                    showNotification('Izin keluar Anda masih berjalan. Waktu tersisa: ' + formatTime(timeLeft), 'warning');
                } else {
                    // Jika waktu sudah habis, selesaikan izin
                    completeExpiredExit(activeExit);
                }
            }
            
            // Update status tombol
            updateButtonStatus();
            
            // Tampilkan dashboard
            loginContainer.style.display = 'none';
            todayHistorySection.style.display = 'none';
            appWrapper.style.display = 'flex';
            
            // Update statistik online
            updateOnlineStats();
            updateActiveExitsDisplay();
        }

        // Format waktu untuk notifikasi
        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        // Selesaikan izin yang sudah kadaluarsa
        function completeExpiredExit(exit) {
            // Kurangi jumlah aktif untuk jabatan
            activeExits[exit.role]--;
            
            // Update status di daftar aktif
            const activeExitIndex = activeExitsDetail.findIndex(e => 
                e.id === exit.id && e.status === 'active'
            );
            
            if (activeExitIndex !== -1) {
                activeExitsDetail.splice(activeExitIndex, 1);
                saveActiveExits();
            }
            
            // Update status riwayat
            if (currentUser.history.length > 0) {
                const latestExit = currentUser.history.find(record => record.id === exit.id);
                if (latestExit) {
                    latestExit.status = 'completed';
                    latestExit.duration = '15 menit (waktu habis)';
                    
                    // Simpan perubahan
                    const userKey = `user_${currentUser.username}`;
                    localStorage.setItem(userKey, JSON.stringify({
                        remainingExits: currentUser.remainingExits,
                        maxExits: currentUser.maxExits,
                        history: currentUser.history
                    }));
                    
                    updateHistory();
                }
            }
            
            // Update statistik online
            updateOnlineStats();
            updateActiveExitsDisplay();
            
            showNotification('Waktu izin keluar Anda telah habis!', 'warning');
        }

        // Handle request izin keluar
        function handleRequestExit() {
            if (currentUser.remainingExits <= 0) {
                showNotification('Anda telah mencapai batas izin keluar hari ini.', 'error');
                return;
            }
            
            // Cek batas keluar bersamaan untuk jabatan
            if (activeExits[currentUser.role] >= maxConcurrentExits[currentUser.role]) {
                showNotification(`Batas keluar bersamaan untuk ${currentUser.role} sudah penuh. Silakan tunggu.`, 'error');
                return;
            }
            
            // Cek khusus untuk CS LINE
            if (currentUser.role === 'CS LINE' && activeExits['CS LINE'] >= 1) {
                showNotification('Hanya satu CS LINE yang boleh keluar pada satu waktu. Silakan tunggu.', 'error');
                return;
            }
            
            // Kurangi sisa izin
            currentUser.remainingExits--;
            
            // Tambah jumlah aktif untuk jabatan
            activeExits[currentUser.role]++;
            
            // Tambahkan ke daftar aktif
            const now = new Date();
            const exitRecord = {
                id: Date.now(),
                username: currentUser.username,
                fullName: currentUser.fullName,
                role: currentUser.role,
                startTime: now.getTime(),
                startTimeFormatted: now.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' }),
                time: now.toLocaleString('id-ID'),
                status: 'active',
                duration: '0 menit',
                remainingTime: 15 * 60 // 15 menit dalam detik
            };
            
            activeExitsDetail.push(exitRecord);
            saveActiveExits();
            
            // Tambahkan ke riwayat
            currentUser.history.unshift(exitRecord);
            
            // Simpan perubahan
            const userKey = `user_${currentUser.username}`;
            localStorage.setItem(userKey, JSON.stringify({
                remainingExits: currentUser.remainingExits,
                maxExits: currentUser.maxExits,
                history: currentUser.history
            }));
            
            // Update tampilan
            remainingExitsDisplay.textContent = currentUser.remainingExits;
            updateHistory();
            updateButtonStatus();
            updateOnlineStats();
            updateActiveExitsDisplay();
            
            // Mulai timer
            startTimer();
            
            showNotification('Izin keluar telah diajukan. Anda memiliki 15 menit.', 'success');
        }

        // Handle kembali
        function handleReturn() {
            // Hentikan timer
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
            
            // Kurangi jumlah aktif untuk jabatan
            activeExits[currentUser.role]--;
            
            // Hapus dari daftar aktif
            const activeExitIndex = activeExitsDetail.findIndex(exit => 
                exit.username === currentUser.username && exit.status === 'active'
            );
            
            if (activeExitIndex !== -1) {
                activeExitsDetail.splice(activeExitIndex, 1);
                saveActiveExits();
            }
            
            // Update status riwayat terbaru
            if (currentUser.history.length > 0) {
                const latestExit = currentUser.history.find(record => record.status === 'active');
                if (latestExit) {
                    latestExit.status = 'completed';
                    const now = new Date();
                    const startTime = new Date(latestExit.startTime);
                    const duration = Math.round((now - startTime) / 60000); // dalam menit
                    latestExit.duration = `${duration} menit`;
                    
                    // Simpan perubahan
                    const userKey = `user_${currentUser.username}`;
                    localStorage.setItem(userKey, JSON.stringify({
                        remainingExits: currentUser.remainingExits,
                        maxExits: currentUser.maxExits,
                        history: currentUser.history
                    }));
                    
                    updateHistory();
                }
            }
            
            // Reset timer
            resetTimer();
            
            // Update status tombol
            updateButtonStatus();
            updateOnlineStats();
            updateActiveExitsDisplay();
            
            showNotification('Anda telah kembali. Terima kasih!', 'success');
        }

        // Mulai timer
        function startTimer() {
            // Update status tombol
            requestBtn.disabled = true;
            returnBtn.disabled = false;
            permissionRequestBtn.disabled = true;
            permissionReturnBtn.disabled = false;
            
            // Mulai hitungan mundur
            timerInterval = setInterval(() => {
                timeLeft--;
                
                // Update tampilan timer
                updateTimerDisplay();
                
                // Update waktu tersisa di daftar aktif
                const activeExitIndex = activeExitsDetail.findIndex(exit => 
                    exit.username === currentUser.username && exit.status === 'active'
                );
                
                if (activeExitIndex !== -1) {
                    activeExitsDetail[activeExitIndex].remainingTime = timeLeft;
                    updateActiveExitsDisplay();
                }
                
                // Jika waktu habis
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    timerInterval = null;
                    
                    // Kurangi jumlah aktif untuk jabatan
                    activeExits[currentUser.role]--;
                    
                    // Update status di daftar aktif
                    const activeExitIndex = activeExitsDetail.findIndex(exit => 
                        exit.username === currentUser.username && exit.status === 'active'
                    );
                    
                    if (activeExitIndex !== -1) {
                        const expiredExit = activeExitsDetail[activeExitIndex];
                        activeExitsDetail.splice(activeExitIndex, 1);
                        saveActiveExits();
                        
                        // Update status riwayat
                        if (currentUser.history.length > 0) {
                            const latestExit = currentUser.history.find(record => record.id === expiredExit.id);
                            if (latestExit) {
                                latestExit.status = 'completed';
                                latestExit.duration = '15 menit (waktu habis)';
                                
                                // Simpan perubahan
                                const userKey = `user_${currentUser.username}`;
                                localStorage.setItem(userKey, JSON.stringify({
                                    remainingExits: currentUser.remainingExits,
                                    maxExits: currentUser.maxExits,
                                    history: currentUser.history
                                }));
                                
                                updateHistory();
                            }
                        }
                    }
                    
                    // Reset timer
                    resetTimer();
                    
                    // Update status tombol
                    updateButtonStatus();
                    updateOnlineStats();
                    updateActiveExitsDisplay();
                    
                    showNotification('Waktu izin keluar Anda telah habis!', 'warning');
                }
            }, 1000);
        }

        // Reset timer
        function resetTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
            
            timeLeft = 15 * 60;
            updateTimerDisplay();
        }

        // Update tampilan timer
        function updateTimerDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            permissionTimer.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            // Ubah warna jika waktu hampir habis
            if (timeLeft < 60) {
                timerDisplay.className = 'timer danger';
                permissionTimer.className = 'timer danger';
            } else if (timeLeft < 300) {
                timerDisplay.className = 'timer warning';
                permissionTimer.className = 'timer warning';
            } else {
                timerDisplay.className = 'timer';
                permissionTimer.className = 'timer';
            }
        }

        // Update status tombol
        function updateButtonStatus() {
            // Tombol ajukan izin
            if (currentUser.remainingExits <= 0 || timerInterval || activeExits[currentUser.role] >= maxConcurrentExits[currentUser.role]) {
                requestBtn.disabled = true;
                permissionRequestBtn.disabled = true;
            } else {
                requestBtn.disabled = false;
                permissionRequestBtn.disabled = false;
            }
            
            // Tombol kembali
            returnBtn.disabled = !timerInterval;
            permissionReturnBtn.disabled = !timerInterval;
        }

        // Update riwayat
        function updateHistory() {
            historyList.innerHTML = '';
            
            if (currentUser.history.length === 0) {
                const emptyRow = document.createElement('tr');
                emptyRow.innerHTML = `
                    <td colspan="5" style="text-align: center; padding: 20px; color: #7f8c8d; font-style: italic;">
                        <i class="fas fa-inbox" style="font-size: 1.5rem; margin-bottom: 10px; display: block; opacity: 0.5;"></i>
                        Belum ada riwayat izin keluar
                    </td>
                `;
                historyList.appendChild(emptyRow);
                return;
            }
            
            currentUser.history.forEach(record => {
                const historyRow = document.createElement('tr');
                
                let durationText = record.duration;
                let statusHTML = '';
                let durationClass = '';
                
                // Hitung durasi sebenarnya
                let actualDuration = 0;
                if (record.status === 'active') {
                    const now = new Date().getTime();
                    actualDuration = Math.round((now - record.startTime) / 60000);
                    durationText = `${actualDuration} menit`;
                    statusHTML = `<span class="status-active"><i class="fas fa-running"></i> Aktif</span>`;
                } else {
                    // Parse durasi dari string
                    const match = record.duration.match(/(\d+)\s*menit/);
                    if (match) {
                        actualDuration = parseInt(match[1]);
                    }
                    statusHTML = `<span class="status-completed"><i class="fas fa-check-circle"></i> Selesai</span>`;
                }
                
                // Tandai dengan warna merah jika melebihi 15 menit
                if (actualDuration > 15) {
                    durationClass = 'duration-over';
                }
                
                historyRow.innerHTML = `
                    <td>${record.fullName}</td>
                    <td>${record.role}</td>
                    <td>${record.startTimeFormatted || new Date(record.startTime).toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' })}</td>
                    <td class="${durationClass}">${durationText}</td>
                    <td>${statusHTML}</td>
                `;
                
                historyList.appendChild(historyRow);
            });
        }

        // Update tampilan staf yang sedang keluar
        function updateActiveExitsDisplay() {
            activeExitsList.innerHTML = '';
            permissionActiveExitsList.innerHTML = '';
            
            if (activeExitsDetail.length === 0) {
                const emptyState = document.createElement('div');
                emptyState.className = 'empty-state';
                emptyState.innerHTML = `
                    <i class="fas fa-users-slash"></i>
                    <p>Tidak ada staf yang sedang keluar</p>
                `;
                activeExitsList.appendChild(emptyState);
                permissionActiveExitsList.appendChild(emptyState.cloneNode(true));
                return;
            }
            
            activeExitsDetail.forEach(exit => {
                const minutes = Math.floor(exit.remainingTime / 60);
                const seconds = exit.remainingTime % 60;
                const timeDisplay = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                const exitCard = document.createElement('div');
                exitCard.className = `active-exit-card ${exit.role.toLowerCase().replace(' ', '-')}`;
                
                exitCard.innerHTML = `
                    <div class="exit-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="exit-info">
                        <h4>${exit.fullName}</h4>
                        <p>${exit.role}</p>
                    </div>
                    <div class="exit-timer">${timeDisplay}</div>
                `;
                
                activeExitsList.appendChild(exitCard);
                permissionActiveExitsList.appendChild(exitCard.cloneNode(true));
            });
        }

        // Update statistik online
        function updateOnlineStats() {
            // Update jumlah aktif per jabatan
            kaptenOnlineDisplay.textContent = activeExits["Kapten Kasir"];
            csOnlineDisplay.textContent = activeExits["CS"] + activeExits["TR CS"];
            kasirOnlineDisplay.textContent = activeExits["Kasir"];
            csLineOnlineDisplay.textContent = activeExits["CS LINE"];
            
            // Update progress bar
            kaptenProgress.style.width = `${(activeExits["Kapten Kasir"] / maxConcurrentExits["Kapten Kasir"]) * 100}%`;
            csProgress.style.width = `${((activeExits["CS"] + activeExits["TR CS"]) / maxConcurrentExits["CS"]) * 100}%`;
            kasirProgress.style.width = `${(activeExits["Kasir"] / maxConcurrentExits["Kasir"]) * 100}%`;
            csLineProgress.style.width = `${(activeExits["CS LINE"] / maxConcurrentExits["CS LINE"]) * 100}%`;
            
            // Update teks progress
            kaptenCount.textContent = `${activeExits["Kapten Kasir"]}/${maxConcurrentExits["Kapten Kasir"]}`;
            csCount.textContent = `${activeExits["CS"] + activeExits["TR CS"]}/${maxConcurrentExits["CS"]}`;
            kasirCount.textContent = `${activeExits["Kasir"]}/${maxConcurrentExits["Kasir"]}`;
            csLineCount.textContent = `${activeExits["CS LINE"]}/${maxConcurrentExits["CS LINE"]}`;
        }

        // Update waktu dan tanggal
        function updateDateTime() {
            const now = new Date();
            
            // Format tanggal
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            const dateString = now.toLocaleDateString('id-ID', options);
            const timeString = now.toLocaleTimeString('id-ID');
            
            // Update di dashboard
            currentDate.textContent = dateString;
            currentTime.textContent = timeString;
            
            // Update di login (dengan ukuran besar)
            largeDateLogin.textContent = dateString;
            largeTimeLogin.textContent = timeString;
        }

        // Simpan data aktif ke localStorage
        function saveActiveExits() {
            localStorage.setItem('activeExits', JSON.stringify(activeExits));
            localStorage.setItem('activeExitsDetail', JSON.stringify(activeExitsDetail));
        }

        // Muat data aktif dari localStorage
        function loadActiveExits() {
            const savedActiveExits = localStorage.getItem('activeExits');
            const savedActiveExitsDetail = localStorage.getItem('activeExitsDetail');
            
            if (savedActiveExits) {
                activeExits = JSON.parse(savedActiveExits);
            }
            
            if (savedActiveExitsDetail) {
                activeExitsDetail = JSON.parse(savedActiveExitsDetail);
                
                // Perbarui waktu tersisa untuk setiap izin aktif
                const now = new Date().getTime();
                activeExitsDetail.forEach(exit => {
                    if (exit.status === 'active') {
                        const elapsed = Math.floor((now - exit.startTime) / 1000);
                        exit.remainingTime = Math.max(0, 15 * 60 - elapsed);
                    }
                });
                
                saveActiveExits();
            }
        }

        // Tampilkan notifikasi
        function showNotification(message, type) {
            notification.textContent = message;
            notification.className = `notification ${type} show`;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Jalankan inisialisasi saat halaman dimuat
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>