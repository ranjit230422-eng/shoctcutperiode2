<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LIVECHAT LINE TOGEL</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
:root {
  --primary-color: #6366f1;
  --secondary-color: #8b5cf6;
  --accent-color: #ec4899;
  --success-color: #10b981;
  --warning-color: #f59e0b;
  --danger-color: #ef4444;
  --gold-color: #fcd34d;
  --silver-color: #d1d5db;
  --bronze-color: #f97316;
  --dark-text: #ffffff;
  --light-text: #e2e8f0;
  --muted-text: #94a3b8;
  --glass-bg: rgba(15, 23, 42, 0.85);
  --glass-border: rgba(100, 116, 139, 0.3);
  --card-shadow: 0 10px 25px rgba(0, 0, 0, 0.25);
  --gradient-primary: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
  --gradient-secondary: linear-gradient(135deg, #3b82f6 0%, #10b981 100%);
  --gradient-success: linear-gradient(135deg, #10b981 0%, #34d399 100%);
  --gradient-warning: linear-gradient(135deg, #f59e0b 0%, #fbbf24 100%);
  --gradient-danger: linear-gradient(135deg, #ef4444 0%, #f87171 100%);
  --gradient-gold: linear-gradient(135deg, #fcd34d 0%, #fde68a 100%);
  --gradient-silver: linear-gradient(135deg, #d1d5db 0%, #e2e8f0 100%);
  --gradient-bronze: linear-gradient(135deg, #f97316 0%, #fb923c 100%);
  --text-color: #f1f5f9;
  --body-bg: #0f172a;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Poppins', sans-serif;
  min-height: 100vh;
  line-height: 1.6;
  color: var(--dark-text);
  background: var(--body-bg);
  padding: 15px;
  position: relative;
  overflow-x: hidden;
}

body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: 
    radial-gradient(circle at 20% 30%, rgba(99, 102, 241, 0.15) 0%, transparent 25%),
    radial-gradient(circle at 80% 70%, rgba(139, 92, 246, 0.15) 0%, transparent 25%),
    radial-gradient(circle at 50% 50%, rgba(15, 23, 42, 1) 0%, rgba(2, 6, 23, 1) 100%);
  background-size: 100% 100%;
  z-index: -1;
}

.container {
  max-width: 1400px;
  margin: 0 auto;
}

.header {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  color: var(--dark-text);
  padding: 2rem;
  border-radius: 20px;
  box-shadow: var(--card-shadow);
  margin-bottom: 1.5rem;
  position: relative;
  overflow: hidden;
  text-align: center;
}

.header::after {
  content: '';
  position: absolute;
  bottom: 0;
  left: 0;
  width: 100%;
  height: 4px;
  background: var(--gradient-primary);
}

.header h1 {
  font-weight: 700;
  margin-bottom: 0.5rem;
  font-size: 2.2rem;
  background: linear-gradient(to right, #a5b4fc, #c7d2fe);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  text-shadow: 0 2px 10px rgba(99, 102, 241, 0.3);
}

.header p {
  opacity: 0.9;
  font-weight: 500;
  font-size: 1.1rem;
  margin: 0 auto;
  line-height: 1.5;
  color: var(--light-text);
  text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
}

.card {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
  box-shadow: var(--card-shadow);
  transition: all 0.3s ease;
  margin-bottom: 1.5rem;
  overflow: hidden;
}

.card:hover {
  transform: translateY(-5px);
  box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
}

.card-header {
  background: rgba(30, 41, 59, 0.8);
  border-bottom: 1px solid var(--glass-border);
  padding: 1.2rem 1.5rem;
  font-weight: 600;
  font-size: 1.1rem;
  position: relative;
  color: var(--dark-text);
  text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
}

.card-header::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 3px;
  background: var(--gradient-primary);
}

.card-body {
  padding: 1.5rem;
  background: rgba(30, 41, 59, 0.5);
}

.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
  gap: 1.2rem;
  margin-bottom: 1.5rem;
}

.stats-card {
  background: rgba(30, 41, 59, 0.9);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
  padding: 1.5rem;
  text-align: center;
  box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
}

.stats-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 3px;
  background: var(--gradient-primary);
}

.stats-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
}

.stats-number {
  font-size: 2.5rem;
  font-weight: 700;
  margin-bottom: 0.5rem;
  background: linear-gradient(135deg, #a5b4fc, #c7d2fe);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  text-shadow: 0 2px 10px rgba(99, 102, 241, 0.3);
}

.stats-label {
  color: var(--light-text);
  font-size: 0.9rem;
  font-weight: 500;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
}

.table-responsive {
  border-radius: 16px;
  overflow: hidden;
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
  background: rgba(30, 41, 59, 0.7);
}

.table {
  color: var(--dark-text);
  margin-bottom: 0;
  border-collapse: separate;
  border-spacing: 0;
  width: 100%;
}

.table th {
  background: var(--gradient-primary);
  color: white;
  border: none;
  padding: 1rem;
  font-weight: 600;
  font-size: 0.9rem;
  text-align: center;
  text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
}

.table td {
  padding: 1rem;
  vertical-align: middle;
  border-color: rgba(255, 255, 255, 0.1);
  background: rgba(30, 41, 59, 0.5);
  text-align: center;
  color: var(--dark-text);
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
}

.table-hover tbody tr:hover td {
  background: rgba(51, 65, 85, 0.7);
}

/* Gaya untuk nama CS yang lebih menarik */
.cs-name-container {
  display: flex;
  align-items: center;
  transition: all 0.3s ease;
}

.cs-avatar {
  width: 45px;
  height: 45px;
  border-radius: 50%;
  background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-weight: bold;
  margin-right: 12px;
  font-size: 1.1rem;
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
  transition: all 0.3s ease;
  position: relative;
  overflow: hidden;
}

.cs-avatar::before {
  content: '';
  position: absolute;
  top: -50%;
  left: -50%;
  width: 200%;
  height: 200%;
  background: linear-gradient(to right, transparent, rgba(255, 255, 255, 0.3), transparent);
  transform: rotate(45deg);
  transition: all 0.6s ease;
}

.cs-avatar:hover::before {
  animation: shine 1.5s infinite;
}

@keyframes shine {
  0% { left: -50%; }
  100% { left: 100%; }
}

.cs-name {
  font-weight: 600;
  color: var(--dark-text);
  transition: all 0.3s ease;
  position: relative;
  padding: 5px 0;
  cursor: pointer;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
}

.cs-name::after {
  content: '';
  position: absolute;
  bottom: 0;
  left: 0;
  width: 0;
  height: 2px;
  background: linear-gradient(135deg, #a5b4fc, #c7d2fe);
  transition: width 0.3s ease;
}

.cs-name:hover::after {
  width: 100%;
}

.cs-name:hover {
  color: #a5b4fc;
}

.status-badge {
  padding: 0.5rem 1rem;
  border-radius: 20px;
  font-weight: 600;
  font-size: 0.8rem;
  display: inline-block;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
}

.status-good {
  background: var(--gradient-success);
  color: white;
}

.status-warning {
  background: var(--gradient-warning);
  color: white;
}

.status-danger {
  background: var(--gradient-danger);
  color: white;
}

.rank-badge {
  width: 35px;
  height: 35px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-weight: bold;
  margin-right: 10px;
  font-size: 0.9rem;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
  transition: all 0.3s ease;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
}

.rank-badge:hover {
  transform: scale(1.1);
}

.rank-1 {
  background: var(--gradient-gold);
  box-shadow: 0 4px 12px rgba(252, 211, 77, 0.4);
}

.rank-2 {
  background: var(--gradient-silver);
  box-shadow: 0 4px 12px rgba(209, 213, 219, 0.4);
}

.rank-3 {
  background: var(--gradient-bronze);
  box-shadow: 0 4px 12px rgba(249, 115, 22, 0.4);
}

.winner-card {
  background: rgba(30, 41, 59, 0.9);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
  transition: all 0.3s ease;
  padding: 1.5rem;
  height: 100%;
  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
  text-align: center;
  position: relative;
  overflow: hidden;
}

.winner-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 5px;
  background: var(--gradient-primary);
}

.winner-card-1 {
  border: 2px solid var(--gold-color);
  box-shadow: 0 8px 25px rgba(252, 211, 77, 0.3);
}

.winner-card-2 {
  border: 2px solid var(--silver-color);
  box-shadow: 0 8px 25px rgba(209, 213, 219, 0.3);
}

.winner-card-3 {
  border: 2px solid var(--bronze-color);
  box-shadow: 0 8px 25px rgba(249, 115, 22, 0.3);
}

.winner-card:hover {
  transform: translateY(-5px);
}

.winner-card h4, .winner-card h5, .winner-card p {
  color: var(--dark-text);
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
}

.winner-card .small {
  color: var(--light-text);
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
}

.refresh-btn {
  cursor: pointer;
  transition: all 0.3s ease;
  background: rgba(30, 41, 59, 0.8);
  border-radius: 50%;
  width: 50px;
  height: 50px;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
  border: 1px solid var(--glass-border);
  color: #a5b4fc;
}

.refresh-btn:hover {
  transform: rotate(180deg);
  background: rgba(51, 65, 85, 0.9);
}

.last-updated {
  font-size: 0.9rem;
  color: var(--light-text);
  background: rgba(30, 41, 59, 0.8);
  padding: 0.6rem 1rem;
  border-radius: 20px;
  display: inline-block;
  margin-top: 1rem;
  backdrop-filter: blur(5px);
  border: 1px solid var(--glass-border);
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
}

.cs-line-top-right {
  position: absolute;
  top: 15px;
  right: 15px;
  background: rgba(30, 41, 59, 0.9);
  backdrop-filter: blur(20px);
  padding: 15px;
  border-radius: 16px;
  font-size: 0.85rem;
  color: var(--dark-text);
  z-index: 100;
  display: flex;
  flex-direction: column;
  gap: 8px;
  border: 1px solid var(--glass-border);
  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
  max-width: 250px;
}

.cs-line-top-right strong {
  font-weight: 700;
  font-size: 1.1rem;
  color: #a5b4fc;
  display: flex;
  align-items: center;
  gap: 8px;
  padding-bottom: 8px;
  border-bottom: 1px solid rgba(165, 180, 252, 0.3);
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
}

.cs-line-top-right div {
  font-weight: 500;
  padding: 5px 0;
  display: flex;
  align-items: center;
  gap: 8px;
  transition: all 0.3s ease;
  border-radius: 8px;
  padding: 8px;
  color: var(--dark-text);
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
}

.cs-line-top-right div:hover {
  background: rgba(165, 180, 252, 0.2);
  transform: translateX(5px);
}

.search-container {
  display: flex;
  gap: 12px;
  margin-bottom: 15px;
  flex-wrap: wrap;
}

.search-box {
  flex: 1;
  min-width: 200px;
  position: relative;
}

.search-box input {
  width: 100%;
  padding: 10px 15px;
  border-radius: 20px;
  border: 1px solid var(--glass-border);
  background: rgba(30, 41, 59, 0.8);
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
  color: var(--dark-text);
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
}

.search-box input:focus {
  outline: none;
  border-color: #a5b4fc;
  box-shadow: 0 3px 10px rgba(165, 180, 252, 0.3);
}

.search-box i {
  position: absolute;
  right: 15px;
  top: 50%;
  transform: translateY(-50%);
  color: #a5b4fc;
}

.filter-select {
  min-width: 150px;
  padding: 10px 15px;
  border-radius: 20px;
  border: 1px solid var(--glass-border);
  background: rgba(30, 41, 59, 0.8);
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
  color: var(--dark-text);
  appearance: none;
  background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23a5b4fc' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
  background-repeat: no-repeat;
  background-position: right 1rem center;
  background-size: 1em;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
}

.filter-select:focus {
  outline: none;
  border-color: #a5b4fc;
  box-shadow: 0 3px 10px rgba(165, 180, 252, 0.3);
}

.chart-container {
  position: relative;
  height: 250px;
  margin-bottom: 20px;
  background: rgba(30, 41, 59, 0.7);
  border-radius: 16px;
  padding: 15px;
}

.nav-tabs {
  border-bottom: 2px solid rgba(165, 180, 252, 0.3);
  margin-bottom: 15px;
}

.nav-tabs .nav-link {
  border: none;
  color: var(--light-text);
  font-weight: 500;
  padding: 10px 20px;
  border-radius: 10px 10px 0 0;
  background: rgba(30, 41, 59, 0.7);
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
}

.nav-tabs .nav-link.active {
  color: #a5b4fc;
  background: rgba(165, 180, 252, 0.2);
  border-bottom: 3px solid #a5b4fc;
}

.nav-tabs .nav-link:hover {
  color: #a5b4fc;
  background: rgba(165, 180, 252, 0.1);
}

.history-panel {
  max-height: 300px;
  overflow-y: auto;
  padding-right: 10px;
}

.history-item {
  background: rgba(30, 41, 59, 0.7);
  border-radius: 12px;
  padding: 12px;
  margin-bottom: 12px;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
  border-left: 3px solid #a5b4fc;
}

.history-time, .history-content {
  color: var(--dark-text);
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
}

.bonus-section {
  background: rgba(30, 41, 59, 0.8);
  border-radius: 12px;
  padding: 1.2rem;
  margin-top: 1.2rem;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
  border-left: 3px solid #a5b4fc;
}

.bonus-title {
  font-weight: 700;
  color: #a5b4fc;
  margin-bottom: 0.8rem;
  display: flex;
  align-items: center;
  gap: 8px;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
}

.bonus-item {
  display: flex;
  justify-content: space-between;
  margin-bottom: 0.6rem;
  padding: 0.6rem;
  background: rgba(51, 65, 85, 0.6);
  border-radius: 8px;
}

.bonus-label, .bonus-value {
  color: var(--dark-text);
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
}

.bonus-rule {
  color: var(--light-text);
  font-size: 0.85rem;
  margin-top: 0.8rem;
  padding: 0.5rem;
  background: rgba(51, 65, 85, 0.6);
  border-radius: 8px;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
}

.floating-notification {
  position: fixed;
  top: 15px;
  right: 15px;
  background: rgba(30, 41, 59, 0.95);
  color: var(--dark-text);
  padding: 1rem 1.5rem;
  border-radius: 16px;
  box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
  z-index: 1000;
  display: flex;
  align-items: center;
  gap: 0.8rem;
  transform: translateX(100%);
  opacity: 0;
  transition: transform 0.4s, opacity 0.4s;
  backdrop-filter: blur(10px);
  border: 1px solid var(--glass-border);
}

.floating-notification.show {
  transform: translateX(0);
  opacity: 1;
}

.floating-notification strong, .floating-notification div {
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
}

.auto-update-indicator {
  position: fixed;
  bottom: 15px;
  right: 15px;
  background: rgba(16, 185, 129, 0.9);
  color: white;
  padding: 0.6rem 1.2rem;
  border-radius: 20px;
  font-size: 0.8rem;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
  z-index: 1000;
  display: flex;
  align-items: center;
  gap: 0.5rem;
  backdrop-filter: blur(5px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
}

.loading-indicator {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(15, 23, 42, 0.8);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 9999;
  backdrop-filter: blur(5px);
  transition: opacity 0.3s;
}

.loading-spinner {
  width: 50px;
  height: 50px;
  border: 5px solid rgba(165, 180, 252, 0.3);
  border-radius: 50%;
  border-top-color: #a5b4fc;
  animation: spin 1s ease-in-out infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

.detail-item {
  display: flex;
  justify-content: space-between;
  margin-bottom: 0.8rem;
  padding: 0.8rem;
  background: rgba(30, 41, 59, 0.6);
  border-radius: 8px;
}

.detail-label {
  font-weight: 600;
  color: var(--light-text);
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
}

.detail-value {
  font-weight: 500;
  color: var(--dark-text);
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
}

.modal-content {
  background: var(--glass-bg);
  color: var(--dark-text);
  border: 1px solid var(--glass-border);
}

.modal-header, .modal-footer {
  background: rgba(30, 41, 59, 0.8);
  border-color: var(--glass-border);
}

.modal-title {
  color: var(--dark-text);
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
}

.modal-body {
  background: rgba(30, 41, 59, 0.5);
}

.modal-body h4, .modal-body .stats-label {
  color: var(--dark-text);
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
}

.btn-secondary {
  background: rgba(100, 116, 139, 0.3);
  border-color: var(--glass-border);
  color: var(--dark-text);
}

.btn-secondary:hover {
  background: rgba(100, 116, 139, 0.5);
  color: var(--dark-text);
}

/* Animations */
@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

@keyframes slideUp {
  from { transform: translateY(15px); opacity: 0; }
  to { transform: translateY(0); opacity: 1; }
}

/* Floating particles background */
.particles {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: -2;
  overflow: hidden;
}

.particle {
  position: absolute;
  border-radius: 50%;
  background: rgba(165, 180, 252, 0.1);
  animation: float 15s infinite linear;
}

@keyframes float {
  0% {
    transform: translateY(0) rotate(0deg);
    opacity: 1;
  }
  100% {
    transform: translateY(-1000px) rotate(720deg);
    opacity: 0;
  }
}

/* Responsive styles */
@media (max-width: 992px) {
  .cs-line-top-right {
    position: relative;
    top: 0;
    right: 0;
    max-width: 100%;
    margin-bottom: 15px;
    margin-left: auto;
    margin-right: auto;
  }
  
  .header {
    padding-top: 4rem;
  }
}

@media (max-width: 768px) {
  .header h1 {
    font-size: 1.7rem;
  }
  
  .header p {
    font-size: 0.9rem;
  }
  
  .stats-grid {
    grid-template-columns: 1fr;
  }
  
  .stats-number {
    font-size: 2rem;
  }
  
  .table td, .table th {
    padding: 0.8rem;
    font-size: 0.85rem;
  }
  
  .cs-avatar {
    width: 40px;
    height: 40px;
    font-size: 1rem;
  }
  
  .search-container {
    flex-direction: column;
  }
  
  .search-box, .filter-select {
    min-width: 100%;
  }
}

@media (max-width: 576px) {
  body {
    padding: 10px;
  }
  
  .header {
    padding: 1rem;
  }
  
  .card-body {
    padding: 1rem;
  }
  
  .table td, .table th {
    padding: 0.6rem;
  }
  
  .winner-card {
    padding: 1rem;
  }
  
  .cs-name-container {
    flex-direction: column;
    align-items: flex-start;
  }
  
  .cs-avatar {
    margin-right: 0;
    margin-bottom: 8px;
  }
}
</style>
</head>
<body>
<!-- Floating particles background -->
<div class="particles" id="particles"></div>

<!-- Loading indicator -->
<div class="loading-indicator" id="loadingIndicator" style="display: none;">
  <div class="loading-spinner"></div>
</div>

<div class="floating-notification success" id="updateNotification">
  <i class="fas fa-check-circle notification-icon notification-success"></i>
  <div>
    <strong>Data Diperbarui!</strong>
    <div>Data terbaru telah berhasil diambil</div>
  </div>
</div>

<div class="auto-update-indicator" id="autoUpdateIndicator">
  <i class="fas fa-sync-alt"></i> Auto-update aktif
</div>

<div class="container">
  <!-- CS LINE di kanan atas -->
  <div class="cs-line-top-right">
    <strong>CS LINE</strong>
    <div>CHARLIE</div>
    <div>ANDI</div>
    <div>RINAL ABDILLAH NASUTION</div>
  </div>

  <div class="header text-center">
    <h1 class="fw-bold"><i class="fas fa-chart-line me-2"></i>KESALAHAN LIVECHAT PERIODE 3</h1>
    <p class="lead">PANTAU AJA JANGAN LASAK</p>

    <div class="d-flex justify-content-center align-items-center mt-3">
      <div class="refresh-btn me-2" id="refreshBtn">
        <i class="fas fa-sync-alt"></i>
      </div>
      <div class="last-updated" id="lastUpdated">
        <i class="fas fa-clock me-1"></i>Terakhir diperbarui: -
      </div>
    </div>
  </div>

  <ul class="nav nav-tabs" id="dashboardTabs" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link active" id="overview-tab" data-bs-toggle="tab" data-bs-target="#overview" type="button" role="tab" aria-controls="overview" aria-selected="true">
        <i class="fas fa-chart-pie me-2"></i>Ringkasan
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="details-tab" data-bs-toggle="tab" data-bs-target="#details" type="button" role="tab" aria-controls="details" aria-selected="false">
        <i class="fas fa-table me-2"></i>Detail Data
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="history-tab" data-bs-toggle="tab" data-bs-target="#history" type="button" role="tab" aria-controls="history" aria-selected="false">
        <i class="fas fa-history me-2"></i>Riwayat
      </button>
    </li>
  </ul>

  <div class="tab-content" id="dashboardTabContent">
    <div class="tab-pane fade show active" id="overview" role="tabpanel" aria-labelledby="overview-tab">
      <div class="stats-grid">
        <div class="stats-card">
          <div class="stats-number" id="totalErrors">0</div>
          <div class="stats-label">Total Kesalahan</div>
        </div>
        <div class="stats-card">
          <div class="stats-number" id="totalCS">0</div>
          <div class="stats-label">Jumlah CS</div>
        </div>
        <div class="stats-card">
          <div class="stats-number" id="averageErrors">0.0</div>
          <div class="stats-label">Rata-rata Kesalahan</div>
        </div>
        <div class="stats-card">
          <div class="stats-number" id="criticalCount">0</div>
          <div class="stats-label">CS Status Danger</div>
        </div>
      </div>

      <div class="row mb-4">
        <div class="col-md-12">
          <div class="card">
            <div class="card-header text-center">
              <i class="fas fa-chart-bar me-2"></i>Distribusi Kesalahan CS
            </div>
            <div class="card-body">
              <div class="chart-container">
                <canvas id="errorDistributionChart"></canvas>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="row mb-4">
        <div class="col-md-12">
          <div class="card">
            <div class="card-header text-center">
              <i class="fas fa-trophy me-2"></i>Top 3 Performa Terbaik
            </div>
            <div class="card-body">
              <div class="row" id="top3Container">
                <!-- Data akan diisi oleh JavaScript -->
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="tab-pane fade" id="details" role="tabpanel" aria-labelledby="details-tab">
      <div class="row">
        <div class="col-md-12">
          <div class="card">
            <div class="card-header text-center d-flex justify-content-between align-items-center">
              <span><i class="fas fa-list me-2"></i>Daftar Lengkap Kesalahan CS</span>
              <span class="badge bg-danger" id="csCount">0 CS</span>
            </div>
            <div class="card-body">
              <div class="search-container">
                <div class="search-box">
                  <input type="text" id="searchInput" placeholder="Cari nama CS...">
                  <i class="fas fa-search"></i>
                </div>
                <select class="filter-select" id="statusFilter">
                  <option value="all">Semua Status</option>
                  <option value="good">Good</option>
                  <option value="warning">Warning</option>
                  <option value="danger">Danger</option>
                </select>
              </div>
              <div class="table-responsive">
                <table class="table table-hover" id="csTable">
                  <thead>
                    <tr>
                      <th>Peringkat</th>
                      <th>Nama CS</th>
                      <th>Total Kesalahan</th>
                      <th>Status</th>
                      <th>Potongan Bonus</th>
                    </tr>
                  </thead>
                  <tbody id="csTableBody">
                    <!-- Data akan diisi oleh JavaScript -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="tab-pane fade" id="history" role="tabpanel" aria-labelledby="history-tab">
      <div class="row">
        <div class="col-md-12">
          <div class="card">
            <div class="card-header text-center">
              <i class="fas fa-history me-2"></i>Riwayat Perubahan Data
            </div>
            <div class="card-body">
              <div class="history-panel" id="historyPanel">
                <!-- Riwayat akan diisi oleh JavaScript -->
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal untuk Detail CS dengan Informasi Bonus -->
<div class="modal fade" id="csDetailModal" tabindex="-1" aria-labelledby="csDetailModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="csDetailModalLabel">Detail Kesalahan CS</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="text-center mb-4">
          <div class="cs-avatar mx-auto mb-2" id="modalAvatar">R</div>
          <h4 id="modalName">Nama CS</h4>
          <div class="stats-number mt-2" id="modalErrors">0</div>
          <div class="stats-label">Total Kesalahan</div>
        </div>

        <div class="detail-item">
          <span class="detail-label">Peringkat:</span>
          <span class="detail-value" id="modalRank">-</span>
        </div>

        <div class="detail-item">
          <span class="detail-label">Status:</span>
          <span class="detail-value" id="modalStatus">-</span>
        </div>

        <div class="detail-item">
          <span class="detail-label">Performa:</span>
          <span class="detail-value" id="modalPerformance">-</span>
        </div>

        <!-- Bagian Bonus yang Ditambahkan -->
        <div class="bonus-section">
          <div class="bonus-title">
            <i class="fas fa-money-bill-wave"></i>
            <span>Perhitungan Bonus</span>
          </div>
          
          <div class="bonus-item">
            <span class="bonus-label">Bonus Penuh:</span>
            <span class="bonus-value bonus-full" id="modalBonusFull">Rp 30,000,000</span>
          </div>
          
          <div class="bonus-item">
            <span class="bonus-label">Potongan:</span>
            <span class="bonus-value bonus-cut" id="modalBonusCut">0% (Rp 0)</span>
          </div>
          
          <div class="bonus-item">
            <span class="bonus-label">Bonus Diterima:</span>
            <span class="bonus-value bonus-final" id="modalBonusFinal">Rp 30,000,000</span>
          </div>
          
          <div class="bonus-rule" id="modalBonusRule">
            Aturan: 1-25 kesalahan = 100% bonus, 26-40 = potong 15%, 41-55 = potong 30%, 56-70 = potong 50%, 71-85 = potong 75%, 86+ = Rp 5,000,000
          </div>
        </div>

        <div class="motivation-message mt-3 p-3 rounded" id="modalMessage">
          <!-- Pesan motivasi akan diisi oleh JavaScript -->
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Tutup</button>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
// Data dari Google Sheets
let csData = [];
let previousData = [];
let autoUpdateInterval;
let csDetailModal = new bootstrap.Modal(document.getElementById('csDetailModal'));
let errorDistributionChart = null;
let historyData = [];

// Fungsi untuk membuat partikel latar belakang
function createParticles() {
  const particlesContainer = document.getElementById('particles');
  const numberOfParticles = 30;
  
  for (let i = 0; i < numberOfParticles; i++) {
    const particle = document.createElement('div');
    particle.classList.add('particle');
    
    // Random size and position
    const size = Math.random() * 20 + 5;
    const posX = Math.random() * 100;
    const posY = Math.random() * 100;
    
    particle.style.width = `${size}px`;
    particle.style.height = `${size}px`;
    particle.style.left = `${posX}%`;
    particle.style.top = `${posY}%`;
    
    // Random animation duration and delay
    const duration = Math.random() * 20 + 10;
    const delay = Math.random() * 5;
    
    particle.style.animationDuration = `${duration}s`;
    particle.style.animationDelay = `${delay}s`;
    
    particlesContainer.appendChild(particle);
  }
}

// Fungsi untuk menghitung bonus berdasarkan kesalahan
function calculateBonus(errors) {
  const fullBonus = 30000000; // Rp 30,000,000
  
  if (errors <= 25) {
    return {
      cutPercentage: 0,
      cutAmount: 0,
      finalBonus: fullBonus,
      rule: "1-25 kesalahan: Bonus 100% (tidak dipotong)"
    };
  } else if (errors <= 40) {
    const cutPercentage = 15;
    const cutAmount = fullBonus * (cutPercentage / 100);
    return {
      cutPercentage,
      cutAmount,
      finalBonus: fullBonus - cutAmount,
      rule: "26-40 kesalahan: Potongan 15%"
    };
  } else if (errors <= 55) {
    const cutPercentage = 30;
    const cutAmount = fullBonus * (cutPercentage / 100);
    return {
      cutPercentage,
      cutAmount,
      finalBonus: fullBonus - cutAmount,
      rule: "41-55 kesalahan: Potongan 30%"
    };
  } else if (errors <= 70) {
    const cutPercentage = 50;
    const cutAmount = fullBonus * (cutPercentage / 100);
    return {
      cutPercentage,
      cutAmount,
      finalBonus: fullBonus - cutAmount,
      rule: "56-70 kesalahan: Potongan 50%"
    };
  } else if (errors <= 85) {
    const cutPercentage = 75;
    const cutAmount = fullBonus * (cutPercentage / 100);
    return {
      cutPercentage,
      cutAmount,
      finalBonus: fullBonus - cutAmount,
      rule: "71-85 kesalahan: Potongan 75%"
    };
  } else {
    return {
      cutPercentage: 100,
      cutAmount: fullBonus - 5000000,
      finalBonus: 5000000,
      rule: "86+ kesalahan: Bonus hanya Rp 5,000,000"
    };
  }
}

// Fungsi untuk memformat angka menjadi format Rupiah
function formatRupiah(amount) {
  return new Intl.NumberFormat('id-ID', {
    style: 'currency',
    currency: 'IDR',
    minimumFractionDigits: 0
  }).format(amount);
}

// Fungsi untuk mengatur status berdasarkan jumlah kesalahan
function getStatus(errors) {
  if (errors === 0) return { text: "Excellent", class: "status-good" };
  if (errors <= 5) return { text: "Good", class: "status-good" };
  if (errors <= 20) return { text: "Warning", class: "status-warning" };
  return { text: "Danger", class: "status-danger" };
}

// Fungsi untuk mendapatkan pesan motivasi berdasarkan jumlah kesalahan
function getMotivationMessage(errors, name) {
  if (errors <= 25) {
    return `<div class="alert alert-success">
      <i class="fas fa-check-circle me-2"></i>Pertahankan, ${name.split(' ')[0]}! Performa Anda sudah baik. Bonus Anda tidak dipotong.
    </div>`;
  } else if (errors <= 85) {
    const bonusInfo = calculateBonus(errors);
    return `<div class="alert alert-warning">
      <i class="fas fa-exclamation-circle me-2"></i>Perbaiki kinerja Anda, ${name.split(' ')[0]}! Bonus Anda dipotong ${bonusInfo.cutPercentage}%.
    </div>`;
  } else {
    return `<div class="alert alert-danger">
      <i class="fas fa-times-circle me-2"></i>Perlu perbaikan serius, ${name.split(' ')[0]}! Bonus Anda hanya Rp 5,000,000.
    </div>`;
  }
}

// Fungsi untuk mendapatkan performa berdasarkan peringkat
function getPerformance(rank, totalCS) {
  const percentage = (rank / totalCS) * 100;
  if (percentage <= 10) return "Top 10%";
  if (percentage <= 25) return "Top 25%";
  if (percentage <= 50) return "Rata-rata";
  if (percentage <= 75) return "Di bawah rata-rata";
  return "Perlu peningkatan";
}

// Fungsi untuk menampilkan detail CS
function showCSDetail(cs, rank) {
  const status = getStatus(cs.errors);
  const performance = getPerformance(rank, csData.length);
  const bonusInfo = calculateBonus(cs.errors);

  document.getElementById('modalAvatar').textContent = cs.name.charAt(0);
  document.getElementById('modalName').textContent = cs.name;
  document.getElementById('modalErrors').textContent = cs.errors;
  document.getElementById('modalRank').textContent = `#${rank}`;
  document.getElementById('modalStatus').innerHTML = `<span class="status-badge ${status.class}">${status.text}</span>`;
  document.getElementById('modalPerformance').textContent = performance;
  
  // Update informasi bonus
  document.getElementById('modalBonusFull').textContent = formatRupiah(30000000);
  document.getElementById('modalBonusCut').textContent = 
    `${bonusInfo.cutPercentage}% (${formatRupiah(bonusInfo.cutAmount)})`;
  document.getElementById('modalBonusFinal').textContent = formatRupiah(bonusInfo.finalBonus);
  document.getElementById('modalBonusRule').textContent = bonusInfo.rule;
  
  document.getElementById('modalMessage').innerHTML = getMotivationMessage(cs.errors, cs.name);

  csDetailModal.show();
}

// Fungsi untuk menampilkan notifikasi
function showNotification(type, message) {
  const notification = document.getElementById('updateNotification');
  const icon = notification.querySelector('.notification-icon');
  const strong = notification.querySelector('strong');
  const div = notification.querySelector('div');
  notification.className = `floating-notification ${type}`;
  icon.className = `fas ${type === 'success' ? 'fa-check-circle' : 'fa-exclamation-circle'} notification-icon notification-${type}`;
  strong.textContent = type === 'success' ? 'Data Diperbarui!' : 'Error!';
  div.innerHTML = message;
  notification.classList.add('show');
  setTimeout(() => {
    notification.classList.remove('show');
  }, 3000);
}

// Fungsi untuk menambahkan riwayat
function addHistory(message) {
  const now = new Date();
  const timeString = now.toLocaleTimeString('id-ID');
  const dateString = now.toLocaleDateString('id-ID', {
    weekday: 'long',
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  });

  historyData.unshift({
    time: `${dateString} ${timeString}`,
    message: message
  });

  // Batasi riwayat hingga 10 item
  if (historyData.length > 10) {
    historyData.pop();
  }

  renderHistory();
}

// Fungsi untuk merender riwayat
function renderHistory() {
  const historyPanel = document.getElementById('historyPanel');
  historyPanel.innerHTML = historyData.map(item => `
    <div class="history-item">
      <div class="history-time">${item.time}</div>
      <div class="history-content">${item.message}</div>
    </div>
  `).join('');
}

// Fungsi untuk parsing baris CSV
function parseCSVRow(row) {
  const values = [];
  let current = '';
  let inQuote = false;

  for (let i = 0; i < row.length; i++) {
    const char = row[i];
    if (char === '"') {
      // Jika kita berada dalam quote, dan karakter berikutnya juga quote (escape)
      if (inQuote && i + 1 < row.length && row[i + 1] === '"') {
        current += '"';
        i++; // Lewati karakter quote berikutnya
      } else {
        inQuote = !inQuote;
      }
    } else if (char === ',' && !inQuote) {
      values.push(current);
      current = '';
    } else {
      current += char;
    }
  }
  values.push(current);

  return values.map(value => value.trim());
}

// Fungsi untuk parsing CSV
function parseCSV(csv) {
  const rows = csv.split(/\r?\n/).filter(row => row.trim() !== '');
  if (rows.length === 0) return { headers: [], data: [] };

  const headers = parseCSVRow(rows[0]);
  const data = [];

  for (let i = 1; i < rows.length; i++) {
    const row = parseCSVRow(rows[i]);
    if (row.length > 1) { // Hanya tambahkan baris yang memiliki data
      data.push(row);
    }
  }

  return { headers, data };
}

// Fungsi untuk memuat data dari Google Sheets
async function fetchDataFromSheet() {
  try {
    // Tampilkan loading indicator
    document.getElementById('loadingIndicator').style.display = 'flex';
    
    // URL Google Sheets yang sudah dipublikasikan
    const sheetUrl = 'https://docs.google.com/spreadsheets/d/1WMbp6aWmubH5R0lAtIMMQbKDuzfCmh4qrUCEBxqZK9E/gviz/tq?tqx=out:csv&sheet=part1';
    const response = await fetch(sheetUrl);
    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }
    const csvData = await response.text();

    // Parsing CSV dengan fungsi yang lebih andal
    const parsedData = parseCSV(csvData);

    const headers = parsedData.headers;
    const rows = parsedData.data;

    // Cari indeks kolom yang benar
    const nameIndex = headers.findIndex(header =>
      header.toLowerCase().includes('nama') || header.toLowerCase().includes('cs')
    );
    const errorIndex = headers.findIndex(header =>
      header.toLowerCase().includes('total') || header.toLowerCase().includes('kesalahan')
    );

    // Jika tidak menemukan kolom yang sesuai, gunakan kolom pertama dan kedua
    const finalNameIndex = nameIndex !== -1 ? nameIndex : 0;
    const finalErrorIndex = errorIndex !== -1 ? errorIndex : 1;

    const data = [];
    for (let i = 0; i < rows.length; i++) {
      const row = rows[i];
      if (row.length <= Math.max(finalNameIndex, finalErrorIndex)) continue;

      const name = row[finalNameIndex] || 'Tidak Diketahui';
      const errors = parseInt(row[finalErrorIndex]) || 0;
      
      // Hanya tambahkan jika nama tidak kosong
      if (name && name !== 'Tidak Diketahui') {
        data.push({ name, errors });
      }
    }

    // Simpan data sebelumnya untuk perbandingan
    previousData = [...csData];

    // Filter CS tertentu yang ingin dihilangkan
    csData = data.filter(cs =>
      !cs.name.includes("RINAL ABDILLAH NASUTION") &&
      !cs.name.includes("ANDI") &&
      !cs.name.includes("CHARLIE")
    );

    renderData();
    showNotification('success', 'Data terbaru telah berhasil diambil');
    addHistory('Data diperbarui dari Google Sheets');
  } catch (error) {
    console.error('Error fetching data:', error);
    showNotification('error', 'Gagal memuat data: ' + error.message);
    addHistory('Gagal memuat data: ' + error.message);

    // Jika tidak ada data sebelumnya, tampilkan pesan error
    if (csData.length === 0) {
      document.getElementById('totalErrors').textContent = 'Error';
      document.getElementById('totalCS').textContent = 'Error';
      document.getElementById('averageErrors').textContent = 'Error';
      document.getElementById('criticalCount').textContent = 'Error';
      document.getElementById('csCount').textContent = 'Error';
    }
  } finally {
    // Sembunyikan loading indicator
    document.getElementById('loadingIndicator').style.display = 'none';
  }
}

// Fungsi untuk merender data
function renderData() {
  // Urutkan data berdasarkan jumlah kesalahan (dari terkecil ke terbesar)
  const sortedData = [...csData].sort((a, b) => a.errors - b.errors);

  // Hitung statistik
  const totalErrors = sortedData.reduce((sum, cs) => sum + cs.errors, 0);
  const totalCS = sortedData.length;
  const averageErrors = totalCS > 0 ? (totalErrors / totalCS).toFixed(1) : 0;
  const criticalCount = sortedData.filter(cs => cs.errors > 25).length;

  // Update statistik
  document.getElementById('totalErrors').textContent = totalErrors;
  document.getElementById('totalCS').textContent = totalCS;
  document.getElementById('averageErrors').textContent = averageErrors;
  document.getElementById('criticalCount').textContent = criticalCount;
  document.getElementById('csCount').textContent = `${totalCS} CS`;

  // Update waktu terakhir
  document.getElementById('lastUpdated').innerHTML = `<i class="fas fa-clock me-1"></i>Terakhir diperbarui: ${new Date().toLocaleTimeString('id-ID')}`;

  // Render top 3
  const top3 = sortedData.slice(0, 3);
  const top3Html = top3.map((cs, index) => {
    const status = getStatus(cs.errors);
    const shortName = cs.name.split(' ')[0];
    const bonusInfo = calculateBonus(cs.errors);
    return `
      <div class="col-md-4 mb-3">
        <div class="winner-card winner-card-${index+1} text-center p-3">
          <div class="winner-badge">${index === 0 ? 'ðŸ¥‡' : index === 1 ? 'ðŸ¥ˆ' : 'ðŸ¥‰'}</div>
          <h4>Juara ${index+1}</h4>
          <div class="cs-avatar mx-auto mb-2">${shortName.charAt(0)}</div>
          <h5>${shortName}</h5>
          <p class="mb-1 text-truncate">${cs.name.split(' ').slice(1).join(' ')}</p>
          <div class="stats-number ${cs.errors === 0 ? 'text-success' : 'text-primary'}">${cs.errors}</div>
          <div class="stats-label">Kesalahan</div>
          <span class="status-badge ${status.class}">${status.text}</span>
          <div class="mt-2 small">Bonus: ${formatRupiah(bonusInfo.finalBonus)}</div>
        </div>
      </div>
    `;
  }).join('');
  document.getElementById('top3Container').innerHTML = top3Html;

  // Render tabel
  const tableHtml = sortedData.map((cs, index) => {
    const status = getStatus(cs.errors);
    const bonusInfo = calculateBonus(cs.errors);
    let bonusCutText = "";
    
    if (bonusInfo.cutPercentage === 0) {
      bonusCutText = `<span class="text-success">0%</span>`;
    } else if (cs.errors >= 86) {
      bonusCutText = `<span class="text-danger">Rp 5,000,000</span>`;
    } else {
      bonusCutText = `<span class="text-warning">${bonusInfo.cutPercentage}%</span>`;
    }
    
    let rankBadge = `<div class="rank-badge">${index+1}</div>`;
    if (index === 0) rankBadge = `<div class="rank-badge rank-1">1</div>`;
    else if (index === 1) rankBadge = `<div class="rank-badge rank-2">2</div>`;
    else if (index === 2) rankBadge = `<div class="rank-badge rank-3">3</div>`;
    
    return `
      <tr>
        <td>${rankBadge}</td>
        <td>
          <div class="cs-name-container">
            <div class="cs-avatar">${cs.name.charAt(0)}</div>
            <div class="cs-name" onclick="showCSDetail(${JSON.stringify(cs).replace(/"/g, '&quot;')}, ${index+1})">${cs.name}</div>
          </div>
        </td>
        <td>${cs.errors}</td>
        <td><span class="status-badge ${status.class}">${status.text}</span></td>
        <td>${bonusCutText}</td>
      </tr>
    `;
  }).join('');
  document.getElementById('csTableBody').innerHTML = tableHtml;

  // Render chart distribusi kesalahan
  renderErrorDistributionChart(sortedData);
}

// Fungsi untuk merender chart distribusi kesalahan
function renderErrorDistributionChart(data) {
  const ctx = document.getElementById('errorDistributionChart').getContext('2d');

  // Hancurkan chart sebelumnya jika ada
  if (errorDistributionChart) {
    errorDistributionChart.destroy();
  }

  // Siapkan data untuk chart
  const labels = data.map(cs => {
    const names = cs.name.split(' ');
    return names.length > 1 ? `${names[0]} ${names[1].charAt(0)}.` : names[0];
  });
  const errors = data.map(cs => cs.errors);
  const backgroundColors = data.map(cs => {
    const status = getStatus(cs.errors);
    if (status.class === 'status-good') return 'rgba(16, 185, 129, 0.7)';
    if (status.class === 'status-warning') return 'rgba(245, 158, 11, 0.7)';
    return 'rgba(239, 68, 68, 0.7)';
  });

  // Buat chart baru
  errorDistributionChart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: labels,
      datasets: [{
        label: 'Jumlah Kesalahan',
        data: errors,
        backgroundColor: backgroundColors,
        borderColor: 'rgba(165, 180, 252, 0.8)',
        borderWidth: 1
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      scales: {
        y: {
          beginAtZero: true,
          title: {
            display: true,
            text: 'Jumlah Kesalahan',
            color: '#f8fafc'
          },
          grid: {
            color: 'rgba(255, 255, 255, 0.1)'
          },
          ticks: {
            color: '#f8fafc',
            textShadow: '0 1px 2px rgba(0, 0, 0, 0.3)'
          }
        },
        x: {
          ticks: {
            maxRotation: 45,
            minRotation: 45,
            color: '#f8fafc',
            textShadow: '0 1px 2px rgba(0, 0, 0, 0.3)'
          },
          grid: {
            color: 'rgba(255, 255, 255, 0.1)'
          }
        }
      },
      plugins: {
        legend: {
          display: false
        },
        tooltip: {
          callbacks: {
            label: function(context) {
              return `Kesalahan: ${context.raw}`;
            },
            afterLabel: function(context) {
              const cs = data[context.dataIndex];
              const status = getStatus(cs.errors);
              const bonusInfo = calculateBonus(cs.errors);
              return `Status: ${status.text}\nBonus: ${formatRupiah(bonusInfo.finalBonus)}`;
            }
          },
          backgroundColor: 'rgba(30, 41, 59, 0.9)',
          titleColor: '#f8fafc',
          bodyColor: '#f8fafc',
          borderColor: 'rgba(165, 180, 252, 0.5)',
          borderWidth: 1,
          titleFont: {
            weight: 'bold'
          }
        }
      }
    }
  });
}

// Fungsi untuk memulai auto-update
function startAutoUpdate() {
  // Hapus interval sebelumnya jika ada
  if (autoUpdateInterval) {
    clearInterval(autoUpdateInterval);
  }
  // Set interval untuk auto-update setiap 2 menit
  autoUpdateInterval = setInterval(fetchDataFromSheet, 120000);
  // Tampilkan indikator auto-update
  document.getElementById('autoUpdateIndicator').style.display = 'flex';
}

// Fungsi untuk menghentikan auto-update
function stopAutoUpdate() {
  if (autoUpdateInterval) {
    clearInterval(autoUpdateInterval);
  }
  // Sembunyikan indikator auto-update
  document.getElementById('autoUpdateIndicator').style.display = 'none';
}

// Fungsi untuk memfilter tabel
function filterTable() {
  const searchText = document.getElementById('searchInput').value.toLowerCase();
  const statusFilter = document.getElementById('statusFilter').value;
  const rows = document.querySelectorAll('#csTableBody tr');

  rows.forEach(row => {
    const name = row.querySelector('.cs-name').textContent.toLowerCase();
    const status = row.querySelector('.status-badge').classList.contains('status-good') ? 'good' :
      row.querySelector('.status-badge').classList.contains('status-warning') ? 'warning' : 'danger';

    const nameMatch = name.includes(searchText);
    const statusMatch = statusFilter === 'all' || status === statusFilter;

    row.style.display = (nameMatch && statusMatch) ? '' : 'none';
  });
}

// Event listener saat halaman dimuat
document.addEventListener('DOMContentLoaded', function() {
  // Buat partikel latar belakang
  createParticles();
  
  // Muat data pertama kali
  fetchDataFromSheet();
  // Mulai auto-update
  startAutoUpdate();

  // Event listener untuk tombol refresh
  document.getElementById('refreshBtn').addEventListener('click', function() {
    this.classList.add('rotating');
    fetchDataFromSheet();
    setTimeout(() => {
      this.classList.remove('rotating');
    }, 1000);
  });

  // Event listener untuk pencarian dan filter
  document.getElementById('searchInput').addEventListener('input', filterTable);
  document.getElementById('statusFilter').addEventListener('change', filterTable);

  // Inisialisasi tab Bootstrap
  const triggerTabList = [].slice.call(document.querySelectorAll('#dashboardTabs button'));
  triggerTabList.forEach(function (triggerEl) {
    new bootstrap.Tab(triggerEl);
  });
});

// Handle visibilitas halaman untuk mengoptimalkan auto-update
document.addEventListener('visibilitychange', function() {
  if (document.hidden) {
    // Hentikan auto-update ketika tab tidak aktif
    stopAutoUpdate();
  } else {
    // Lanjutkan auto-update ketika tab aktif kembali
    startAutoUpdate();
    // Perbarui data
    fetchDataFromSheet();
  }
});
</script>
</body>
</html>
