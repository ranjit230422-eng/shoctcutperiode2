<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Jula-Jula - Login</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* --- GAYA UMUM & TEMA LUAR ANGKASA --- */
        :root {
            --bg-primary: #0f0c29;
            --bg-secondary: #302b63;
            --bg-tertiary: #24243e;
            --accent-cyan: #00d2ff;
            --accent-magenta: #ff00ff;
            --accent-purple: #9d50bb;
            --accent-red: #e74c3c;
            --text-primary: #f0f0f0;
            --text-muted: #a0a0a0;
            --card-bg: rgba(255, 255, 255, 0.05);
            --card-border: rgba(255, 255, 255, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: linear-gradient(to bottom, var(--bg-primary), var(--bg-secondary), var(--bg-tertiary));
            color: var(--text-primary);
            font-family: 'Orbitron', sans-serif;
            line-height: 1.6;
            overflow-x: hidden;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        /* --- BINTANG-BINTANG --- */
        #stars-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
        }
        .star {
            position: absolute;
            background-color: white;
            border-radius: 50%;
            animation: twinkle 3s infinite;
        }
        @keyframes twinkle {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }

        /* --- KONTAINER LOGIN --- */
        #login-container {
            z-index: 10;
            text-align: center;
        }

        .login-card {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
            border: 1px solid var(--card-border);
            padding: 40px;
            width: 90%;
            max-width: 400px;
        }

        .login-card h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            background: linear-gradient(135deg, var(--accent-cyan), var(--accent-magenta));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .login-card p {
            color: var(--text-muted);
            margin-bottom: 30px;
        }

        .login-form .form-group {
            margin-bottom: 20px;
            text-align: left;
        }
        .login-form label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-muted);
        }
        .login-form input {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--card-border);
            border-radius: 10px;
            font-size: 1rem;
            background: rgba(255,255,255,0.1);
            color: var(--text-primary);
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        .login-form input:focus {
            outline: none;
            border-color: var(--accent-cyan);
            box-shadow: 0 0 0 3px rgba(0, 210, 255, 0.2);
        }

        #loginError {
            color: var(--accent-magenta);
            margin-top: 15px;
            font-weight: 600;
            text-shadow: 0 0 5px var(--accent-magenta);
            display: none;
        }
        
        /* --- KONTAINER APLIKASI UTAMA --- */
        #main-app-container {
            display: none;
            width: 100%;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
        }

        /* --- JAM DIGITAL TIPE HUD --- */
        #datetime-display {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--card-bg);
            color: var(--accent-cyan);
            padding: 15px 20px;
            border-radius: 12px;
            box-shadow: 0 0 15px var(--accent-cyan), inset 0 0 5px rgba(0, 210, 255, 0.5);
            text-align: center;
            z-index: 100;
            border: 1px solid var(--card-border);
            font-family: 'Courier New', Courier, monospace;
        }
        #datetime-display .date {
            font-size: 0.8rem;
            font-weight: 600;
            text-shadow: 0 0 5px var(--accent-cyan);
        }
        #datetime-display .time {
            font-size: 1.4rem;
            font-weight: 700;
            text-shadow: 0 0 10px var(--accent-cyan);
        }
        
        /* --- KOMPONEN KARTU (GLASSMORPHISM) --- */
        .card {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
            border: 1px solid var(--card-border);
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 0 25px rgba(0, 210, 255, 0.3);
        }
        
        /* --- HEADER --- */
        header {
            text-align: center;
            margin-bottom: 40px;
            padding: 40px;
        }
        
        h1 {
            font-size: 3.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            background: linear-gradient(135deg, var(--accent-cyan), var(--accent-magenta));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 20px rgba(0, 210, 255, 0.5);
        }
        
        .subtitle {
            font-size: 1.2rem;
            color: var(--text-muted);
            margin-bottom: 30px;
        }

        .financial-info {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 30px;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .info-box {
            background: var(--card-bg);
            backdrop-filter: blur(5px);
            padding: 12px 25px;
            border-radius: 50px;
            font-weight: 500;
            font-size: 0.9rem;
            box-shadow: 0 4px 15px rgba(0, 210, 255, 0.2);
            border: 1px solid var(--card-border);
        }

        #totalFunds {
            background: linear-gradient(135deg, var(--accent-purple), var(--accent-magenta));
            color: white;
            font-size: 1.1rem;
            padding: 12px 25px;
            border-radius: 50px;
            font-weight: bold;
            box-shadow: 0 0 20px rgba(255, 0, 255, 0.4);
        }
        
        /* --- PANEL PENGATURAN --- */
        .settings-panel {
            padding: 30px;
            margin-bottom: 40px;
        }
        .settings-panel h2 {
            text-align: center;
            margin-bottom: 30px;
            color: var(--text-primary);
            font-weight: 600;
            text-shadow: 0 0 10px var(--accent-cyan);
        }
        .controls {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .btn {
            padding: 12px 28px;
            border: none;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            color: white;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .btn-primary { background: linear-gradient(135deg, var(--accent-cyan), #0077be); box-shadow: 0 0 15px var(--accent-cyan); }
        .btn-secondary { background: linear-gradient(135deg, var(--accent-magenta), #b300b3); box-shadow: 0 0 15px var(--accent-magenta); }
        .btn-swap { background: linear-gradient(135deg, var(--accent-purple), #6a0dad); box-shadow: 0 0 15px var(--accent-purple); }
        .btn-logout { background: linear-gradient(135deg, #e74c3c, #c0392b); box-shadow: 0 0 15px #e74c3c; }
        .btn-change-pass { background: linear-gradient(135deg, #f39c12, #e67e22); box-shadow: 0 0 15px #f39c12; }
        .btn-delete { background: linear-gradient(135deg, var(--accent-red), #c0392b); box-shadow: 0 0 15px var(--accent-red); }
        
        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 0 25px var(--accent-cyan);
        }
        .btn:disabled { background: #555; cursor: not-allowed; transform: none; box-shadow: none; }

        .generate-counter {
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        .order-display {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .order-item {
            background: var(--card-bg);
            backdrop-filter: blur(5px);
            border-left: 5px solid var(--accent-cyan);
            padding: 20px;
            border-radius: 12px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 15px;
            box-shadow: 0 0 15px rgba(0, 210, 255, 0.2);
            border: 1px solid var(--card-border);
        }
        .order-item .order-number {
            background: linear-gradient(135deg, var(--accent-cyan), #0077be);
            color: white;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            font-size: 1.2rem;
        }
        .swap-controls { display: flex; justify-content: center; align-items: flex-end; gap: 20px; flex-wrap: wrap; }
        .form-group { display: flex; flex-direction: column; }
        .form-group label { margin-bottom: 8px; font-weight: 500; color: var(--text-muted); }
        .form-group select, .form-group input {
            padding: 12px;
            border: 1px solid var(--card-border);
            border-radius: 10px;
            font-size: 1rem;
            background: var(--card-bg);
            color: var(--text-primary);
            min-width: 200px;
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        .form-group select:focus, .form-group input:focus { 
            outline: none; 
            border-color: var(--accent-cyan); 
            box-shadow: 0 0 0 3px rgba(0, 210, 255, 0.3);
        }
        
        /* --- GRID PEMAIN --- */
        .players-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(480px, 1fr)); gap: 30px; }
        
        .player-header {
            color: white;
            padding: 25px;
            position: relative;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .player-info h2 { 
            font-size: 1.8rem; 
            font-weight: 600; 
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .player-order-tag {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.7rem;
            font-weight: 500;
            letter-spacing: 1px;
        }
        .player-info p { opacity: 0.9; font-size: 0.9rem; }
        .player-details { font-size: 0.85rem; margin-top: 12px; opacity: 0.9; }
        .player-details i { margin-right: 8px; color: rgba(255,255,255,0.8); }
        .player-actions {
            display: flex;
            gap: 10px;
        }
        .edit-btn, .delete-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 12px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2rem;
            transition: background 0.2s, transform 0.2s, box-shadow 0.2s;
        }
        .edit-btn:hover { 
            background: rgba(255, 255, 255, 0.3); 
            transform: scale(1.1);
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.5);
        }
        .delete-btn:hover {
            background: rgba(231, 76, 60, 0.7);
            transform: scale(1.1);
            box-shadow: 0 0 15px rgba(231, 76, 60, 0.7);
        }
        
        /* --- TABEL --- */
        .schedule-table { width: 100%; border-collapse: collapse; }
        .schedule-table th { background: rgba(0, 210, 255, 0.1); padding: 15px; text-align: left; font-weight: 600; color: var(--text-muted); font-size: 0.9rem; }
        .schedule-table td { padding: 15px; border-top: 1px solid var(--card-border); font-size: 0.9rem; }
        .month { font-weight: 600; color: var(--text-primary); }
        .nominal { color: var(--text-muted); }
        .drawer-info { font-weight: 600; color: var(--accent-cyan); text-shadow: 0 0 5px var(--accent-cyan); }
        .payment-status { text-align: center; }
        .btn-confirm { padding: 8px 16px; border: none; border-radius: 20px; font-size: 0.85rem; font-weight: 600; cursor: pointer; transition: all 0.2s ease; }
        .btn-unpaid { background-color: var(--accent-magenta); color: white; box-shadow: 0 0 10px var(--accent-magenta); }
        .btn-unpaid:hover { background-color: #cc00cc; }
        .btn-paid { background-color: var(--accent-cyan); color: white; cursor: default; box-shadow: 0 0 10px var(--accent-cyan); }
        .highlight { background-color: rgba(0, 210, 255, 0.1) !important; font-weight: 600; }
        .current-drawer { background-color: rgba(255, 0, 255, 0.1) !important; border-left: 4px solid var(--accent-magenta); }
        
        /* --- MODAL --- */
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.7); }
        .modal-content { background: var(--card-bg); backdrop-filter: blur(10px); margin: 10% auto; padding: 0; border-radius: 16px; width: 90%; max-width: 500px; box-shadow: 0 0 30px var(--accent-cyan); animation: slideIn 0.4s; border: 1px solid var(--card-border); }
        .modal-header { background: linear-gradient(135deg, var(--accent-cyan), #0077be); color: white; padding: 25px; border-radius: 16px 16px 0 0; display: flex; justify-content: space-between; align-items: center; }
        .modal-header h2 { margin: 0; font-weight: 600; }
        .close { color: white; font-size: 28px; font-weight: bold; cursor: pointer; opacity: 0.8; transition: opacity 0.2s; }
        .close:hover { opacity: 1; }
        .modal-body { padding: 30px; }
        .form-group-modal { margin-bottom: 20px; }
        .form-group-modal label { display: block; margin-bottom: 8px; font-weight: 500; color: var(--text-muted); }
        .form-group-modal input { width: 100%; padding: 12px; border: 1px solid var(--card-border); border-radius: 10px; font-size: 1rem; background: rgba(255,255,255,0.1); color: var(--text-primary); }
        .form-group-modal input:focus { outline: none; border-color: var(--accent-cyan); box-shadow: 0 0 0 3px rgba(0, 210, 255, 0.3); }
        
        /* --- NOTIFIKASI --- */
        .notification { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); padding: 15px 25px; background: var(--accent-cyan); color: var(--bg-primary); border-radius: 10px; box-shadow: 0 0 20px var(--accent-cyan); display: none; z-index: 2000; animation: slideIn 0.5s ease; font-weight: 600; }
        
        /* --- ANIMASI --- */
        @keyframes slideIn { from { transform: translateY(-30px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        
        /* --- RESPONSIVE --- */
        @media (max-width: 768px) {
            .players-grid { grid-template-columns: 1fr; } h1 { font-size: 2.5rem; } .controls { flex-direction: column; align-items: center; } .btn { width: 100%; justify-content: center; } .financial-info { flex-direction: column; gap: 15px; } .swap-controls { flex-direction: column; align-items: center; }
            #datetime-display { position: static; margin: 20px auto; display: block; width: fit-content; }
        }
    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Kontainer untuk Bintang -->
    <div id="stars-container"></div>

    <!-- Kontener Login -->
    <div id="login-container">
        <div class="login-card">
            <h1><i class="fas fa-rocket"></i> Jula-Jula</h1>
            <p>Silakan masuk untuk melanjutkan</p>
            <form id="loginForm" class="login-form">
                <div class="form-group">
                    <label for="username">Nama Pengguna (Depan)</label>
                    <input type="text" id="username" placeholder="Contoh: RANJIT, SUHAN, AMRUL" required>
                </div>
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" placeholder="Masukkan password" required>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%; justify-content: center;"><i class="fas fa-sign-in-alt"></i> Masuk</button>
                <div id="loginError">Nama atau password salah!</div>
            </form>
        </div>
    </div>

    <!-- Kontainer Aplikasi Utama -->
    <div id="main-app-container">
        <!-- Jam Digital Tipe HUD -->
        <div id="datetime-display">
            <div class="date"></div>
            <div class="time"></div>
        </div>

        <div class="notification" id="notification"></div>
        
        <!-- Modal Edit Info Pemain -->
        <div id="editModal" class="modal">
            <div class="modal-content">
                <div class="modal-header"><h2><i class="fas fa-user-edit"></i> Edit Info Penarikan</h2><span class="close">&times;</span></div>
                <div class="modal-body">
                    <form id="editForm">
                        <div class="form-group-modal"><label for="bankName"><i class="fas fa-university"></i> Nama Bank</label><input type="text" id="bankName" placeholder="Contoh: Bank Central Asia"></div>
                        <div class="form-group-modal"><label for="accountNumber"><i class="fas fa-credit-card"></i> Nomor Rekening</label><input type="text" id="accountNumber" placeholder="Contoh: 1234567890"></div>
                        <div class="form-group-modal"><label for="ewalletProvider"><i class="fas fa-wallet"></i> Penyedia E-Wallet</label><input type="text" id="ewalletProvider" placeholder="Contoh: GoPay, OVO, DANA"></div>
                        <button type="submit" class="btn btn-primary" style="width: 100%; justify-content: center;"><i class="fas fa-save"></i> Simpan Perubahan</button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Modal Ganti Password -->
        <div id="changePasswordModal" class="modal">
            <div class="modal-content">
                <div class="modal-header" style="background: linear-gradient(135deg, #f39c12, #e67e22);"><h2><i class="fas fa-key"></i> Ganti Password</h2><span class="close-pass">&times;</span></div>
                <div class="modal-body">
                    <form id="changePasswordForm">
                        <div class="form-group-modal"><label for="currentPassword">Password Lama</label><input type="password" id="currentPassword" placeholder="Masukkan password lama Anda" required></div>
                        <div class="form-group-modal"><label for="newPassword">Password Baru</label><input type="password" id="newPassword" placeholder="Masukkan password baru" required></div>
                        <div class="form-group-modal"><label for="confirmNewPassword">Konfirmasi Password Baru</label><input type="password" id="confirmNewPassword" placeholder="Ketik ulangi password baru" required></div>
                        <button type="submit" class="btn btn-change-pass" style="width: 100%; justify-content: center;"><i class="fas fa-save"></i> Simpan Password Baru</button>
                    </form>
                </div>
            </div>
        </div>

        <div class="container">
            <header>
                <h1><i class="fas fa-rocket"></i> Sistem Jula-Jula</h1>
                <p class="subtitle">Kelola pembayaran dan penarikan di luar angkasa</p>
                <div><span class="info-box"><i class="far fa-calendar-alt"></i> Mulai: Desember 2025</span><span class="info-box"><i class="fas fa-money-bill-wave"></i> Penarikan: Tgl 25</span><span class="info-box"><i class="fas fa-clock"></i> Periode: 6 Bulan</span></div>
                <div class="financial-info">
                    <div id="totalFunds"><i class="fas fa-wallet"></i> Total Dana: Rp 0</div>
                    <!-- Tombol Logout dan Ganti Password -->
                    <button class="btn btn-change-pass" id="changePasswordBtn"><i class="fas fa-key"></i> Ganti Password</button>
                    <button class="btn btn-logout" id="logoutBtn"><i class="fas fa-sign-out-alt"></i> Keluar</button>
                </div>
            </header>
            
            <div class="card settings-panel">
                <h2><i class="fas fa-satellite-dish"></i> Pengaturan Urutan Penarikan</h2>
                <div class="controls">
                    <button class="btn btn-primary" id="generateBtn"><i class="fas fa-random"></i> Generate Urutan</button>
                    <span class="generate-counter" id="generateCounter"></span>
                    <button class="btn btn-secondary" id="resetBtn"><i class="fas fa-redo"></i> Reset Semua Data</button>
                </div>
                
                <div id="orderDisplayContainer"></div>

                <div class="swap-controls">
                    <div class="form-group">
                        <label for="swapOrderSelect">Pilih Urutan yang Akan Diubah</label>
                        <select id="swapOrderSelect"></select>
                    </div>
                    <div class="form-group">
                        <label for="swapPlayerSelect">Pilih Pemain Baru</label>
                        <select id="swapPlayerSelect"></select>
                    </div>
                    <button class="btn btn-swap" id="swapBtn" disabled><i class="fas fa-exchange-alt"></i> Ganti Urutan</button>
                </div>
            </div>
            
            <div class="players-grid"></div>
            
            <footer style="text-align: center; margin-top: 40px; color: var(--text-muted); padding: 20px; font-size: 0.9rem;"><p>Sistem Jula-Jula &copy; 2025 - Dibuat dengan <i class="fas fa-heart" style="color: var(--accent-magenta);"></i></p></footer>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DATA PEMAIN DAN KONFIGURASI ---
            const initialPlayers = [
                { name: "RANJIT", id: "X1068990", bankName: "", accountNumber: "", ewalletProvider: "", password: "123", isAdmin: true },
                { name: "SUHAN RAZ", id: "C5862955", bankName: "", accountNumber: "", ewalletProvider: "", password: "123", isAdmin: false },
                { name: "AMRUL", id: "E2365928", bankName: "", accountNumber: "", ewalletProvider: "", password: "123", isAdmin: false },
                { name: "AGUNG DEDI IRAWAN", id: "E7089147", bankName: "", accountNumber: "", ewalletProvider: "", password: "123", isAdmin: false },
                { name: "JONROMAN PURBA", id: "C8491005", bankName: "", accountNumber: "", ewalletProvider: "", password: "123", isAdmin: false },
                { name: "RAHMADI SORMIN", id: "E0685561", bankName: "", accountNumber: "", ewalletProvider: "", password: "123", isAdmin: false }
            ];
            const months = ["Desember", "Januari", "Februari", "Maret", "April", "Mei"];
            const years = [2025, 2026, 2026, 2026, 2026, 2026];
            const MAX_GENERATE_COUNT = 3;
            const FIXED_CONTRIBUTION = 5000000;
            
            let currentEditingPlayerIndex = -1;
            let currentUser = null;

            // --- ELEMEN DOM ---
            const loginContainer = document.getElementById('login-container');
            const mainAppContainer = document.getElementById('main-app-container');
            const loginForm = document.getElementById('loginForm');
            const loginError = document.getElementById('loginError');
            const logoutBtn = document.getElementById('logoutBtn');
            const changePasswordBtn = document.getElementById('changePasswordBtn');
            const changePasswordModal = document.getElementById('changePasswordModal');
            const changePasswordForm = document.getElementById('changePasswordForm');
            const closeChangePassModalBtn = document.querySelector('.close-pass');

            const playersGrid = document.querySelector('.players-grid');
            const editModal = document.getElementById('editModal');
            const editForm = document.getElementById('editForm');
            const notificationEl = document.getElementById('notification');
            const totalFundsEl = document.getElementById('totalFunds');
            const orderDisplayContainer = document.getElementById('orderDisplayContainer');
            const swapOrderSelect = document.getElementById('swapOrderSelect');
            const swapPlayerSelect = document.getElementById('swapPlayerSelect');
            const swapBtn = document.getElementById('swapBtn');
            const generateBtn = document.getElementById('generateBtn');
            const generateCounterEl = document.getElementById('generateCounter');
            
            const datetimeDisplay = document.getElementById('datetime-display');
            const dateEl = datetimeDisplay.querySelector('.date');
            const timeEl = datetimeDisplay.querySelector('.time');

            // --- FUNGSI-FUNGSI UTAMA ---
            function showNotification(message, type = 'success') {
                notificationEl.textContent = message; 
                notificationEl.style.background = type === 'success' ? 'var(--accent-cyan)' : 'var(--accent-magenta)'; 
                notificationEl.style.color = 'var(--bg-primary)';
                notificationEl.style.display = 'block';
                setTimeout(() => { notificationEl.style.display = 'none'; }, 3000);
            }

            function loadData() {
                const savedData = localStorage.getItem('julaJulaData');
                if (savedData) {
                    const data = JSON.parse(savedData);
                    // Pastikan data pemain ada dan memiliki password
                    if (!data.players || data.players.length === 0) {
                        data.players = JSON.parse(JSON.stringify(initialPlayers));
                    }
                    data.players.forEach((player, index) => {
                        if (!player.password) {
                            data.players[index].password = initialPlayers[index].password;
                        }
                        if (player.isAdmin === undefined) {
                            data.players[index].isAdmin = initialPlayers[index].isAdmin;
                        }
                    });
                    if (typeof data.generateCount === 'undefined') data.generateCount = 0;
                    return data;
                }
                return { 
                    players: JSON.parse(JSON.stringify(initialPlayers)), 
                    monthlyContribution: FIXED_CONTRIBUTION,
                    drawerOrder: Array(6).fill(-1), 
                    paymentStatus: initialPlayers.map(() => Array(6).fill(false)),
                    generateCount: 0
                };
            }

            function saveData(data) { localStorage.setItem('julaJulaData', JSON.stringify(data)); }
            
            function renderOrderDisplay() {
                const appData = loadData();
                const hasOrder = appData.drawerOrder.every(order => order !== -1);
                const remainingGenerates = MAX_GENERATE_COUNT - appData.generateCount;
                generateCounterEl.textContent = `Sisa Generate: ${remainingGenerates}`;
                
                if (remainingGenerates <= 0) { generateBtn.disabled = true; generateBtn.style.opacity = '0.5'; }
                else { generateBtn.disabled = false; generateBtn.style.opacity = '1'; }

                if (!hasOrder) {
                    orderDisplayContainer.innerHTML = `<p style="text-align:center; color: var(--text-muted);">Belum ada urutan penarikan. Klik "Generate Urutan" untuk memulai.</p>`;
                    swapOrderSelect.innerHTML = '<option value="">-- Generate Urutan Terlebih Dahulu --</option>';
                    swapPlayerSelect.innerHTML = '<option value="">-- Pemain --</option>';
                    swapBtn.disabled = true;
                    return;
                }
                let orderHTML = '<h3 style="color:var(--text-primary); margin-bottom: 20px;">Urutan Penarikan Saat Ini:</h3><div class="order-display">';
                appData.drawerOrder.forEach((playerIndex, orderNum) => {
                    if (playerIndex !== -1 && playerIndex < appData.players.length) {
                        const player = appData.players[playerIndex];
                        orderHTML += `<div class="order-item"><div class="order-number">${orderNum + 1}</div><span>${player.name}</span></div>`;
                    }
                });
                orderHTML += '</div>';
                orderDisplayContainer.innerHTML = orderHTML;
                swapOrderSelect.innerHTML = '';
                appData.drawerOrder.forEach((playerIndex, orderNum) => {
                    if (playerIndex !== -1 && playerIndex < appData.players.length) {
                        const player = appData.players[playerIndex];
                        swapOrderSelect.innerHTML += `<option value="${orderNum}">Urutan ${orderNum + 1} (${player.name})</option>`;
                    }
                });
                swapPlayerSelect.innerHTML = '';
                appData.players.forEach(player => {
                    swapPlayerSelect.innerHTML += `<option value="${player.name}">${player.name}</option>`;
                });
                swapBtn.disabled = false;
            }

            function renderApp() {
                const appData = loadData(); 
                playersGrid.innerHTML = ''; 
                let totalFunds = 0;
                const gradientColors = [['#00d2ff', '#0077be'], ['#ff00ff', '#b300b3'], ['#9d50bb', '#6e0b8a'], ['#f0ff00', '#c0d600'], ['#ff9a00', '#ff6200'], ['#00ff88', '#00b366']];
                
                appData.players.forEach((player, playerIndex) => {
                    const card = document.createElement('div'); 
                    card.className = 'card';
                    
                    const orderNumber = appData.drawerOrder.indexOf(playerIndex);
                    const orderDisplay = orderNumber !== -1 ? `<span class="player-order-tag">URUTAN ${orderNumber + 1}</span>` : '';
                    
                    const bankInfo = player.bankName ? `<div class="player-details"><i class="fas fa-university"></i> ${player.bankName} - ${player.accountNumber}</div>` : '';
                    const ewalletInfo = player.ewalletProvider ? `<div class="player-details"><i class="fas fa-wallet"></i> ${player.ewalletProvider}</div>` : '';
                    
                    // Tombol hapus hanya muncul untuk admin (RANJIT)
                    const deleteButtonHtml = currentUser === "RANJIT" && !player.isAdmin ? 
                        `<button class="delete-btn" data-player-index="${playerIndex}" title="Hapus Pemain"><i class="fas fa-trash"></i></button>` : '';
                    
                    card.innerHTML = `
                        <div class="player-header" style="background: linear-gradient(to right, ${gradientColors[playerIndex % 6][0]}, ${gradientColors[playerIndex % 6][1]});">
                            <div class="player-info">
                                <h2>${player.name} ${orderDisplay}</h2>
                                <p>ID: ${player.id}</p>
                                ${bankInfo}
                                ${ewalletInfo}
                            </div>
                            <div class="player-actions">
                                <button class="edit-btn" data-player-index="${playerIndex}" title="Edit Info"><i class="fas fa-edit"></i></button>
                                ${deleteButtonHtml}
                            </div>
                        </div>
                        <table class="schedule-table">
                            <thead>
                                <tr>
                                    <th>Bulan</th>
                                    <th>Iuran</th>
                                    <th>Info Penarikan</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    `;
                    playersGrid.appendChild(card);
                    const tableBody = card.querySelector('tbody');
                    for (let i = 0; i < months.length; i++) {
                        const row = document.createElement('tr'); 
                        const isDrawer = appData.drawerOrder[i] === playerIndex; 
                        const hasPaid = appData.paymentStatus[playerIndex][i];
                        if (hasPaid) totalFunds += appData.monthlyContribution; 
                        if (i === 0) row.classList.add('highlight'); 
                        if (isDrawer) row.classList.add('current-drawer');
                        
                        let drawerInfo = "Belum ditentukan";
                        if (appData.drawerOrder[i] !== -1 && appData.drawerOrder[i] < appData.players.length) {
                            const drawerPlayer = appData.players[appData.drawerOrder[i]]; 
                            const potentialTotal = appData.monthlyContribution * appData.players.length;
                            let details = `<strong>Rp ${potentialTotal.toLocaleString('id-ID')}</strong><br>`;
                            if (drawerPlayer.bankName) details += `Bank: ${drawerPlayer.bankName} (${drawerPlayer.accountNumber})<br>`;
                            if (drawerPlayer.ewalletProvider) details += `E-Wallet: ${drawerPlayer.ewalletProvider}`;
                            drawerInfo = (isDrawer ? `<i class="fas fa-user-check"></i> Anda` : `<i class="fas fa-user"></i> ${drawerPlayer.name}`) + `<br><small>${details}</small>`;
                        }
                        
                        const statusButton = document.createElement('button'); 
                        statusButton.className = 'btn-confirm';
                        if (hasPaid) { 
                            statusButton.className += ' btn-paid'; 
                            statusButton.innerHTML = '<i class="fas fa-check-circle"></i> Lunas'; 
                            statusButton.disabled = true; 
                        }
                        else { 
                            statusButton.className += ' btn-unpaid'; 
                            statusButton.innerHTML = '<i class="fas fa-times-circle"></i> Belum Bayar'; 
                            statusButton.addEventListener('click', () => togglePayment(playerIndex, i)); 
                        }
                        
                        row.innerHTML = `
                            <td class="month">${months[i]} ${years[i]}</td>
                            <td class="nominal">Rp ${appData.monthlyContribution.toLocaleString('id-ID')}</td>
                            <td class="drawer-info">${drawerInfo}</td>
                            <td class="payment-status"></td>
                        `;
                        row.querySelector('.payment-status').appendChild(statusButton); 
                        tableBody.appendChild(row);
                    }
                });
                totalFundsEl.innerHTML = `<i class="fas fa-wallet"></i> Total Dana: Rp ${totalFunds.toLocaleString('id-ID')}`;
                
                // Event listeners untuk tombol edit
                document.querySelectorAll('.edit-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const index = e.currentTarget.dataset.playerIndex;
                        const playerToEdit = appData.players[index].name;
                        if (currentUser !== playerToEdit) {
                            showNotification('Anda hanya bisa mengedit info Anda sendiri!', 'error');
                            return;
                        }
                        openEditModal(parseInt(index));
                    });
                });
                
                // Event listeners untuk tombol hapus
                document.querySelectorAll('.delete-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const index = e.currentTarget.dataset.playerIndex;
                        deletePlayer(parseInt(index));
                    });
                });
                
                renderOrderDisplay();
            }

            function deletePlayer(playerIndex) {
                const appData = loadData();
                const playerToDelete = appData.players[playerIndex];
                
                if (!confirm(`Apakah Anda yakin ingin menghapus pemain "${playerToDelete.name}"? Semua data pembayaran dan urutan terkait akan dihapus.`)) {
                    return;
                }
                
                // Hapus pemain dari array
                appData.players.splice(playerIndex, 1);
                
                // Hapus status pembayaran pemain
                appData.paymentStatus.splice(playerIndex, 1);
                
                // Perbarui drawer order
                const newDrawerOrder = [];
                appData.drawerOrder.forEach(orderIndex => {
                    if (orderIndex === playerIndex) {
                        // Jika yang dihapus adalah yang ada di urutan, ganti dengan -1
                        newDrawerOrder.push(-1);
                    } else if (orderIndex > playerIndex) {
                        // Kurangi indeks jika lebih besar dari indeks yang dihapus
                        newDrawerOrder.push(orderIndex - 1);
                    } else {
                        // Tetap sama jika lebih kecil
                        newDrawerOrder.push(orderIndex);
                    }
                });
                appData.drawerOrder = newDrawerOrder;
                
                // Simpan data dan render ulang
                saveData(appData);
                renderApp();
                showNotification(`Pemain "${playerToDelete.name}" berhasil dihapus!`);
            }

            function togglePayment(playerIndex, monthIndex) {
                const appData = loadData(); 
                appData.paymentStatus[playerIndex][monthIndex] = !appData.paymentStatus[playerIndex][monthIndex]; 
                saveData(appData); 
                renderApp();
                const action = appData.paymentStatus[playerIndex][monthIndex] ? 'dikonfirmasi' : 'dibatalkan';
                showNotification(`Pembayaran ${appData.players[playerIndex].name} untuk bulan ${months[monthIndex]} ${action}.`);
            }

            function openEditModal(playerIndex) {
                const appData = loadData(); 
                const player = appData.players[playerIndex]; 
                currentEditingPlayerIndex = playerIndex;
                document.getElementById('bankName').value = player.bankName || ''; 
                document.getElementById('accountNumber').value = player.accountNumber || ''; 
                document.getElementById('ewalletProvider').value = player.ewalletProvider || '';
                editModal.style.display = 'block';
            }

            function closeEditModal() { 
                editModal.style.display = 'none'; 
                currentEditingPlayerIndex = -1; 
            }

            function savePlayerInfo(event) {
                event.preventDefault(); 
                if (currentEditingPlayerIndex === -1) return;
                const appData = loadData();
                appData.players[currentEditingPlayerIndex].bankName = document.getElementById('bankName').value;
                appData.players[currentEditingPlayerIndex].accountNumber = document.getElementById('accountNumber').value;
                appData.players[currentEditingPlayerIndex].ewalletProvider = document.getElementById('ewalletProvider').value;
                saveData(appData); 
                renderApp(); 
                closeEditModal(); 
                showNotification('Info pemain berhasil diperbarui!');
            }

            function generateDrawers() {
                const appData = loadData();
                const remainingGenerates = MAX_GENERATE_COUNT - appData.generateCount;
                if (remainingGenerates <= 0) { 
                    showNotification('Batas generate telah tercapai!', 'error'); 
                    return; 
                }
                if (confirm(`Anda memiliki ${remainingGenerates} kesempatan generate lagi. Generate ulang akan mereset status pembayaran. Lanjutkan?`)) {
                    let order = Array.from({length: appData.players.length}, (_, i) => i);
                    for (let i = order.length - 1; i > 0; i--) { 
                        const j = Math.floor(Math.random() * (i + 1)); 
                        [order[i], order[j]] = [order[j], order[i]]; 
                    }
                    // Isi sisa urutan dengan -1 jika jumlah pemain kurang dari 6
                    while (order.length < 6) {
                        order.push(-1);
                    }
                    appData.drawerOrder = order;
                    appData.paymentStatus = appData.players.map(() => Array(6).fill(false));
                    appData.generateCount++;
                    saveData(appData); 
                    renderApp();
                    showNotification(`Urutan penarikan berhasil dibuat! Sisa generate: ${MAX_GENERATE_COUNT - appData.generateCount}`);
                } else { 
                    showNotification('Generate dibatalkan.', 'error'); 
                }
            }

            function swapOrder() {
                const appData = loadData();
                const orderToChange = parseInt(swapOrderSelect.value);
                const newPlayerName = swapPlayerSelect.value;
                if (isNaN(orderToChange) || !newPlayerName) { 
                    showNotification('Pilih urutan dan pemain yang valid.', 'error'); 
                    return; 
                }
                const playerIndexAtSelectedOrder = appData.drawerOrder[orderToChange];
                const newPlayerIndex = appData.players.findIndex(p => p.name === newPlayerName);
                if (playerIndexAtSelectedOrder === newPlayerIndex) { 
                    showNotification('Pemain tersebut sudah menempati urutan ini.', 'error'); 
                    return; 
                }
                const currentOrderOfNewPlayer = appData.drawerOrder.indexOf(newPlayerIndex);
                appData.drawerOrder[currentOrderOfNewPlayer] = playerIndexAtSelectedOrder;
                appData.drawerOrder[orderToChange] = newPlayerIndex;
                saveData(appData); 
                renderApp();
                showNotification(`Urutan ${newPlayerName} berhasil diubah ke urutan ke-${orderToChange + 1}!`);
            }

            function resetData() {
                if (confirm("Apakah Anda yakin ingin mereset SEMUA data?")) { 
                    localStorage.removeItem('julaJulaData'); 
                    renderApp(); 
                    showNotification('Semua data telah direset!', 'success'); 
                }
            }
            
            // --- FUNGSI LOGIN & PASSWORD ---
            function handleLogin(event) {
                event.preventDefault();
                const username = document.getElementById('username').value.trim().toUpperCase();
                const password = document.getElementById('password').value;

                const player = initialPlayers.find(p => p.name.split(' ')[0] === username);
                if (!player || player.password !== password) {
                    loginError.style.display = 'block';
                    return;
                }

                currentUser = player.name;
                loginContainer.style.display = 'none';
                mainAppContainer.style.display = 'block';
                renderApp();
                showNotification(`Selamat datang, ${currentUser}!`);
            }

            function handleLogout() {
                if (confirm("Apakah Anda yakin ingin keluar?")) {
                    currentUser = null;
                    mainAppContainer.style.display = 'none';
                    loginContainer.style.display = 'flex';
                    loginForm.reset();
                    showNotification('Anda telah keluar dari sistem.');
                }
            }

            function openChangePasswordModal() {
                changePasswordModal.style.display = 'block';
                changePasswordForm.reset();
            }

            function closeChangePasswordModal() {
                changePasswordModal.style.display = 'none';
            }

            function handleChangePassword(event) {
                event.preventDefault();
                const appData = loadData();
                const playerIndex = appData.players.findIndex(p => p.name === currentUser);
                
                const currentPass = document.getElementById('currentPassword').value;
                const newPass = document.getElementById('newPassword').value;
                const confirmNewPass = document.getElementById('confirmNewPassword').value;

                if (appData.players[playerIndex].password !== currentPass) {
                    showNotification('Password lama yang Anda masukkan salah!', 'error');
                    return;
                }

                if (newPass !== confirmNewPass) {
                    showNotification('Password baru dan konfirmasi tidak cocok!', 'error');
                    return;
                }

                if (newPass.length < 4) {
                    showNotification('Password baru harus memiliki minimal 4 karakter!', 'error');
                    return;
                }

                appData.players[playerIndex].password = newPass;
                saveData(appData);
                closeChangePasswordModal();
                showNotification('Password berhasil diubah!');
            }

            // --- FUNGSI LAINNYA ---
            function updateClock() {
                const now = new Date();
                const optionsDate = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
                const optionsTime = { hour: '2-digit', minute: '2-digit', second: '2-digit' };
                dateEl.textContent = now.toLocaleDateString('id-ID', optionsDate);
                timeEl.textContent = now.toLocaleTimeString('id-ID', optionsTime);
            }
            
            function createStars() {
                const starsContainer = document.getElementById('stars-container');
                const starCount = 150;
                for (let i = 0; i < starCount; i++) {
                    const star = document.createElement('div');
                    star.className = 'star';
                    star.style.left = `${Math.random() * 100}%`;
                    star.style.top = `${Math.random() * 100}%`;
                    const size = Math.random() * 3;
                    star.style.width = `${size}px`;
                    star.style.height = `${size}px`;
                    star.style.animationDelay = `${Math.random() * 3}s`;
                    starsContainer.appendChild(star);
                }
            }

            // --- EVENT LISTENER GLOBAL ---
            loginForm.addEventListener('submit', handleLogin);
            logoutBtn.addEventListener('click', handleLogout);
            changePasswordBtn.addEventListener('click', openChangePasswordModal);
            closeChangePassModalBtn.addEventListener('click', closeChangePasswordModal);
            changePasswordForm.addEventListener('submit', handleChangePassword);

            generateBtn.addEventListener('click', generateDrawers);
            document.getElementById('resetBtn').addEventListener('click', resetData);
            document.querySelector('.close').addEventListener('click', closeEditModal);
            editForm.addEventListener('submit', savePlayerInfo);
            window.addEventListener('click', (event) => { 
                if (event.target == editModal || event.target == changePasswordModal) { 
                    closeEditModal(); 
                    closeChangePasswordModal(); 
                } 
            });
            swapBtn.addEventListener('click', swapOrder);

            // --- INISIALISASI APLIKASI ---
            createStars();
            updateClock();
            setInterval(updateClock, 1000);
        });
    </script>
</body>
</html>
