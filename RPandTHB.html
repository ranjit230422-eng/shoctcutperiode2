<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MoneyTrack - Sistem Peminjaman dengan Login</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #7C3AED;
            --primary-light: #8B5CF6;
            --primary-dark: #6D28D9;
            --secondary: #10B981;
            --accent: #F59E0B;
            --danger: #EF4444;
            --dark-1: #0F0F0F;
            --dark-2: #1A1A1A;
            --dark-3: #262626;
            --dark-4: #404040;
            --light: #F8FAFC;
            --text-primary: #F1F5F9;
            --text-secondary: #94A3B8;
            --border: #334155;
            --shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3);
            --radius: 12px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, var(--dark-1) 0%, var(--dark-2) 100%);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
            padding: 0;
            overflow-x: hidden;
        }
        
        /* Animasi background */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 10% 20%, rgba(124, 58, 237, 0.05) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(16, 185, 129, 0.05) 0%, transparent 20%),
                radial-gradient(circle at 50% 50%, rgba(245, 158, 11, 0.03) 0%, transparent 30%);
            z-index: -1;
        }
        
        /* Login Screen */
        .login-container {
            display: flex;
            min-height: 100vh;
            align-items: center;
            justify-content: center;
            padding: 20px;
            position: relative;
            overflow: hidden;
        }
        
        /* Animasi elemen dekoratif untuk login */
        .login-container::before {
            content: '';
            position: absolute;
            width: 300px;
            height: 300px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(124, 58, 237, 0.1) 0%, transparent 70%);
            top: -100px;
            right: -100px;
            z-index: -1;
            animation: float 8s ease-in-out infinite;
        }
        
        .login-container::after {
            content: '';
            position: absolute;
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(16, 185, 129, 0.1) 0%, transparent 70%);
            bottom: -50px;
            left: -50px;
            z-index: -1;
            animation: float 6s ease-in-out infinite reverse;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(5deg); }
        }
        
        .login-card {
            background: rgba(26, 26, 26, 0.8);
            backdrop-filter: blur(10px);
            border-radius: var(--radius);
            padding: 40px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.5), 0 10px 10px -5px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            width: 100%;
            max-width: 420px;
            text-align: center;
            position: relative;
            z-index: 1;
            animation: fadeInUp 0.6s ease-out;
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .login-logo {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 30px;
        }
        
        .login-logo-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            box-shadow: 0 4px 10px rgba(124, 58, 237, 0.3);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(124, 58, 237, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(124, 58, 237, 0); }
            100% { box-shadow: 0 0 0 0 rgba(124, 58, 237, 0); }
        }
        
        .login-logo-icon i {
            font-size: 28px;
            color: white;
        }
        
        .login-logo-text {
            font-size: 28px;
            font-weight: 700;
            background: linear-gradient(to right, var(--primary), var(--primary-light));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .login-title {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 10px;
        }
        
        .login-subtitle {
            color: var(--text-secondary);
            margin-bottom: 30px;
        }
        
        .login-form {
            text-align: left;
        }
        
        .form-group {
            margin-bottom: 20px;
            position: relative;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .form-label i {
            color: var(--primary);
            font-size: 16px;
        }
        
        .form-control {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 16px;
            transition: var(--transition);
            background: rgba(38, 38, 38, 0.7);
            color: var(--text-primary);
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.2);
            background: rgba(38, 38, 38, 0.9);
        }
        
        .btn {
            padding: 14px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
            position: relative;
            overflow: hidden;
        }
        
        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(-100%);
            transition: transform 0.6s;
        }
        
        .btn:hover::before {
            transform: translateX(0);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            box-shadow: 0 4px 10px rgba(124, 58, 237, 0.3);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(124, 58, 237, 0.4);
        }
        
        .btn-secondary {
            background: var(--dark-3);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }
        
        .btn-secondary:hover {
            background: var(--dark-4);
            border-color: var(--primary);
        }
        
        .btn-success {
            background: var(--secondary);
            color: white;
        }
        
        .btn-danger {
            background: var(--danger);
            color: white;
        }
        
        .guest-option {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid var(--border);
        }
        
        .guest-text {
            color: var(--text-secondary);
            margin-bottom: 15px;
        }
        
        /* Main App */
        .app-container {
            display: none;
            min-height: 100vh;
            position: relative;
        }
        
        .sidebar {
            width: 260px;
            background: rgba(26, 26, 26, 0.8);
            backdrop-filter: blur(10px);
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            padding: 24px 0;
            display: flex;
            flex-direction: column;
            transition: var(--transition);
            position: fixed;
            height: 100vh;
            z-index: 100;
            overflow-y: auto;
        }
        
        .logo {
            display: flex;
            align-items: center;
            padding: 0 24px 24px;
            margin-bottom: 24px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            box-shadow: 0 4px 10px rgba(124, 58, 237, 0.3);
        }
        
        .logo-icon i {
            font-size: 20px;
            color: white;
        }
        
        .logo-text {
            font-size: 20px;
            font-weight: 700;
            background: linear-gradient(to right, var(--primary), var(--primary-light));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .menu {
            list-style: none;
            padding: 0 16px;
        }
        
        .menu-item {
            margin-bottom: 8px;
            position: relative;
        }
        
        .menu-link {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            color: var(--text-secondary);
            text-decoration: none;
            border-radius: 8px;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }
        
        .menu-link::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--primary);
            transform: scaleY(0);
            transition: transform 0.3s;
        }
        
        .menu-link:hover, .menu-link.active {
            background: rgba(124, 58, 237, 0.1);
            color: var(--text-primary);
        }
        
        .menu-link.active::before {
            transform: scaleY(1);
        }
        
        .menu-link i {
            margin-right: 12px;
            font-size: 18px;
            width: 24px;
            text-align: center;
        }
        
        .menu-text {
            font-weight: 500;
        }
        
        .main-content {
            flex: 1;
            margin-left: 260px;
            padding: 24px;
            display: flex;
            flex-direction: column;
            gap: 24px;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .page-title {
            font-size: 28px;
            font-weight: 700;
            background: linear-gradient(to right, var(--primary), var(--primary-light));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            display: inline-block;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .user-avatar {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 18px;
            box-shadow: 0 4px 10px rgba(124, 58, 237, 0.3);
        }
        
        .logout-btn {
            background: none;
            border: 1px solid var(--border);
            color: var(--text-secondary);
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .logout-btn:hover {
            background: var(--danger);
            color: white;
            border-color: var(--danger);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
        }
        
        .stat-card {
            background: rgba(26, 26, 26, 0.8);
            backdrop-filter: blur(10px);
            border-radius: var(--radius);
            padding: 24px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(to right, var(--primary), var(--secondary));
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 25px -5px rgba(0, 0, 0, 0.4);
        }
        
        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        
        .stat-title {
            font-size: 16px;
            color: var(--text-secondary);
            font-weight: 500;
        }
        
        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            background: rgba(124, 58, 237, 0.1);
            color: var(--primary);
            box-shadow: 0 4px 10px rgba(124, 58, 237, 0.2);
        }
        
        .stat-value {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 8px;
        }
        
        .stat-footer {
            display: flex;
            align-items: center;
            font-size: 14px;
            color: var(--text-secondary);
        }
        
        .stat-trend {
            display: flex;
            align-items: center;
            margin-right: 8px;
        }
        
        .trend-up {
            color: var(--secondary);
        }
        
        .trend-down {
            color: var(--danger);
        }
        
        .content-section {
            background: rgba(26, 26, 26, 0.8);
            backdrop-filter: blur(10px);
            border-radius: var(--radius);
            padding: 24px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: 24px;
            animation: fadeIn 0.5s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }
        
        .section-title {
            font-size: 20px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-actions {
            display: flex;
            gap: 12px;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .currency-group {
            display: flex;
            gap: 12px;
        }
        
        .currency-group .form-control {
            flex: 3;
        }
        
        .currency-group select {
            flex: 1;
        }
        
        .btn-small {
            padding: 8px 16px;
            font-size: 14px;
        }
        
        .action-buttons {
            display: flex;
            gap: 12px;
            margin-top: 24px;
            flex-wrap: wrap;
        }
        
        .loans-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
            gap: 20px;
        }
        
        .loan-card {
            background: rgba(38, 38, 38, 0.8);
            backdrop-filter: blur(10px);
            border-radius: var(--radius);
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            animation: fadeIn 0.5s ease-out;
        }
        
        .loan-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(to right, var(--primary), var(--secondary));
        }
        
        .loan-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 25px -5px rgba(0, 0, 0, 0.4);
        }
        
        /* Style untuk pinjaman yang sudah lunas */
        .loan-completed {
            position: relative;
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(16, 185, 129, 0.05));
            border: 1px solid rgba(16, 185, 129, 0.3);
        }
        
        .loan-completed::before {
            background: linear-gradient(to right, var(--secondary), #0d9488);
        }
        
        .loan-completed .loan-amount {
            opacity: 0.8;
        }
        
        .loan-completed .loan-details .detail-value {
            opacity: 0.8;
        }
        
        .countdown.completed {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.3);
        }
        
        .countdown.completed .countdown-label,
        .countdown.completed .countdown-timer {
            color: var(--secondary);
        }
        
        .completed-mark {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 24px;
            color: var(--secondary);
            z-index: 1;
        }
        
        /* Style untuk pinjaman yang jatuh tempo */
        .loan-overdue {
            position: relative;
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(239, 68, 68, 0.05));
            border: 1px solid rgba(239, 68, 68, 0.3);
        }
        
        .loan-overdue::before {
            background: linear-gradient(to right, var(--danger), #dc2626);
        }
        
        .loan-overdue .loan-amount {
            opacity: 0.9;
        }
        
        .countdown.overdue {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
        }
        
        .countdown.overdue .countdown-label,
        .countdown.overdue .countdown-timer {
            color: var(--danger);
        }
        
        /* Animasi untuk menandai pinjaman sebagai lunas */
        @keyframes markAsCompleted {
            0% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
            100% {
                transform: scale(1);
            }
        }
        
        .loan-completed {
            animation: markAsCompleted 0.5s ease-in-out;
        }
        
        .loan-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        
        .loan-borrower {
            font-size: 18px;
            font-weight: 600;
        }
        
        .loan-amount {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 4px;
        }
        
        .loan-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin: 16px 0;
        }
        
        .loan-detail {
            display: flex;
            flex-direction: column;
        }
        
        .detail-label {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 4px;
        }
        
        .detail-value {
            font-size: 16px;
            font-weight: 600;
        }
        
        .countdown {
            background: rgba(124, 58, 237, 0.1);
            border-radius: 8px;
            padding: 12px;
            margin: 16px 0;
            text-align: center;
            border: 1px solid rgba(124, 58, 237, 0.2);
        }
        
        .countdown-label {
            font-size: 14px;
            color: var(--primary);
            margin-bottom: 4px;
        }
        
        .countdown-timer {
            font-size: 18px;
            font-weight: 700;
            color: var(--primary);
        }
        
        .loan-actions {
            display: flex;
            gap: 8px;
            margin-top: 16px;
        }
        
        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .status-active {
            background: rgba(16, 185, 129, 0.2);
            color: var(--secondary);
            border: 1px solid rgba(16, 185, 129, 0.3);
        }
        
        .status-pending {
            background: rgba(245, 158, 11, 0.2);
            color: var(--accent);
            border: 1px solid rgba(245, 158, 11, 0.3);
        }
        
        .status-completed {
            background: rgba(100, 116, 139, 0.2);
            color: #64748B;
            border: 1px solid rgba(100, 116, 139, 0.3);
        }
        
        .status-overdue {
            background: rgba(239, 68, 68, 0.2);
            color: var(--danger);
            border: 1px solid rgba(239, 68, 68, 0.3);
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            background: rgba(26, 26, 26, 0.9);
            backdrop-filter: blur(10px);
            border-radius: var(--radius);
            padding: 24px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.5), 0 10px 10px -5px rgba(0, 0, 0, 0.3);
            transform: scale(0.9);
            opacity: 0;
            transition: var(--transition);
            border: 1px solid rgba(255, 255, 255, 0.1);
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal.show {
            display: flex;
        }
        
        .modal.show .modal-content {
            transform: scale(1);
            opacity: 1;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .modal-title {
            font-size: 20px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-secondary);
            transition: var(--transition);
        }
        
        .close-modal:hover {
            color: var(--text-primary);
        }
        
        .toast {
            position: fixed;
            bottom: 24px;
            right: 24px;
            background: var(--primary);
            color: white;
            padding: 16px 24px;
            border-radius: 8px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 1000;
            transform: translateX(100%);
            opacity: 0;
            transition: var(--transition);
        }
        
        .toast.show {
            transform: translateX(0);
            opacity: 1;
        }
        
        .toast i {
            font-size: 20px;
        }
        
        .guest-notice {
            background: rgba(245, 158, 11, 0.1);
            border: 1px solid rgba(245, 158, 11, 0.3);
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .guest-notice i {
            color: var(--accent);
            font-size: 20px;
        }
        
        .guest-notice p {
            margin: 0;
            color: var(--text-primary);
        }
        
        .last-update {
            font-size: 12px;
            color: var(--text-secondary);
            text-align: right;
            margin-top: 5px;
        }
        
        @media (max-width: 1024px) {
            .sidebar {
                width: 80px;
            }
            
            .sidebar .menu-text, .sidebar .logo-text {
                display: none;
            }
            
            .main-content {
                margin-left: 80px;
            }
            
            .loans-grid {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }
            
            .sidebar.open {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .currency-group {
                flex-direction: column;
            }
            
            /* Perbaikan tampilan login di HP */
            .login-card {
                padding: 30px 20px;
                max-width: 90%;
            }
            
            .login-logo {
                margin-bottom: 20px;
            }
            
            .login-logo-icon {
                width: 50px;
                height: 50px;
                margin-right: 10px;
            }
            
            .login-logo-icon i {
                font-size: 24px;
            }
            
            .login-logo-text {
                font-size: 24px;
            }
            
            .login-title {
                font-size: 22px;
            }
            
            .form-control {
                padding: 12px 14px;
                font-size: 16px;
            }
            
            .btn {
                padding: 12px 20px;
                font-size: 16px;
            }
        }
        
        @media (max-width: 480px) {
            /* Perbaikan tambahan untuk HP sangat kecil */
            .login-card {
                padding: 25px 15px;
                max-width: 95%;
            }
            
            .login-logo-icon {
                width: 45px;
                height: 45px;
            }
            
            .login-logo-icon i {
                font-size: 20px;
            }
            
            .login-logo-text {
                font-size: 20px;
            }
            
            .login-title {
                font-size: 20px;
            }
            
            .form-control {
                padding: 10px 12px;
                font-size: 15px;
            }
            
            .btn {
                padding: 10px 16px;
                font-size: 15px;
            }
            
            .loan-card {
                padding: 15px;
            }
            
            .loan-amount {
                font-size: 20px;
            }
            
            .loan-details {
                grid-template-columns: 1fr;
                gap: 8px;
            }
        }
        
        .mobile-menu-toggle {
            display: none;
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 101;
            background: var(--primary);
            color: white;
            width: 44px;
            height: 44px;
            border-radius: 8px;
            border: none;
            font-size: 20px;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(124, 58, 237, 0.3);
        }
        
        @media (max-width: 768px) {
            .mobile-menu-toggle {
                display: flex;
                align-items: center;
                justify-content: center;
            }
        }
        
        .text-primary { color: var(--primary); }
        .text-secondary { color: var(--secondary); }
        .text-accent { color: var(--accent); }
        .text-danger { color: var(--danger); }
        
        .mb-4 { margin-bottom: 24px; }
        .mt-4 { margin-top: 24px; }
        
        /* Animasi untuk input */
        .form-group {
            position: relative;
        }
        
        .form-control {
            transition: var(--transition);
        }
        
        .form-control:focus {
            transform: translateY(-2px);
        }
        
        /* Efek hover pada tombol */
        .btn {
            position: relative;
            overflow: hidden;
        }
        
        .btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 5px;
            height: 5px;
            background: rgba(255, 255, 255, 0.5);
            opacity: 0;
            border-radius: 100%;
            transform: scale(1, 1) translate(-50%);
            transform-origin: 50% 50%;
        }
        
        .btn:focus:not(:active)::after {
            animation: ripple 1s ease-out;
        }
        
        @keyframes ripple {
            0% {
                transform: scale(0, 0);
                opacity: 0.5;
            }
            20% {
                transform: scale(25, 25);
                opacity: 0.3;
            }
            100% {
                opacity: 0;
                transform: scale(40, 40);
            }
        }
        
        /* Efek loading untuk tombol submit */
        .btn.loading {
            color: transparent;
        }
        
        .btn.loading::after {
            content: "";
            position: absolute;
            width: 16px;
            height: 16px;
            top: 50%;
            left: 50%;
            margin-left: -8px;
            margin-top: -8px;
            border: 2px solid #ffffff;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spinner 0.8s linear infinite;
        }
        
        @keyframes spinner {
            to { transform: rotate(360deg); }
        }
        
        /* Auto-save indicator */
        .auto-save-indicator {
            position: fixed;
            bottom: 10px;
            left: 10px;
            background: rgba(16, 185, 129, 0.2);
            color: var(--secondary);
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 6px;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 1000;
        }
        
        .auto-save-indicator.show {
            opacity: 1;
        }
        
        .auto-save-indicator i {
            font-size: 14px;
        }
        
        /* Timer display styles */
        .timer-display {
            font-family: 'Courier New', monospace;
            font-weight: 700;
            letter-spacing: 1px;
            font-size: 20px;
        }
        
        .timer-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }
        
        .timer-unit {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0 2px;
        }
        
        .timer-value {
            background: rgba(239, 68, 68, 0.2);
            color: var(--danger);
            border-radius: 4px;
            padding: 4px 6px;
            min-width: 30px;
            text-align: center;
        }
        
        .timer-label {
            font-size: 10px;
            color: var(--text-secondary);
            margin-top: 2px;
            text-transform: uppercase;
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div class="login-container" id="login-container">
        <div class="login-card">
            <div class="login-logo">
                <div class="login-logo-icon">
                    <i class="fas fa-coins"></i>
                </div>
                <div class="login-logo-text">MoneyTrack</div>
            </div>
            
            <h2 class="login-title">Selamat Datang</h2>
            <p class="login-subtitle">Silakan login untuk mengakses sistem</p>
            
            <form class="login-form" id="login-form">
                <div class="form-group">
                    <label for="username" class="form-label">
                        <i class="fas fa-user"></i> Username
                    </label>
                    <input type="text" id="username" class="form-control" placeholder="Masukkan username" required>
                </div>
                
                <div class="form-group">
                    <label for="password" class="form-label">
                        <i class="fas fa-lock"></i> Password
                    </label>
                    <input type="password" id="password" class="form-control" placeholder="Masukkan password" required>
                </div>
                
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-sign-in-alt"></i> Login
                </button>
                
                <div class="guest-option">
                    <p class="guest-text">Atau lihat data sebagai tamu</p>
                    <button type="button" class="btn btn-secondary" id="guest-login">
                        <i class="fas fa-eye"></i> Lihat Sebagai Tamu
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Main App -->
    <div class="app-container" id="app-container">
        <button class="mobile-menu-toggle" id="mobile-menu-toggle">
            <i class="fas fa-bars"></i>
        </button>
        
        <aside class="sidebar" id="sidebar">
            <div class="logo">
                <div class="logo-icon">
                    <i class="fas fa-coins"></i>
                </div>
                <div class="logo-text">MoneyTrack</div>
            </div>
            
            <ul class="menu">
                <li class="menu-item">
                    <a href="#" class="menu-link active">
                        <i class="fas fa-home"></i>
                        <span class="menu-text">Dashboard</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="#" class="menu-link">
                        <i class="fas fa-plus-circle"></i>
                        <span class="menu-text">Tambah Pinjaman</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="#" class="menu-link">
                        <i class="fas fa-history"></i>
                        <span class="menu-text">Riwayat</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="#" class="menu-link">
                        <i class="fas fa-chart-bar"></i>
                        <span class="menu-text">Laporan</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="#" class="menu-link">
                        <i class="fas fa-calculator"></i>
                        <span class="menu-text">Kalkulator</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="#" class="menu-link">
                        <i class="fas fa-cog"></i>
                        <span class="menu-text">Pengaturan</span>
                    </a>
                </li>
            </ul>
        </aside>
        
        <main class="main-content">
            <div class="header">
                <h1 class="page-title">Dashboard Peminjaman</h1>
                <div class="user-info">
                    <div class="user-avatar" id="user-avatar">AD</div>
                    <div>
                        <div style="font-weight: 600;" id="user-name">Admin User</div>
                        <div style="font-size: 14px; color: var(--text-secondary);" id="user-role">Administrator</div>
                    </div>
                    <button class="logout-btn" id="logout-btn">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                </div>
            </div>
            
            <!-- Guest Notice -->
            <div class="guest-notice" id="guest-notice" style="display: none;">
                <i class="fas fa-info-circle"></i>
                <p>Anda sedang melihat data sebagai tamu. Login untuk mengelola data peminjaman.</p>
            </div>
            
            <!-- Stats Cards -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-title">Total Rupiah</div>
                        <div class="stat-icon">
                            <i class="fas fa-money-bill-wave"></i>
                        </div>
                    </div>
                    <div class="stat-value text-primary">Rp 125.450.000</div>
                    <div class="stat-footer">
                        <div class="stat-trend trend-up">
                            <i class="fas fa-arrow-up"></i>
                            <span>12.5%</span>
                        </div>
                        <span>dari bulan lalu</span>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-title">Total Baht</div>
                        <div class="stat-icon">
                            <i class="fas fa-coins"></i>
                        </div>
                    </div>
                    <div class="stat-value text-accent">à¸¿ 845.000</div>
                    <div class="stat-footer">
                        <div class="stat-trend trend-up">
                            <i class="fas fa-arrow-up"></i>
                            <span>8.3%</span>
                        </div>
                        <span>dari bulan lalu</span>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-title">Total Transaksi</div>
                        <div class="stat-icon">
                            <i class="fas fa-exchange-alt"></i>
                        </div>
                    </div>
                    <div class="stat-value text-secondary">142</div>
                    <div class="stat-footer">
                        <div class="stat-trend trend-up">
                            <i class="fas fa-arrow-up"></i>
                            <span>5.2%</span>
                        </div>
                        <span>dari bulan lalu</span>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-title">Pendapatan Bunga</div>
                        <div class="stat-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                    </div>
                    <div class="stat-value text-secondary">Rp 24.580.000</div>
                    <div class="stat-footer">
                        <div class="stat-trend trend-up">
                            <i class="fas fa-arrow-up"></i>
                            <span>15.7%</span>
                        </div>
                        <span>dari bulan lalu</span>
                    </div>
                </div>
            </div>
            
            <!-- Form Section (Hanya untuk admin) -->
            <section class="content-section" id="admin-section">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-plus-circle text-primary"></i> Tambah Peminjaman Baru
                    </h2>
                </div>
                
                <form id="loan-form">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="borrower" class="form-label">
                                <i class="fas fa-user"></i> Nama Peminjam
                            </label>
                            <select id="borrower" class="form-control" required>
                                <option value="">Pilih nama peminjam</option>
                                <!-- Options will be populated by JavaScript -->
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="date" class="form-label">
                                <i class="fas fa-calendar-alt"></i> Tanggal Peminjaman
                            </label>
                            <input type="date" id="date" class="form-control" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="amount" class="form-label">
                                <i class="fas fa-money-bill"></i> Jumlah Peminjaman
                            </label>
                            <div class="currency-group">
                                <input type="number" id="amount" class="form-control" placeholder="Masukkan jumlah" min="1" required>
                                <select id="currency" class="form-control" required>
                                    <option value="IDR">Rupiah (IDR)</option>
                                    <option value="THB">Baht (THB)</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="interest-rate" class="form-label">
                                <i class="fas fa-percentage"></i> Suku Bunga (% per bulan)
                            </label>
                            <input type="number" id="interest-rate" class="form-control" placeholder="Contoh: 5 untuk 5%" min="0" step="0.1" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="period" class="form-label">
                                <i class="fas fa-clock"></i> Jangka Waktu (bulan)
                            </label>
                            <input type="number" id="period" class="form-control" placeholder="Jumlah bulan" min="1" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="due-date" class="form-label">
                                <i class="fas fa-calendar-check"></i> Tanggal Jatuh Tempo
                            </label>
                            <input type="date" id="due-date" class="form-control" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="notes" class="form-label">
                                <i class="fas fa-sticky-note"></i> Catatan (Opsional)
                            </label>
                            <textarea id="notes" class="form-control" rows="3" placeholder="Tambahkan catatan jika diperlukan"></textarea>
                        </div>
                    </div>
                    
                    <div class="action-buttons">
                        <button type="submit" class="btn btn-primary" id="submit-btn">
                            <i class="fas fa-save"></i> Simpan Peminjaman
                        </button>
                        <button type="button" class="btn btn-secondary" id="calculate-btn">
                            <i class="fas fa-calculator"></i> Hitung Bunga
                        </button>
                        <button type="reset" class="btn btn-secondary">
                            <i class="fas fa-redo"></i> Reset Form
                        </button>
                    </div>
                </form>
            </section>
            
            <!-- Loans Section -->
            <section class="content-section">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-list text-primary"></i> Daftar Peminjaman Aktif
                    </h2>
                    <div class="section-actions" id="admin-actions">
                        <button class="btn btn-secondary btn-small">
                            <i class="fas fa-download"></i> Ekspor
                        </button>
                        <button class="btn btn-secondary btn-small">
                            <i class="fas fa-filter"></i> Filter
                        </button>
                    </div>
                </div>
                
                <div class="loans-grid" id="loans-container">
                    <!-- Loan cards will be populated by JavaScript -->
                </div>
                
                <div class="last-update" id="last-update">
                    Terakhir diperbarui: <span id="update-time">--</span>
                </div>
            </section>
        </main>
    </div>

    <!-- Edit Modal -->
    <div class="modal" id="edit-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">
                    <i class="fas fa-edit text-primary"></i> Edit Data Peminjaman
                </div>
                <button class="close-modal">&times;</button>
            </div>
            <form id="edit-form">
                <input type="hidden" id="edit-id">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="edit-borrower" class="form-label">
                            <i class="fas fa-user"></i> Nama Peminjam
                        </label>
                        <select id="edit-borrower" class="form-control" required>
                            <option value="">Pilih nama peminjam</option>
                            <!-- Options will be populated by JavaScript -->
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="edit-date" class="form-label">
                            <i class="fas fa-calendar-alt"></i> Tanggal Peminjaman
                        </label>
                        <input type="date" id="edit-date" class="form-control" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="edit-amount" class="form-label">
                            <i class="fas fa-money-bill"></i> Jumlah Peminjaman
                        </label>
                        <div class="currency-group">
                            <input type="number" id="edit-amount" class="form-control" placeholder="Masukkan jumlah" min="1" required>
                            <select id="edit-currency" class="form-control" required>
                                <option value="IDR">Rupiah (IDR)</option>
                                <option value="THB">Baht (THB)</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="edit-interest-rate" class="form-label">
                            <i class="fas fa-percentage"></i> Suku Bunga (% per bulan)
                        </label>
                        <input type="number" id="edit-interest-rate" class="form-control" placeholder="Contoh: 5 untuk 5%" min="0" step="0.1" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="edit-period" class="form-label">
                            <i class="fas fa-clock"></i> Jangka Waktu (bulan)
                        </label>
                        <input type="number" id="edit-period" class="form-control" placeholder="Jumlah bulan" min="1" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="edit-due-date" class="form-label">
                            <i class="fas fa-calendar-check"></i> Tanggal Jatuh Tempo
                        </label>
                        <input type="date" id="edit-due-date" class="form-control" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="edit-notes" class="form-label">
                            <i class="fas fa-sticky-note"></i> Catatan (Opsional)
                        </label>
                        <textarea id="edit-notes" class="form-control" rows="3" placeholder="Tambahkan catatan jika diperlukan"></textarea>
                    </div>
                </div>
                
                <div class="action-buttons">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Simpan Perubahan
                    </button>
                    <button type="button" class="btn btn-secondary" id="cancel-edit">
                        <i class="fas fa-times"></i> Batal
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast">
        <i class="fas fa-check-circle"></i>
        <span id="toast-message">Operasi berhasil!</span>
    </div>
    
    <!-- Auto-save Indicator -->
    <div class="auto-save-indicator" id="auto-save-indicator">
        <i class="fas fa-save"></i>
        <span>Menyimpan perubahan...</span>
    </div>

    <script>
        // Data pengguna (biasanya ini akan disimpan di server)
        const users = [
            { username: "admin", password: "admin123", name: "Administrator", role: "Admin" },
            { username: "staff", password: "staff123", name: "Staff Keuangan", role: "Staff" }
        ];

        // Daftar nama peminjam
        const borrowers = [
            "WILIAM (E0227447)",
            "FIQAL KANA (E1233842)",
            "MARJOKI SANG (C8555336)",
            "DANIEL (E0859998)",
            "RAAZ JESEN STEPANUS (C8409387)",
            "MAHAT SANJAYA HARAHAP (E4340773)",
            "ANNEN (C8486854)",
            "M FAJAR SIDDIK (C8993287)",
            "PUTRA RAMADHANI (E1988807)",
            "AMRUL (E2365928)",
            "RAM KIRAN (E2620081)",
            "BOBY KASANDRA BANCIN (C8991790)",
            "KIKI YUNITA (C8245909)",
            "CHARLOIPO MANULLANG (E0286030)",
            "FAHRI FIRMANSYAH (E5192174)",
            "GALI PRATAMA (E3773557)",
            "PRIMA NUGRAHA (E5112965)",
            "ROY DILEN (C5875009)",
            "RIDZKY RAMADHAN (E6626714)",
            "AGUNG DEDI IRAWAN (E7089147)",
            "MAICEL TAMPUBOLON (E5843197)",
            "ADE CHAIRUNNISA (E1475210)",
            "M REZI SYAPUTRA (E6690607)",
            "KHOIRUDDIN (C9148103)",
            "BAMBANG AGUNG SUTRISNO (E7520815)",
            "PUTRA INSANY (E7282317)",
            "FERA SALMA (E7632631)",
            "RIVLAN RIZKY (E6759553)",
            "MAULANA ALI SAID (E7531570)",
            "AHMAD ANDIKA (E7631720)",
            "ANGGARA K S (E7647305)",
            "DIMAS ADHITYA (E6937626)",
            "GABRIEL RONI ARGANTA HUTABALIAN (E7694857)",
            "EGA PRAYUDA (E2703456)",
            "ARJUN PRAISYA (E7879939)",
            "ADITYA PANCA (X3189356)",
            "AUDIS OYONG DUANSYAH (E7281571)",
            "ADE OJI SHAPUTRA (E8491965)",
            "ALFIANSYAH (E9268104)",
            "ANDY PUTRA (X3618101)",
            "JUNITA MARSHA (E2817535)",
            "MELAN PUTRI TRINITA (E0441477)",
            "LAELA ANASILDA (E1517441)",
            "ISMI AZRILIA LUBIS (C4328372)",
            "SYARIFAH RUMIATI ASTARI (C4462617 / E5380676)"
        ];

        // Data contoh untuk pinjaman
        let loans = JSON.parse(localStorage.getItem('loans')) || [
            {
                id: 1,
                borrower: "WILIAM (E0227447)",
                amount: 5000000,
                currency: "IDR",
                interestRate: 10,
                period: 6,
                date: "2023-07-15",
                dueDate: "2024-01-15",
                status: "active",
                notes: "Pinjaman untuk modal usaha"
            },
            {
                id: 2,
                borrower: "FIQAL KANA (E1233842)",
                amount: 50000,
                currency: "THB",
                interestRate: 8,
                period: 12,
                date: "2023-07-10",
                dueDate: "2024-07-10",
                status: "active",
                notes: "Pinjaman pendidikan"
            },
            {
                id: 3,
                borrower: "DANIEL (E0859998)",
                amount: 12000000,
                currency: "IDR",
                interestRate: 12,
                period: 3,
                date: "2023-07-05",
                dueDate: "2023-10-05",
                status: "overdue",
                notes: "Pinjaman darurat"
            },
            {
                id: 4,
                borrower: "MARJOKI SANG (C8555336)",
                amount: 8000000,
                currency: "IDR",
                interestRate: 10,
                period: 4,
                date: "2023-06-15",
                dueDate: "2023-10-15",
                status: "completed",
                notes: "Pinjaman untuk renovasi rumah"
            }
        ];

        // Status login
        let currentUser = null;
        let isGuest = false;
        let autoSaveInterval = null;
        let countdownIntervals = {}; // Objek untuk menyimpan interval countdown

        // Fungsi untuk memeriksa status login
        function checkLoginStatus() {
            const savedUser = localStorage.getItem('currentUser');
            const savedGuest = localStorage.getItem('isGuest');
            
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                isGuest = false;
                showApp();
            } else if (savedGuest === 'true') {
                isGuest = true;
                currentUser = { name: "Tamu", role: "Guest" };
                showApp();
            }
        }

        // Fungsi untuk menampilkan aplikasi
        function showApp() {
            document.getElementById('login-container').style.display = 'none';
            document.getElementById('app-container').style.display = 'flex';
            
            // Update info pengguna
            document.getElementById('user-name').textContent = currentUser.name;
            document.getElementById('user-role').textContent = currentUser.role;
            document.getElementById('user-avatar').textContent = currentUser.name.charAt(0);
            
            // Tampilkan atau sembunyikan elemen berdasarkan role
            if (isGuest || currentUser.role === 'Guest') {
                document.getElementById('admin-section').style.display = 'none';
                document.getElementById('admin-actions').style.display = 'none';
                document.getElementById('guest-notice').style.display = 'flex';
            } else {
                document.getElementById('admin-section').style.display = 'block';
                document.getElementById('admin-actions').style.display = 'flex';
                document.getElementById('guest-notice').style.display = 'none';
            }
            
            // Render data
            populateBorrowerDropdown();
            renderLoanCards();
            updateLastUpdateTime();
            
            // Mulai auto-save
            startAutoSave();
        }

        // Fungsi untuk login
        function login(username, password) {
            const user = users.find(u => u.username === username && u.password === password);
            
            if (user) {
                currentUser = user;
                isGuest = false;
                localStorage.setItem('currentUser', JSON.stringify(user));
                localStorage.removeItem('isGuest');
                showApp();
                showToast('Login berhasil!');
                return true;
            } else {
                showToast('Username atau password salah!', 'error');
                return false;
            }
        }

        // Fungsi untuk logout
        function logout() {
            // Hentikan auto-save dan countdown
            stopAutoSave();
            clearAllCountdowns();
            
            currentUser = null;
            isGuest = false;
            localStorage.removeItem('currentUser');
            localStorage.removeItem('isGuest');
            
            document.getElementById('login-container').style.display = 'flex';
            document.getElementById('app-container').style.display = 'none';
            
            // Reset form login
            document.getElementById('login-form').reset();
        }

        // Fungsi untuk login sebagai tamu
        function loginAsGuest() {
            currentUser = { name: "Tamu", role: "Guest" };
            isGuest = true;
            localStorage.setItem('isGuest', 'true');
            localStorage.removeItem('currentUser');
            showApp();
            showToast('Anda masuk sebagai tamu');
        }

        // Fungsi untuk memformat angka sebagai mata uang
        function formatCurrency(amount, currency) {
            if (currency === 'IDR') {
                return 'Rp ' + Number(amount).toLocaleString('id-ID');
            } else if (currency === 'THB') {
                return 'à¸¿ ' + Number(amount).toLocaleString('th-TH');
            }
            return amount;
        }

        // Fungsi untuk menghitung bunga
        function calculateInterest(principal, interestRate, period) {
            return principal * (interestRate / 100) * period;
        }

        // Fungsi untuk menghitung total pembayaran
        function calculateTotalPayment(principal, interest) {
            return principal + interest;
        }

        // Fungsi untuk menghitung sisa hari hingga jatuh tempo
        function calculateDaysUntilDue(dueDate) {
            const today = new Date();
            const due = new Date(dueDate);
            const diffTime = due - today;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            return diffDays;
        }

        // Fungsi untuk menghitung waktu mundur untuk pinjaman jatuh tempo
        function calculateOverdueTime(dueDate) {
            const today = new Date();
            const due = new Date(dueDate);
            const diffTime = today - due;
            
            // Hitung hari, jam, menit, dan detik
            const days = Math.floor(diffTime / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diffTime % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((diffTime % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((diffTime % (1000 * 60)) / 1000);
            
            return { days, hours, minutes, seconds };
        }

        // Fungsi untuk memformat waktu mundur
        function formatOverdueTime(overdueTime) {
            const { days, hours, minutes, seconds } = overdueTime;
            
            // Format dengan leading zeros
            const formattedDays = days.toString().padStart(2, '0');
            const formattedHours = hours.toString().padStart(2, '0');
            const formattedMinutes = minutes.toString().padStart(2, '0');
            const formattedSeconds = seconds.toString().padStart(2, '0');
            
            return { days: formattedDays, hours: formattedHours, minutes: formattedMinutes, seconds: formattedSeconds };
        }

        // Fungsi untuk menampilkan notifikasi
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toast-message');
            
            toastMessage.textContent = message;
            
            // Set warna berdasarkan jenis notifikasi
            if (type === 'error') {
                toast.style.background = 'var(--danger)';
            } else if (type === 'info') {
                toast.style.background = 'var(--accent)';
            } else {
                toast.style.background = 'var(--primary)';
            }
            
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Fungsi untuk menampilkan indikator auto-save
        function showAutoSaveIndicator() {
            const indicator = document.getElementById('auto-save-indicator');
            indicator.classList.add('show');
            
            setTimeout(() => {
                indicator.classList.remove('show');
            }, 2000);
        }

        // Fungsi untuk mengisi dropdown dengan daftar nama
        function populateBorrowerDropdown() {
            const borrowerSelect = document.getElementById('borrower');
            const editBorrowerSelect = document.getElementById('edit-borrower');
            
            borrowerSelect.innerHTML = '<option value="">Pilih nama peminjam</option>';
            editBorrowerSelect.innerHTML = '<option value="">Pilih nama peminjam</option>';
            
            borrowers.forEach(borrower => {
                const option = document.createElement('option');
                option.value = borrower;
                option.textContent = borrower;
                borrowerSelect.appendChild(option);
                
                const editOption = document.createElement('option');
                editOption.value = borrower;
                editOption.textContent = borrower;
                editBorrowerSelect.appendChild(editOption);
            });
        }

        // Fungsi untuk memperbarui waktu terakhir update
        function updateLastUpdateTime() {
            const now = new Date();
            const formattedDate = now.toLocaleDateString('id-ID', {
                day: 'numeric',
                month: 'long',
                year: 'numeric'
            });
            const formattedTime = now.toLocaleTimeString('id-ID', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            
            document.getElementById('update-time').textContent = `${formattedDate} pukul ${formattedTime}`;
        }

        // Fungsi untuk auto-save data
        function autoSaveData() {
            if (!isGuest && currentUser) {
                localStorage.setItem('loans', JSON.stringify(loans));
                updateLastUpdateTime();
                showAutoSaveIndicator();
            }
        }

        // Fungsi untuk memulai auto-save
        function startAutoSave() {
            // Auto-save setiap 30 detik
            autoSaveInterval = setInterval(autoSaveData, 30000);
        }

        // Fungsi untuk menghentikan auto-save
        function stopAutoSave() {
            if (autoSaveInterval) {
                clearInterval(autoSaveInterval);
                autoSaveInterval = null;
            }
        }

        // Fungsi untuk membersihkan semua countdown
        function clearAllCountdowns() {
            // Hentikan semua interval countdown yang sedang berjalan
            Object.keys(countdownIntervals).forEach(key => {
                clearInterval(countdownIntervals[key]);
            });
            countdownIntervals = {};
        }

        // Fungsi untuk memperbarui countdown timer
        function updateCountdownTimer(loanId, dueDate) {
            const timerContainer = document.getElementById(`countdown-timer-${loanId}`);
            if (!timerContainer) return;
            
            const overdueTime = calculateOverdueTime(dueDate);
            const formattedTime = formatOverdueTime(overdueTime);
            
            // Hapus konten yang ada
            timerContainer.innerHTML = '';
            
            // Buat timer container baru
            if (formattedTime.days !== "00") {
                // Tampilkan hari, jam, menit, detik
                timerContainer.innerHTML = `
                    <div class="timer-container">
                        <div class="timer-unit">
                            <div class="timer-value">${formattedTime.days}</div>
                            <div class="timer-label">Hari</div>
                        </div>
                        <div class="timer-unit">
                            <div class="timer-value">${formattedTime.hours}</div>
                            <div class="timer-label">Jam</div>
                        </div>
                        <div class="timer-unit">
                            <div class="timer-value">${formattedTime.minutes}</div>
                            <div class="timer-label">Menit</div>
                        </div>
                        <div class="timer-unit">
                            <div class="timer-value">${formattedTime.seconds}</div>
                            <div class="timer-label">Detik</div>
                        </div>
                    </div>
                `;
            } else {
                // Tampilkan jam, menit, detik saja (kurang dari 24 jam)
                timerContainer.innerHTML = `
                    <div class="timer-container">
                        <div class="timer-unit">
                            <div class="timer-value">${formattedTime.hours}</div>
                            <div class="timer-label">Jam</div>
                        </div>
                        <div class="timer-unit">
                            <div class="timer-value">${formattedTime.minutes}</div>
                            <div class="timer-label">Menit</div>
                        </div>
                        <div class="timer-unit">
                            <div class="timer-value">${formattedTime.seconds}</div>
                            <div class="timer-label">Detik</div>
                        </div>
                    </div>
                `;
            }
        }

        // Fungsi untuk menampilkan kartu pinjaman
        function renderLoanCards() {
            // Bersihkan semua countdown yang ada
            clearAllCountdowns();
            
            const loansContainer = document.getElementById('loans-container');
            loansContainer.innerHTML = '';
            
            if (loans.length === 0) {
                loansContainer.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: var(--text-secondary);">
                        <i class="fas fa-inbox" style="font-size: 48px; margin-bottom: 15px; opacity: 0.5;"></i>
                        <p>Tidak ada data peminjaman. Tambahkan peminjaman baru.</p>
                    </div>
                `;
                updateLastUpdateTime();
                return;
            }
            
            loans.forEach((loan, index) => {
                const interest = calculateInterest(loan.amount, loan.interestRate, loan.period);
                const totalPayment = calculateTotalPayment(loan.amount, interest);
                const daysUntilDue = calculateDaysUntilDue(loan.dueDate);
                
                // Tentukan status dan kelas CSS
                let statusText, statusClass;
                if (loan.status === 'completed') {
                    statusText = 'Lunas';
                    statusClass = 'status-completed';
                } else if (loan.status === 'overdue' || daysUntilDue < 0) {
                    statusText = 'Jatuh Tempo';
                    statusClass = 'status-overdue';
                } else if (loan.status === 'active') {
                    statusText = 'Aktif';
                    statusClass = 'status-active';
                } else if (loan.status === 'pending') {
                    statusText = 'Pending';
                    statusClass = 'status-pending';
                }
                
                // Format countdown text
                let countdownText;
                if (loan.status === 'completed') {
                    countdownText = 'Peminjaman telah dilunasi';
                } else if (loan.status === 'overdue' || daysUntilDue < 0) {
                    // Untuk pinjaman jatuh tempo, kita akan menggunakan timer container khusus
                    countdownText = `<div id="countdown-timer-${loan.id}" class="timer-display">Memuat...</div>`;
                } else if (daysUntilDue === 0) {
                    countdownText = 'Jatuh tempo hari ini';
                } else {
                    countdownText = `${daysUntilDue} hari lagi`;
                }
                
                const loanCard = document.createElement('div');
                
                // Tambahkan kelas khusus jika pinjaman sudah lunas atau jatuh tempo
                if (loan.status === 'completed') {
                    loanCard.className = 'loan-card loan-completed';
                } else if (loan.status === 'overdue' || daysUntilDue < 0) {
                    loanCard.className = 'loan-card loan-overdue';
                } else {
                    loanCard.className = 'loan-card';
                }
                
                // Tentukan apakah tombol aksi harus ditampilkan
                const actionButtons = isGuest ? '' : `
                    <div class="loan-actions">
                        ${loan.status !== 'completed' ? `
                            <button class="btn btn-primary btn-small edit-btn" data-id="${loan.id}">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                            ${loan.status !== 'overdue' ? `
                                <button class="btn btn-success btn-small pay-btn" data-id="${loan.id}">
                                    <i class="fas fa-check"></i> Lunasi
                                </button>
                            ` : ''}
                        ` : ''}
                        <button class="btn btn-danger btn-small delete-btn" data-id="${loan.id}">
                            <i class="fas fa-trash"></i> Hapus
                        </button>
                    </div>
                `;
                
                // Tambahkan tanda centang jika sudah lunas
                const completedBadge = loan.status === 'completed' ? `
                    <div class="completed-mark">
                        <i class="fas fa-check-circle"></i>
                    </div>
                ` : '';
                
                // Tambahkan tanda peringatan jika jatuh tempo
                const overdueBadge = (loan.status === 'overdue' || daysUntilDue < 0) ? `
                    <div class="overdue-mark">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                ` : '';
                
                loanCard.innerHTML = `
                    ${completedBadge}
                    ${overdueBadge}
                    <div class="loan-header">
                        <div class="loan-borrower">${loan.borrower}</div>
                        <span class="status-badge ${statusClass}">${statusText}</span>
                    </div>
                    <div class="loan-amount ${loan.currency.toLowerCase()}">${formatCurrency(loan.amount, loan.currency)}</div>
                    
                    <div class="loan-details">
                        <div class="loan-detail">
                            <span class="detail-label">Bunga</span>
                            <span class="detail-value">${loan.interestRate}%</span>
                        </div>
                        <div class="loan-detail">
                            <span class="detail-label">Jangka Waktu</span>
                            <span class="detail-value">${loan.period} bulan</span>
                        </div>
                        <div class="loan-detail">
                            <span class="detail-label">Total Bunga</span>
                            <span class="detail-value text-accent">${formatCurrency(interest, loan.currency)}</span>
                        </div>
                        <div class="loan-detail">
                            <span class="detail-label">Total Bayar</span>
                            <span class="detail-value ${loan.currency.toLowerCase()}">${formatCurrency(totalPayment, loan.currency)}</span>
                        </div>
                    </div>
                    
                    <div class="countdown ${loan.status === 'completed' ? 'completed' : (loan.status === 'overdue' || daysUntilDue < 0 ? 'overdue' : '')}">
                        <div class="countdown-label">${loan.status === 'completed' ? 'Status' : 'Jatuh Tempo: ' + new Date(loan.dueDate).toLocaleDateString('id-ID')}</div>
                        <div class="countdown-timer">${countdownText}</div>
                    </div>
                    
                    ${actionButtons}
                `;
                
                loansContainer.appendChild(loanCard);
                
                // Jika pinjaman jatuh tempo, mulai countdown timer
                if (loan.status === 'overdue' || daysUntilDue < 0) {
                    // Buat interval untuk memperbarui timer setiap detik
                    countdownIntervals[loan.id] = setInterval(() => {
                        updateCountdownTimer(loan.id, loan.dueDate);
                    }, 1000);
                    
                    // Update timer langsung setelah membuat element
                    updateCountdownTimer(loan.id, loan.dueDate);
                }
            });
            
            // Tambahkan event listener untuk tombol aksi (hanya untuk admin)
            if (!isGuest) {
                document.querySelectorAll('.edit-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const loanId = parseInt(this.getAttribute('data-id'));
                        openEditModal(loanId);
                    });
                });
                
                document.querySelectorAll('.pay-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const loanId = parseInt(this.getAttribute('data-id'));
                        markAsPaid(loanId);
                    });
                });
                
                document.querySelectorAll('.delete-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const loanId = parseInt(this.getAttribute('data-id'));
                        deleteLoan(loanId);
                    });
                });
            }
            
            updateLastUpdateTime();
        }

        // Fungsi untuk membuka modal edit
        function openEditModal(loanId) {
            if (isGuest) {
                showToast('Anda tidak memiliki akses untuk mengedit data!', 'error');
                return;
            }
            
            const loan = loans.find(loan => loan.id === loanId);
            if (!loan) return;
            
            // Isi form edit dengan data pinjaman
            document.getElementById('edit-id').value = loan.id;
            document.getElementById('edit-borrower').value = loan.borrower;
            document.getElementById('edit-date').value = loan.date;
            document.getElementById('edit-amount').value = loan.amount;
            document.getElementById('edit-currency').value = loan.currency;
            document.getElementById('edit-interest-rate').value = loan.interestRate;
            document.getElementById('edit-period').value = loan.period;
            document.getElementById('edit-due-date').value = loan.dueDate;
            document.getElementById('edit-notes').value = loan.notes || '';
            
            // Tampilkan modal
            document.getElementById('edit-modal').classList.add('show');
        }

        // Fungsi untuk menutup modal edit
        function closeEditModal() {
            document.getElementById('edit-modal').classList.remove('show');
        }

        // Fungsi untuk menghapus peminjaman
        function deleteLoan(loanId) {
            if (isGuest) {
                showToast('Anda tidak memiliki akses untuk menghapus data!', 'error');
                return;
            }
            
            if (confirm('Apakah Anda yakin ingin menghapus data peminjaman ini?')) {
                // Hentikan countdown untuk pinjaman ini
                if (countdownIntervals[loanId]) {
                    clearInterval(countdownIntervals[loanId]);
                    delete countdownIntervals[loanId];
                }
                
                loans = loans.filter(loan => loan.id !== loanId);
                localStorage.setItem('loans', JSON.stringify(loans));
                renderLoanCards();
                showToast('Data peminjaman berhasil dihapus!');
            }
        }

        // Fungsi untuk menandai sebagai lunas
        function markAsPaid(loanId) {
            if (isGuest) {
                showToast('Anda tidak memiliki akses untuk mengubah status peminjaman!', 'error');
                return;
            }
            
            if (confirm('Apakah Anda yakin ingin menandai peminjaman ini sebagai lunas?')) {
                const loanIndex = loans.findIndex(loan => loan.id === loanId);
                if (loanIndex !== -1) {
                    // Hentikan countdown untuk pinjaman ini
                    if (countdownIntervals[loanId]) {
                        clearInterval(countdownIntervals[loanId]);
                        delete countdownIntervals[loanId];
                    }
                    
                    loans[loanIndex].status = 'completed';
                    localStorage.setItem('loans', JSON.stringify(loans));
                    
                    // Tambahkan kelas animasi sebelum render ulang
                    const loanCard = document.querySelector(`.loan-card:has(.edit-btn[data-id="${loanId}"])`);
                    if (loanCard) {
                        loanCard.style.animation = 'markAsCompleted 0.5s ease-in-out';
                    }
                    
                    // Render ulang setelah animasi selesai
                    setTimeout(() => {
                        renderLoanCards();
                        showToast('Peminjaman berhasil ditandai sebagai lunas!');
                    }, 500);
                }
            }
        }

        // Fungsi untuk menghasilkan ID unik
        function generateId() {
            return loans.length > 0 ? Math.max(...loans.map(loan => loan.id)) + 1 : 1;
        }

        // Event listener saat DOM sudah dimuat
        document.addEventListener('DOMContentLoaded', function() {
            // Periksa status login
            checkLoginStatus();
            
            // Event listener untuk form login
            document.getElementById('login-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;
                
                login(username, password);
            });
            
            // Event listener untuk login tamu
            document.getElementById('guest-login').addEventListener('click', loginAsGuest);
            
            // Event listener untuk logout
            document.getElementById('logout-btn').addEventListener('click', logout);
            
            // Set tanggal default ke hari ini
            const today = new Date();
            document.getElementById('date').valueAsDate = today;
            
            // Set tanggal jatuh tempo default ke 30 hari dari sekarang
            const dueDate = new Date();
            dueDate.setDate(today.getDate() + 30);
            document.getElementById('due-date').valueAsDate = dueDate;
            
            // Event listener untuk form submit (hanya untuk admin)
            document.getElementById('loan-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                if (isGuest) {
                    showToast('Anda tidak memiliki akses untuk menambah data!', 'error');
                    return;
                }
                
                const borrower = document.getElementById('borrower').value;
                const amount = parseFloat(document.getElementById('amount').value);
                const currency = document.getElementById('currency').value;
                const interestRate = parseFloat(document.getElementById('interest-rate').value);
                const period = parseInt(document.getElementById('period').value);
                const date = document.getElementById('date').value;
                const dueDate = document.getElementById('due-date').value;
                const notes = document.getElementById('notes').value;
                
                if (!borrower) {
                    showToast('Harap pilih nama peminjam!', 'error');
                    return;
                }
                
                // Simulasi loading
                const submitBtn = document.getElementById('submit-btn');
                const originalText = submitBtn.innerHTML;
                submitBtn.classList.add('loading');
                submitBtn.disabled = true;
                
                // Simulasi proses penyimpanan
                setTimeout(() => {
                    const newLoan = {
                        id: generateId(),
                        borrower,
                        amount,
                        currency,
                        interestRate,
                        period,
                        date,
                        dueDate,
                        status: 'active',
                        notes
                    };
                    
                    loans.push(newLoan);
                    localStorage.setItem('loans', JSON.stringify(loans));
                    renderLoanCards();
                    
                    // Reset form
                    document.getElementById('loan-form').reset();
                    
                    // Set ulang tanggal default
                    document.getElementById('date').valueAsDate = new Date();
                    const newDueDate = new Date();
                    newDueDate.setDate(newDueDate.getDate() + 30);
                    document.getElementById('due-date').valueAsDate = newDueDate;
                    
                    // Kembalikan tombol ke keadaan semula
                    submitBtn.classList.remove('loading');
                    submitBtn.innerHTML = originalText;
                    submitBtn.disabled = false;
                    
                    showToast('Data peminjaman berhasil disimpan!');
                }, 1500);
            });
            
            // Event listener untuk form edit
            document.getElementById('edit-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                if (isGuest) {
                    showToast('Anda tidak memiliki akses untuk mengedit data!', 'error');
                    return;
                }
                
                const id = parseInt(document.getElementById('edit-id').value);
                const borrower = document.getElementById('edit-borrower').value;
                const amount = parseFloat(document.getElementById('edit-amount').value);
                const currency = document.getElementById('edit-currency').value;
                const interestRate = parseFloat(document.getElementById('edit-interest-rate').value);
                const period = parseInt(document.getElementById('edit-period').value);
                const date = document.getElementById('edit-date').value;
                const dueDate = document.getElementById('edit-due-date').value;
                const notes = document.getElementById('edit-notes').value;
                
                if (!borrower) {
                    showToast('Harap pilih nama peminjam!', 'error');
                    return;
                }
                
                // Update data pinjaman
                const loanIndex = loans.findIndex(loan => loan.id === id);
                if (loanIndex !== -1) {
                    loans[loanIndex] = {
                        ...loans[loanIndex],
                        borrower,
                        amount,
                        currency,
                        interestRate,
                        period,
                        date,
                        dueDate,
                        notes
                    };
                    
                    localStorage.setItem('loans', JSON.stringify(loans));
                    renderLoanCards();
                    closeEditModal();
                    showToast('Data peminjaman berhasil diperbarui!');
                }
            });
            
            // Event listener untuk tombol hitung bunga
            document.getElementById('calculate-btn').addEventListener('click', function() {
                const amount = parseFloat(document.getElementById('amount').value);
                const interestRate = parseFloat(document.getElementById('interest-rate').value);
                const period = parseInt(document.getElementById('period').value);
                
                if (!amount || !interestRate || !period) {
                    showToast('Harap isi jumlah, suku bunga, dan jangka waktu!', 'error');
                    return;
                }
                
                const interest = calculateInterest(amount, interestRate, period);
                const totalPayment = calculateTotalPayment(amount, interest);
                
                alert(`Perhitungan Bunga:\n\nPokok: ${formatCurrency(amount, 'IDR')}\nBunga: ${formatCurrency(interest, 'IDR')}\nTotal: ${formatCurrency(totalPayment, 'IDR')}\nPer Bulan: ${formatCurrency(totalPayment / period, 'IDR')}`);
            });
            
            // Event listener untuk tombol batal di modal edit
            document.getElementById('cancel-edit').addEventListener('click', closeEditModal);
            
            // Event listener untuk tombol close modal
            document.querySelector('.close-modal').addEventListener('click', closeEditModal);
            
            // Close modal ketika mengklik di luar konten
            document.getElementById('edit-modal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeEditModal();
                }
            });
            
            // Mobile menu toggle
            document.getElementById('mobile-menu-toggle').addEventListener('click', function() {
                document.getElementById('sidebar').classList.toggle('open');
            });
        });
    </script>
</body>
</html>